# Methodë¥¼ Closureë¡œ ë§¤í•‘
ì´ ì½”ë“œëŠ” Rustì—ì„œ ê³ ì°¨ í•¨ìˆ˜ì™€ í´ë¡œì €ë¥¼ í™œìš©í•œ ì•ˆì „í•œ ë°ì´í„° ì ‘ê·¼ íŒ¨í„´ì„ ë³´ì—¬ì£¼ëŠ” ì•„ì£¼ ì¢‹ì€ ì˜ˆì…ë‹ˆë‹¤. 
ì•„ë˜ì— ì´ ê¸°ë²•ì„ ë‹¨ê³„ë³„ë¡œ ìì„¸íˆ ì„¤ëª….

## ì „ì²´ ì½”ë“œ
```rust
// ì•ˆì „í•˜ê²Œ ëª¨ë“  ì½”ë„ˆ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
let get = |f: &dyn Fn(usize, usize) -> Option<Vector3D>| -> Option<[Vector3D; 4]> {
    Some([
        f(i, j)?,
        f(i, j+1)?,
        f(i+1, j)?,
        f(i+1, j+1)?,
    ])
};
```
```rust
let p = [
    self.point_at(i, j)?,
    self.point_at(i, j+1)?,
    self.point_at(i+1, j)?,
    self.point_at(i+1, j+1)?,
];
```
```rust
let pu_fn = {
    let s = self;
    move |u: usize, v: usize| s.u_tangent_at(u, v)
};
let pv_fn = {
    let s = self;
    move |u: usize, v: usize| s.v_tangent_at(u, v)
};
let tw_fn = {
    let s = self;
    move |u: usize, v: usize| s.twist_at(u, v)
};
```
```rust
let pu = get(&pu_fn)?;
let pv = get(&pv_fn)?;
let tw = get(&tw_fn)?;

```

## ğŸ§  ì „ì²´ ëª©ì 
- HermiteSurfaceì˜ ê²©ì ë°ì´í„° (u_tangent_at, v_tangent_at, twist_at)ë¥¼ ì•ˆì „í•˜ê²Œ ê°€ì ¸ì˜¤ê¸° ìœ„í•´
- unwrap() ì—†ì´ Optionì„ í™œìš©í•´ panic ì—†ì´ ì•ˆì „í•˜ê²Œ 4ê°œì˜ ì½”ë„ˆ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” êµ¬ì¡°

## ğŸ”§ í•µì‹¬ êµ¬ì„± ìš”ì†Œ ì„¤ëª…
### 1. get í•¨ìˆ˜: ê³ ì°¨ í•¨ìˆ˜
```rust
let get = |f: &dyn Fn(usize, usize) -> Option<Vector3D>| -> Option<[Vector3D; 4]> {
    Some([
        f(i, j)?,
        f(i, j+1)?,
        f(i+1, j)?,
        f(i+1, j+1)?,
    ])
};
```
- ì…ë ¥: fëŠ” Fn(u,v) -> Option<Vector3D> íƒ€ì…ì˜ í•¨ìˆ˜ ë˜ëŠ” í´ë¡œì €
- ì¶œë ¥: 4ê°œì˜ ì½”ë„ˆ ê°’ì„ [Vector3D; 4]ë¡œ ë¬¶ì–´ ë°˜í™˜
- ? ì—°ì‚°ìë¥¼ ì‚¬ìš©í•´ í•˜ë‚˜ë¼ë„ Noneì´ë©´ ì „ì²´ê°€ Noneìœ¼ë¡œ ì²˜ë¦¬ë¨
â†’ ì´ í•¨ìˆ˜ëŠ” ë°ì´í„° ì ‘ê·¼ì„ ì¶”ìƒí™”í•˜ê³ , ì—ëŸ¬ ì „íŒŒë¥¼ ìë™í™”í•˜ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤

### 2. pu_fn, pv_fn, tw_fn: ë©”ì„œë“œë¥¼ í´ë¡œì €ë¡œ ë˜í•‘
```rust
let pu_fn = { let s = self; move |u, v| s.u_tangent_at(u, v) };
```
- Rustì—ì„œëŠ” ë©”ì„œë“œë¥¼ ì§ì ‘ &self.methodë¡œ ë„˜ê¸¸ ìˆ˜ ì—†ê¸° ë•Œë¬¸ì—
- move í´ë¡œì €ë¡œ ê°ì‹¸ì„œ Fn(u,v) í˜•íƒœë¡œ ë§Œë“¤ì–´ì•¼ í•¨
- let s = selfë¡œ ìº¡ì²˜í•œ í›„, s.method(u,v)ë¡œ í˜¸ì¶œ
â†’ ì´ ë°©ì‹ì€ ë©”ì„œë“œë¥¼ í•¨ìˆ˜ì²˜ëŸ¼ ì „ë‹¬í•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤

### 3. get() í˜¸ì¶œ
```rust
let pu = get(&pu_fn)?;
```

- get()ì€ pu_fnì„ í˜¸ì¶œí•´ i,j ì£¼ë³€ì˜ 4ê°œ ê°’ì„ ê°€ì ¸ì˜´
- ? ì—°ì‚°ìë¥¼ í†µí•´ Noneì´ë©´ ë¹ ë¥´ê²Œ íƒˆì¶œ
â†’ ì´ êµ¬ì¡°ëŠ” ì•ˆì „í•˜ê³  ê°„ê²°í•œ ë°ì´í„° ìˆ˜ì§‘ì„ ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤

### ğŸ“¦ ì „ì²´ íë¦„ ìš”ì•½
```rust
// 1. ë©”ì„œë“œë¥¼ í´ë¡œì €ë¡œ ë˜í•‘
let f = { let s = self; move |u,v| s.method(u,v) };

// 2. ê³ ì°¨ í•¨ìˆ˜ get()ì— ë„˜ê²¨ì„œ 4ê°œ ì½”ë„ˆ ê°’ ìˆ˜ì§‘
let values = get(&f)?;
// 3. unwrap ì—†ì´ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬
```

## âœ… ì¥ì 

| í•­ëª©                     | ì„¤ëª…                                                             |
|--------------------------|------------------------------------------------------------------|
| unwrap() â†’ Option ì²˜ë¦¬   | panic ì—†ì´ ì•ˆì „í•˜ê²Œ ë°ì´í„° ì ‘ê·¼ ê°€ëŠ¥ (`?` ì—°ì‚°ì ê¸°ë°˜)           |
| get() â†’ Fn(u,v) ì¶”ìƒí™”  | ë‹¤ì–‘í•œ ë°ì´í„° ì ‘ê·¼ í•¨ìˆ˜ë¥¼ ì¬ì‚¬ìš© ê°€ëŠ¥, ì½”ë“œ ì¤‘ë³µ ì œê±°             |
| í´ë¡œì €ë¡œ ë©”ì„œë“œ ë˜í•‘     | ë©”ì„œë“œë¥¼ í•¨ìˆ˜ì²˜ëŸ¼ ì „ë‹¬ ê°€ëŠ¥ â†’ ê³ ì°¨ í•¨ìˆ˜ì™€ ì¡°í•© ê°€ëŠ¥               |
| ì—ëŸ¬ ì „íŒŒ ìë™í™”        | `Option` ê¸°ë°˜ íë¦„ìœ¼ë¡œ ì‹¤íŒ¨ ì‹œ ì¦‰ì‹œ íƒˆì¶œ, ëª…ì‹œì  ì˜ˆì™¸ ì²˜ë¦¬ ë¶ˆí•„ìš” |


---

# ìµëª… í•¨ìˆ˜

ì´ í‘œí˜„ì€ Rustì—ì„œ **í•¨ìˆ˜ì²˜ëŸ¼ ë™ì‘í•˜ëŠ” í´ë¡œì €(closure)** ì…ë‹ˆë‹¤.  
ì •í™•íˆ ë§í•˜ë©´, ì´ê±´ ìµëª… í•¨ìˆ˜ ê°ì²´ë¡œì„œ Fn(usize, usize) -> T íƒ€ì…ì„ ë§Œì¡±í•˜ëŠ” **í•¨ìˆ˜í˜• ê°’(functional value)** ì…ë‹ˆë‹¤.

## âœ… ì´ í‘œí˜„ì€ í•¨ìˆ˜ì¸ê°€?
```rust
let f = { let s = self; move |u, v| s.method(u, v) };
```
- í•¨ìˆ˜ ì •ì˜ëŠ” ì•„ë‹˜ â†’ fn f(u: usize, v: usize) -> Tì²˜ëŸ¼ ëª…ì‹œì ì¸ í•¨ìˆ˜ ì„ ì–¸ì€ ì•„ë‹˜
- í•¨ìˆ˜ì²˜ëŸ¼ ë™ì‘í•˜ëŠ” ê°’ â†’ f(u, v)ì²˜ëŸ¼ í˜¸ì¶œ ê°€ëŠ¥
- íƒ€ì…ì€ impl Fn(usize, usize) -> T â†’ í•¨ìˆ˜ íŠ¸ë ˆì‡ì„ ë§Œì¡±í•˜ëŠ” í´ë¡œì €  
  ë”°ë¼ì„œ **í•¨ìˆ˜ì²˜ëŸ¼ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ê°’**, ì¦‰ í•¨ìˆ˜ ê°ì²´(function object) ë˜ëŠ” **ì¼ê¸‰ í•¨ìˆ˜(first-class function)** ë¡œ ë³´ëŠ” ê²Œ ì •í™•í•©ë‹ˆë‹¤.

## ğŸ§  ì™œ ì´ë ‡ê²Œ ì“°ëŠ”ê°€?

| ìš”ì†Œ     | ì„¤ëª…                                                                 |
|----------|----------------------------------------------------------------------|
| self     | í´ë¡œì € ë‚´ë¶€ì—ì„œ `self`ë¥¼ ì°¸ì¡°í•˜ë ¤ë©´ ì™¸ë¶€ì—ì„œ ìº¡ì²˜í•´ì•¼ í•¨             |
| move     | í´ë¡œì €ê°€ `self`ë¥¼ ì†Œìœ í•˜ê±°ë‚˜ ì•ˆì „í•˜ê²Œ ìº¡ì²˜í•˜ë„ë¡ ë³´ì¥               |
| í´ë¡œì €   | ë©”ì„œë“œë¥¼ `Fn(u,v)` í˜•íƒœë¡œ ë˜í•‘í•˜ì—¬ í•¨ìˆ˜ì²˜ëŸ¼ ì „ë‹¬ ê°€ëŠ¥               |
| get(&f)  | `Fn(u,v) -> Option<T>` íƒ€ì…ì„ ë°›ì•„ ì•ˆì „í•˜ê²Œ 4ê°œ ì½”ë„ˆ ê°’ì„ ìˆ˜ì§‘í•¨     |


## ğŸ” ë¹„êµ: í•¨ìˆ˜ vs í´ë¡œì €
| í‘œí˜„ ë°©ì‹                                      | ì„¤ëª…                                                                 |
|------------------------------------------------|----------------------------------------------------------------------|
| `fn f(u: usize, v: usize) -> T { ... }`        | ëª…ì‹œì  í•¨ìˆ˜ ì„ ì–¸. ìº¡ì²˜ ë¶ˆê°€ëŠ¥. ì „ì—­ì ì´ë©° íƒ€ì… ëª…ì‹œ í•„ìš”             |
| `let f = \|u, v\| ...`                           | í´ë¡œì €. ìº¡ì²˜ ê°€ëŠ¥. ì§€ì—­ ë³€ìˆ˜ë‚˜ í™˜ê²½ì„ ììœ ë¡­ê²Œ ì°¸ì¡° ê°€ëŠ¥             |
| `let f = { let s = self; move \|u, v\| s.method(u, v) }` | í´ë¡œì € + í™˜ê²½ ìº¡ì²˜. `self`ë¥¼ í´ë¡œì € ë‚´ë¶€ì—ì„œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ `move` í•„ìš” |


## âœ… ê²°ë¡ 
ì´ í‘œí˜„ì€ í•¨ìˆ˜ì²˜ëŸ¼ í˜¸ì¶œ ê°€ëŠ¥í•œ í´ë¡œì € ê°ì²´ì´ë©°, Rustì—ì„œëŠ” í•¨ìˆ˜ì™€ ë™ì¼í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ì¦‰, **í•¨ìˆ˜ë¡œ ë³¼ ìˆ˜ ìˆë‚˜?** ë¼ëŠ” ì§ˆë¬¸ì— ëŒ€í•œ ë‹µì€:
**ì •ì˜ëœ í•¨ìˆ˜ëŠ” ì•„ë‹ˆì§€ë§Œ, í•¨ìˆ˜ì²˜ëŸ¼ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” í´ë¡œì €ì…ë‹ˆë‹¤.**


## ğŸ” í•¨ìˆ˜ì²˜ëŸ¼ ë³´ì´ê²Œ ë°”ê¾¸ëŠ” íŒ
Rustì—ì„œëŠ” í´ë¡œì €ë„ í•¨ìˆ˜ì²˜ëŸ¼ ì‚¬ìš©í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì—, ì´ë¦„ì„ ì˜ ì§€ì–´ì£¼ê³ , íƒ€ì…ì„ ëª…ì‹œí•˜ë©´ í›¨ì”¬ í•¨ìˆ˜ì²˜ëŸ¼ ë³´ì¼ ìˆ˜ ìˆìŒ:
```rust
let call_method: &dyn Fn(usize, usize) -> Option<Vector3D> = &|u, v| self.method(u, v);
```

### í˜¹ì€:
```rust
let call_method = |u: usize, v: usize| -> Option<Vector3D> {
    self.method(u, v)
};
```
- ì´ë ‡ê²Œ ì“°ë©´ í•¨ìˆ˜ì²˜ëŸ¼ ë³´ì´ë©´ì„œë„ í´ë¡œì €ì˜ ì¥ì ì„ ê·¸ëŒ€ë¡œ ëˆ„ë¦´ ìˆ˜ ìˆìŒ.

## ğŸ§  ê¸°ì–µí•´ë‘ë©´ ì¢‹ì€ ì 

| í‚¤ì›Œë“œ / ê°œë… | ì„¤ëª…                                                                 |
|----------------|----------------------------------------------------------------------|
| fn             | ëª…ì‹œì  í•¨ìˆ˜ ì„ ì–¸. í™˜ê²½ ìº¡ì²˜ ë¶ˆê°€. ì „ì—­ì ì´ë©° íƒ€ì… ëª…ì‹œ í•„ìš”         |
| move           | í´ë¡œì €ê°€ ì™¸ë¶€ ê°’ì„ ìº¡ì²˜í•˜ê±°ë‚˜ ì†Œìœ í•˜ë„ë¡ ì§€ì •. selfë¥¼ ë‚´ë¶€ë¡œ ê°€ì ¸ì˜¬ ë•Œ í•„ìš” |
| Fn             | í´ë¡œì €ê°€ í•¨ìˆ˜ì²˜ëŸ¼ í˜¸ì¶œë˜ê¸° ìœ„í•´ êµ¬í˜„í•´ì•¼ í•˜ëŠ” íŠ¸ë ˆì‡ (`Fn`, `FnMut`, `FnOnce`) |
| í´ë¡œì €         | í™˜ê²½ì„ ìº¡ì²˜í•  ìˆ˜ ìˆëŠ” ìµëª… í•¨ìˆ˜ ê°ì²´. í•¨ìˆ˜ì²˜ëŸ¼ í˜¸ì¶œ ê°€ëŠ¥             |
| í•¨ìˆ˜ì²˜ëŸ¼ ì‚¬ìš©  | `let f = move \|u, v\| self.method(u, v)` â†’ `f(u, v)`ë¡œ í˜¸ì¶œ ê°€ëŠ¥       |

---
# ëª…ì‹œì  í•¨ìˆ˜

## âœ… 1. ëª…ì‹œì  í•¨ìˆ˜ë¡œ ë°”ê¾¸ëŠ” ë°©ì‹
Rustì—ì„œëŠ” í´ë¡œì €ì²˜ëŸ¼ í™˜ê²½ì„ ìº¡ì²˜í•˜ëŠ” ì¼ë°˜ í•¨ìˆ˜ë¥¼ ë§Œë“¤ ìˆ˜ëŠ” ì—†ìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ selfë¥¼ ì¸ìë¡œ ë„˜ê¸°ë©´ í•¨ìˆ˜ì²˜ëŸ¼ ë§Œë“¤ ìˆ˜ ìˆìŒ:
```rust
fn call_method(s: &HermiteSurface, u: usize, v: usize) -> Option<Vector3D> {
    s.method(u, v)
}
```

### ì‚¬ìš© ì‹œ:
```rust
let f = |u, v| call_method(self, u, v);
```
- ì´ê±´ í´ë¡œì €ì²˜ëŸ¼ ë³´ì´ì§€ë§Œ ë‚´ë¶€ëŠ” ëª…ì‹œì  í•¨ìˆ˜ í˜¸ì¶œì…ë‹ˆë‹¤.

## âœ… 2. êµ¬ì¡°ì²´ ê¸°ë°˜ í´ë¡œì € êµ¬í˜„
Rustì—ì„œëŠ” Fn íŠ¸ë ˆì‡ì„ ì§ì ‘ êµ¬í˜„í•´ì„œ í´ë¡œì €ì²˜ëŸ¼ ë™ì‘í•˜ëŠ” êµ¬ì¡°ì²´ë¥¼ ë§Œë“¤ ìˆ˜ ìˆìŒ:
```rust
struct MethodCaller<'a> {
    surface: &'a HermiteSurface,
}
``
```rust
impl<'a> MethodCaller<'a> {
    fn new(surface: &'a HermiteSurface) -> Self {
        Self { surface }
    }
}
```
```rust
impl<'a> FnOnce<(usize, usize)> for MethodCaller<'a> {
    type Output = Option<Vector3D>;

    extern "rust-call" fn call_once(self, args: (usize, usize)) -> Self::Output {
        self.surface.method(args.0, args.1)
    }
}
```
```rust
impl<'a> FnMut<(usize, usize)> for MethodCaller<'a> {
    extern "rust-call" fn call_mut(&mut self, args: (usize, usize)) -> Self::Output {
        self.surface.method(args.0, args.1)
    }
}
```
```rust
impl<'a> Fn<(usize, usize)> for MethodCaller<'a> {
    extern "rust-call" fn call(&self, args: (usize, usize)) -> Self::Output {
        self.surface.method(args.0, args.1)
    }
}
```

### ì‚¬ìš© ì‹œ:
```rust
let f = MethodCaller::new(self);
let result = f(u, v); // í•¨ìˆ˜ì²˜ëŸ¼ í˜¸ì¶œ ê°€ëŠ¥
```

## ğŸ§  ìš”ì•½

| í‚¤ì›Œë“œ / í‘œí˜„           | ì„¤ëª…                                                             |
|--------------------------|------------------------------------------------------------------|
| `move \|u,v\| ...`         | í´ë¡œì €ê°€ ì™¸ë¶€ ê°’ì„ ìº¡ì²˜í•˜ê±°ë‚˜ ì†Œìœ í•˜ë„ë¡ ì§€ì • (`self` í¬í•¨ ê°€ëŠ¥) |
| `self`                   | í´ë¡œì € ë‚´ë¶€ì—ì„œ ì‚¬ìš©í•˜ë ¤ë©´ `move`ë¡œ ìº¡ì²˜í•´ì•¼ í•¨                  |
| í´ë¡œì € + í™˜ê²½ ìº¡ì²˜       | `let f = { let s = self; move \|u,v\| s.method(u,v) }` í˜•íƒœë¡œ ì‚¬ìš© |






