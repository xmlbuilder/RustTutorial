
# deref coercion

## ì†ŒìŠ¤
```rust
trait Action {
    fn run(&self);
}

struct A;
struct B;

impl Action for A {
    fn run(&self) {
        println!("A runs fast");
    }
}

impl Action for B {
    fn run(&self) {
        println!("B runs slow");
    }
}

fn main() {
    let a: Box<dyn Action> = Box::new(A);
    let b: Box<dyn Action> = Box::new(B);

    a.run(); // prints "A runs fast"
    b.run(); // prints "B runs slow"
}
```

## ğŸ” ì™œ * ì—†ì´ë„ .run()ì´ ë˜ë‚˜?
```rust
let a: Box<dyn Action> = Box::new(A);
a.run(); // âœ… ë°”ë¡œ í˜¸ì¶œë¨!
```

Rustì—ì„œëŠ” Box<T>ê°€ Deref íŠ¸ë ˆì‡ì„ êµ¬í˜„í•˜ê³  ìˆì–´ì„œ,  
`a.run()` ì€ ë‚´ë¶€ì ìœ¼ë¡œ `(*a).run()` ìœ¼ë¡œ ìë™ ë³€í™˜.  
ì¦‰, Rustê°€ ìë™ìœ¼ë¡œ derefë¥¼ í•´ì£¼ëŠ” ê±°ì˜ˆìš”. ì´ê±¸ `deref coercion` ì´ë¼ê³  ë¶€ë¦…ë‹ˆë‹¤.  

## ğŸ§  deref coercionì´ë€?
| ê°œë…             | ì„¤ëª… ë˜ëŠ” ìˆ˜ì‹ í‘œí˜„                                 |
|------------------|----------------------------------------------------|
| `Deref` íŠ¸ë ˆì‡    | `Box<T>`ëŠ” `Deref`ë¥¼ êµ¬í˜„ â†’ `*box`ë¡œ ë‚´ë¶€ ê°’ ì ‘ê·¼ ê°€ëŠ¥ |
| ë©”ì„œë“œ í˜¸ì¶œ       | `.run()`ì€ ë‚´ë¶€ì ìœ¼ë¡œ `(*box).run()`ìœ¼ë¡œ ë³€í™˜ë¨       |
| trait ê°ì²´ í˜¸ì¶œ   | `Box<dyn Trait>.method()` â†’ `(*Box).method()` â†’ vtable lookup |


## âœ… ì˜ˆì‹œ ë¹„êµ
```rust
// ì§ì ‘ deref
(*a).run(); // OK

// ìë™ deref (ë” ì¼ë°˜ì ì´ê³  ê¹”ë”í•¨)
a.run();    // OK â€” ì»´íŒŒì¼ëŸ¬ê°€ ì•Œì•„ì„œ ì²˜ë¦¬
```


## âœ¨ ìš”ì•½ í…Œì´ë¸”
| í‘œí˜„ ë°©ì‹     | ì„¤ëª…                                      |
|---------------|-------------------------------------------|
| `a.run()`     | Rustê°€ ìë™ deref â†’ ë‚´ë¶€ ê°ì²´ì˜ ë©”ì„œë“œ í˜¸ì¶œ |
| `(*a).run()`  | ëª…ì‹œì  deref â†’ ê°™ì€ ê²°ê³¼ì§€ë§Œ ëœ ê¹”ë”í•¨     |
| deref coercion| Rustì˜ ìë™ deref ê¸°ëŠ¥ìœ¼ë¡œ ìƒëµ ê°€ëŠ¥        |


## ğŸ” Rustì—ì„œì˜ ë©”ì„œë“œ ì°¸ì¡° íë¦„
```rust
trait Action {
    fn run(&self);
}

struct A;
impl Action for A {
    fn run(&self) {
        println!("A runs");
    }
}

let a: Box<dyn Action> = Box::new(A);
a.run(); // âœ… ì—¬ê¸°ì„œ "ìê¸° í•¨ìˆ˜"ê°€ í˜¸ì¶œë¨
```

- `a.run()` ì€ ì‚¬ì‹¤ìƒ `(*a).run()` ìœ¼ë¡œ ìë™ ë³€í™˜ë¨ â†’ deref coercion
- `Box<dyn Action>` ëŠ” ë‚´ë¶€ì ìœ¼ë¡œ vtableì„ í†µí•´ Aì˜ run()ì„ ì°¸ì¡°í•´ì„œ ì‹¤í–‰
- ì´ê±´ **ìê¸° íƒ€ì…ì— ë§ëŠ” í•¨ìˆ˜ ì°¸ì¡°(reference)** ë¥¼ í†µí•´ ì‹¤í–‰ë˜ëŠ” ê±°ì˜ˆìš”

## ğŸ§  ìˆ˜ì‹ì²˜ëŸ¼ í‘œí˜„í•˜ë©´
```
a.run() â‰ˆ (*a).run() â‰ˆ vtable[run](&*a)
```

- vtable[run]ì€ Aê°€ êµ¬í˜„í•œ run() í•¨ìˆ˜ì˜ í¬ì¸í„°
- `&*a` ëŠ” Boxê°€ ê°€ë¦¬í‚¤ëŠ” ì‹¤ì œ ê°ì²´ì˜ ì°¸ì¡°
- ê²°êµ­ ìê¸° íƒ€ì…ì— ë§ëŠ” í•¨ìˆ˜ê°€ ì‹¤í–‰ë¨ â†’ â€œìê¸° í•¨ìˆ˜ referenceâ€ ì„!

## âœ… ìš”ì•½ í…Œì´ë¸”
| í‘œí˜„               | ì˜ë¯¸                                               |
|--------------------|----------------------------------------------------|
| `a.run()`          | ìë™ deref + vtable lookup                         |
| `(*a).run()`       | ëª…ì‹œì  deref â†’ ê°™ì€ ê²°ê³¼                           |
| `vtable[run](&*a)` | ì‹¤ì œ íƒ€ì…ì˜ ë©”ì„œë“œ ì°¸ì¡°ë¥¼ í†µí•´ ì‹¤í–‰ë¨              |


## y.abs() / *y.abs()
`y.abs()` ê°€ ë©ë‹ˆë‹¤.
`*y.abs()` ëŠ” ì•ˆ ë©ë‹ˆë‹¤.

### ğŸ” ì™œ y.abs()ê°€ ë˜ëŠ”ê°€?
```rust
let x = 32.0;
let y = &x;
y.abs(); // âœ… OK!
```
- f64 íƒ€ì…ì€ Copyì´ê¸° ë•Œë¬¸ì— &f64ë„ Derefë¥¼ í†µí•´ ìë™ìœ¼ë¡œ f64ì²˜ëŸ¼ ë™ì‘í•©ë‹ˆë‹¤.
- RustëŠ” deref coercionì„ í†µí•´ &x.abs()ë¥¼ ë‚´ë¶€ì ìœ¼ë¡œ (*x).abs()ë¡œ ë°”ê¿ˆ.
- ê·¸ë˜ì„œ y.abs()ëŠ” (*y).abs()ì™€ ê°™ê³ , ê²°êµ­ f64::abs()ê°€ í˜¸ì¶œë©ë‹ˆë‹¤.

### âŒ ì™œ *y.abs()ëŠ” ì•ˆ ë˜ëŠ”ê°€?
```rust
let x = 32.0;
let y = &x;
*y.abs(); // âŒ ì»´íŒŒì¼ ì—ëŸ¬!
```
- `y.abs()`ëŠ” f64 ê°’ì„ ë°˜í™˜í•©ë‹ˆë‹¤.
- `*y.abs()`ëŠ” f64 ê°’ì„ ë‹¤ì‹œ derefí•˜ë ¤ëŠ” ì‹œë„ì¸ë°, f64ëŠ” í¬ì¸í„°ê°€ ì•„ë‹ˆë¯€ë¡œ derefí•  ìˆ˜ ì—†ìŒ.
- ì¦‰, `*` ëŠ” ì°¸ì¡°ë¥¼ í•´ì œí•  ë•Œë§Œ ì“°ëŠ” ê±°ê³ , abs()ëŠ” ì´ë¯¸ ê°’ì´ë‹ˆê¹Œ derefí•  í•„ìš”ê°€ ì—†ìŒ.

âœ… ìš”ì•½ í…Œì´ë¸”
| í‘œí˜„        | ê²°ê³¼         | ì„¤ëª…                                      |
|-------------|--------------|-------------------------------------------|
| `y.abs()`   | âœ… OK         | `&f64` â†’ `f64`ë¡œ ìë™ deref í›„ ë©”ì„œë“œ í˜¸ì¶œ |
| `(*y).abs()`| âœ… OK         | ëª…ì‹œì  deref í›„ ë©”ì„œë“œ í˜¸ì¶œ               |
| `*y.abs()`  | âŒ ì—ëŸ¬       | `f64`ëŠ” í¬ì¸í„°ê°€ ì•„ë‹ˆë¯€ë¡œ deref ë¶ˆê°€       |

Rustì˜ deref coercion ë•ë¶„ì— ì½”ë“œê°€ í›¨ì”¬ ê¹”ë”í•´ì§€ê³  ì§ê´€ì .

## `*` ë¶™ì—¬ì•¼ í•˜ëŠ” ê²½ìš°

Rustì—ì„œ `*` ë¥¼ ë¶™ì—¬ì•¼ í•˜ëŠ” ê²½ìš°ëŠ” ì£¼ë¡œ **ì°¸ì¡°ë¥¼ í•´ì œ(dereference)** í•´ì„œ ê°’ ìì²´ì— ì ‘ê·¼í•˜ê±°ë‚˜ ìˆ˜ì •í•  ë•Œ.
ìë™ derefê°€ ì•ˆ ë˜ëŠ” ìƒí™©ë„ ìˆê³ , ëª…ì‹œì ìœ¼ë¡œ derefí•´ì•¼ë§Œ í•˜ëŠ” ê²½ìš°ë„ ìˆìŒ.

## ğŸ§ª 1. ê°’ ìˆ˜ì •í•  ë•ŒëŠ” ë°˜ë“œì‹œ * í•„ìš”
```rust
fn main() {
    let mut x = 10;
    let y = &mut x;

    *y += 5; // âœ… OK: yëŠ” &mut i32 â†’ *yë¡œ ê°’ì„ ìˆ˜ì •
    println!("{}", x); // 15
}
```

- &mut xëŠ” i32ì— ëŒ€í•œ ê°€ë³€ ì°¸ì¡°
- ê°’ì„ ë°”ê¾¸ë ¤ë©´ *yë¡œ derefí•´ì„œ ì§ì ‘ ìˆ˜ì •í•´ì•¼ í•¨

## ğŸ§® 2. ê°’ ìì²´ë¥¼ ë³µì‚¬í•˜ê±°ë‚˜ ë¹„êµí•  ë•Œ
``` rust
fn main() {
    let x = 42;
    let y = &x;

    let z = *y + 1; // âœ… OK: yëŠ” &i32 â†’ *yë¡œ ê°’ì„ êº¼ëƒ„
    println!("{}", z); // 43
}
```

- `*y` ëŠ” i32 ê°’ì„ êº¼ë‚´ëŠ” deref
- ì‚°ìˆ  ì—°ì‚° ë“±ì—ì„œëŠ” ê°’ì´ í•„ìš”í•˜ë¯€ë¡œ *ê°€ í•„ìš”í•¨

## ğŸ§  3. êµ¬ì¡°ì²´ í•„ë“œì— ì ‘ê·¼í•  ë•Œë„ * í•„ìš”í•  ìˆ˜ ìˆìŒ
```rust
struct Point {
    x: i32,
    y: i32,
}

fn main() {
    let p = Point { x: 1, y: 2 };
    let r = &p;

    println!("{}", (*r).x); // âœ… OK
    println!("{}", r.x); // âœ… OK
}
```
- êµ¬ì¡°ì²´ ì°¸ì¡°ì—ì„œ í•„ë“œ ì ‘ê·¼ì€ ìë™ derefê°€ ì•ˆ ë˜ëŠ” ê²½ìš°ê°€ ìˆì–´ìš”
- (*r).xì²˜ëŸ¼ ëª…ì‹œì ìœ¼ë¡œ derefí•´ì•¼ ì•ˆì „í•˜ê²Œ ì ‘ê·¼ ê°€ëŠ¥

## âœ… ìš”ì•½ í…Œì´ë¸”
| ìƒí™©                     | `*` í•„ìš” ì—¬ë¶€ | ì„¤ëª…                                       |
|--------------------------|----------------|--------------------------------------------|
| ê°’ ìˆ˜ì • (`&mut T`)       | âœ… í•„ìš”         | ì°¸ì¡°ë¥¼ í•´ì œí•˜ê³  ê°’ì„ ì§ì ‘ ìˆ˜ì •í•´ì•¼ í•¨       |
| ê°’ ë³µì‚¬/ë¹„êµ             | âœ… í•„ìš”         | ì°¸ì¡°ë¥¼ í•´ì œí•´ì„œ ê°’ ìì²´ë¥¼ êº¼ë‚´ì•¼ í•¨         |
| êµ¬ì¡°ì²´ í•„ë“œ ì ‘ê·¼          | âœ… í•„ìš”         | ìë™ derefê°€ ì•ˆ ë˜ëŠ” ê²½ìš° ëª…ì‹œì  deref í•„ìš” |
| ë©”ì„œë“œ í˜¸ì¶œ (`y.abs()`)  | âŒ ë¶ˆí•„ìš”       | deref coercionìœ¼ë¡œ ìë™ ì²˜ë¦¬ë¨              |


## ë©”ì†Œë“œ í˜¸ì¶œ ì‹œ

êµ¬ì¡°ì²´ì˜ ë©”ì„œë“œ í˜¸ì¶œ ì‹œ *ì´ í•„ìš”í•œì§€ ì—¬ë¶€ì— ëŒ€í•´ ì •ë¦¬.  
Rustì—ì„œëŠ” êµ¬ì¡°ì²´ì— ëŒ€í•´ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•  ë•Œë„ ìë™ derefê°€ ì‘ë™í•˜ì§€ë§Œ, ìƒí™©ì— ë”°ë¼ *ì´ í•„ìš”í•œ ê²½ìš°ê°€ ìˆìŒ.

## ğŸ§± ê¸°ë³¸ êµ¬ì¡°ì²´ ë©”ì„œë“œ í˜¸ì¶œ
```rust
struct Point {
    x: i32,
    y: i32,
}

impl Point {
    fn sum(&self) -> i32 {
        self.x + self.y
    }
}
```

## âœ… ì¼ë°˜ì ì¸ í˜¸ì¶œ
```rust
let p = Point { x: 1, y: 2 };
let r = &p;

r.sum();       // âœ… OK â€” ìë™ derefë¡œ &Point â†’ Point
(*r).sum();    // âœ… OK â€” ëª…ì‹œì  deref
```

- r.sum()ì€ (*r).sum()ìœ¼ë¡œ ìë™ ë³€í™˜ë¨ â†’ deref coercion
- selfê°€ &selfì´ë¯€ë¡œ &Pointë„ ë¬¸ì œ ì—†ì´ í˜¸ì¶œ ê°€ëŠ¥

## ğŸ”§ selfê°€ ê°’ íƒ€ì…ì¼ ë•ŒëŠ” * í•„ìš”
```rust
impl Point {
    fn consume(self) -> i32 {
        self.x * self.y
    }
}
```

### âŒ ì°¸ì¡°ë¡œëŠ” í˜¸ì¶œ ë¶ˆê°€
```rust
let r = &Point { x: 3, y: 4 };

// r.consume();      // âŒ ì—ëŸ¬: selfê°€ ê°’ì¸ë° rì€ ì°¸ì¡°
(*r).consume();      // âœ… OK â€” ëª…ì‹œì  derefë¡œ ê°’ ì „ë‹¬
````

- consume(self)ëŠ” Point ê°’ì„ ì§ì ‘ ìš”êµ¬í•¨
- &PointëŠ” ê°’ì´ ì•„ë‹ˆë¯€ë¡œ *rë¡œ derefí•´ì„œ ì „ë‹¬í•´ì•¼ í•¨

## âœ… ìš”ì•½ í…Œì´ë¸”
| ë©”ì„œë“œ íƒ€ì…      | ì°¸ì¡°ë¡œ í˜¸ì¶œ ê°€ëŠ¥ | `*` í•„ìš” ì—¬ë¶€       | ì„¤ëª…                                      |
|------------------|------------------|----------------------|-------------------------------------------|
| `fn foo(&self)`  | âœ… ê°€ëŠ¥           | âŒ ìë™ deref ë¨     | ì°¸ì¡°ë¡œë„ í˜¸ì¶œ ê°€ëŠ¥                        |
| `fn foo(self)`   | âŒ ë¶ˆê°€           | âœ… ëª…ì‹œì  deref í•„ìš” | ê°’ íƒ€ì… ìš”êµ¬ â†’ ì°¸ì¡°ëŠ” derefí•´ì„œ ì „ë‹¬í•´ì•¼ í•¨ |
| `fn foo(&mut self)` | âœ… ê°€ëŠ¥        | âŒ ìë™ deref ë¨     | ê°€ë³€ ì°¸ì¡°ë¡œë„ ìë™ deref ê°€ëŠ¥             |

ì´ì œ êµ¬ì¡°ì²´ ë©”ì„œë“œì—ì„œë„ ì–¸ì œ `*` ì´ í•„ìš”í•œì§€ ì™„ë²½í•˜ê²Œ ì´í•´ ê°€ëŠ¥.

---

# ì—°ì‚°ì ìš°ì„  ìˆœìœ„
ì—°ì‚°ì ìš°ì„  ìˆœìœ„(operator precedence) ë•Œë¬¸ì…ë‹ˆë‹¤.  
Rustì—ì„œëŠ” `.` ì—°ì‚°ì(ë©”ì„œë“œ í˜¸ì¶œ)ê°€ `*` ë³´ë‹¤ ìš°ì„ ìˆœìœ„ê°€ ë†’ê¸° ë•Œë¬¸ì—, ì•„ë˜ ì½”ë“œ:
```rust
*y.abs()
```

ì€ ì‹¤ì œë¡œ ì´ë ‡ê²Œ í•´ì„ë©ë‹ˆë‹¤:
```rust
*(y.abs())
```

ì¦‰, y.abs()ê°€ ë¨¼ì € ì‹¤í–‰ë˜ê³  ê·¸ ê²°ê³¼(íƒ€ì…: f64)ì— ëŒ€í•´ `*` ë¥¼ ì‹œë„.  
ê·¸ëŸ°ë° f64ëŠ” í¬ì¸í„°ê°€ ì•„ë‹ˆê¸° ë•Œë¬¸ì— `*` ë¡œ ì—­ì°¸ì¡°í•  ìˆ˜ ì—†ì–´ì„œ ì»´íŒŒì¼ ì—ëŸ¬ê°€ ë°œìƒí•©ë‹ˆë‹¤.

## âœ… ì˜¬ë°”ë¥¸ ë°©ì‹: ê´„í˜¸ë¡œ ìš°ì„ ìˆœìœ„ ì§€ì •
```rust
(*y).abs() // âœ… OK
```

- `*y`ê°€ ë¨¼ì € ì‹¤í–‰ë˜ì–´ f64 ê°’ì´ ë‚˜ì˜¤ê³ 
- ê·¸ ê°’ì— ëŒ€í•´ .abs() ë©”ì„œë“œë¥¼ í˜¸ì¶œ

## ğŸ” Rustì˜ ì—°ì‚°ì ìš°ì„ ìˆœìœ„ ìš”ì•½ (ì¼ë¶€)

| ì—°ì‚°ì | ìš°ì„ ìˆœìœ„ | ì˜ˆì‹œ           | ì„¤ëª…                                 |
|--------|-----------|----------------|--------------------------------------|
| `.`    | ë†’ìŒ      | `x.abs()`      | ë©”ì„œë“œ í˜¸ì¶œ ë˜ëŠ” í•„ë“œ ì ‘ê·¼           |
| `*`    | ì¤‘ê°„      | `*ptr`         | ì—­ì°¸ì¡° (í¬ì¸í„° í•´ì œ)                 |
| `()`   | ì œì–´ìš©     | `(*x).abs()`   | ê´„í˜¸ë¡œ ì—°ì‚°ì ìš°ì„ ìˆœìœ„ ëª…ì‹œ          |

---





