# unsafe
Rustì˜ unsafe ê¸°ëŠ¥ì€ ë‹¨ìˆœíˆ â€œìœ„í—˜í•œ ì½”ë“œâ€ë¥¼ í—ˆìš©í•˜ëŠ” ê²Œ ì•„ë‹ˆë¼, ì•ˆì „í•œ ì‹œìŠ¤í…œ í”„ë¡œê·¸ë˜ë°ì„ ìœ„í•œ ì œì–´ê¶Œì„ ê°œë°œìì—ê²Œ ë„˜ê²¨ì£¼ëŠ” ë„êµ¬. 
C#ì˜ unsafeì™€ ë¹„êµí•˜ë©´ì„œ, C++ê³¼ì˜ ì—°ë™ì—ì„œ ì–´ë–¤ ì¥ì ì´ ìˆëŠ”ì§€ë„ í•¨ê»˜ ì •ë¦¬.

## ğŸ§  Rustì˜ unsafeë€?
RustëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ë©”ëª¨ë¦¬ ì•ˆì „ì„±ì„ ë³´ì¥í•˜ëŠ” ì–¸ì–´ì…ë‹ˆë‹¤. í•˜ì§€ë§Œ ì‹œìŠ¤í…œ í”„ë¡œê·¸ë˜ë°ì—ì„œëŠ” ë•Œë•Œë¡œ ì €ìˆ˜ì¤€ ì‘ì—…ì´ í•„ìš”.  
ì´ë•Œ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ unsafeì…ë‹ˆë‹¤.
```rust
unsafe {
    let ptr = some_raw_pointer;
    *ptr = 42; // raw pointer dereference
}

```
## ğŸ”§ unsafeì—ì„œ í—ˆìš©ë˜ëŠ” ì‘ì—…
- raw pointer dereference (*const T, *mut T)
- unsafe í•¨ìˆ˜ í˜¸ì¶œ (extern "C" í¬í•¨)
- mutable static ë³€ìˆ˜ ì ‘ê·¼
- union í•„ë“œ ì ‘ê·¼
- FFI (Foreign Function Interface): C/C++ í•¨ìˆ˜ í˜¸ì¶œ
unsafeëŠ” Rustì˜ ì•ˆì „ì„± ëª¨ë¸ì„ ì ì‹œ ë²—ì–´ë‚˜ì§€ë§Œ, ì—¬ì „íˆ **ì»´íŒŒì¼ëŸ¬ì˜ ì¼ë¶€ ê²€ì‚¬(ì˜ˆ: íƒ€ì… ê²€ì‚¬)**ëŠ” ìœ ì§€ë©ë‹ˆë‹¤.



## ğŸ†š C#ì˜ unsafeì™€ ë¹„êµ
| í•­ëª©               | Rust `unsafe`                        | C# `unsafe`                          |
|--------------------|--------------------------------------|--------------------------------------|
| ëª©ì                | ì‹œìŠ¤í…œ ìˆ˜ì¤€ ì œì–´, FFI, ì„±ëŠ¥ ìµœì í™”     | í¬ì¸í„° ì—°ì‚°, ë„¤ì´í‹°ë¸Œ API ì ‘ê·¼         |
| ë©”ëª¨ë¦¬ ì•ˆì „ì„±      | ê¸°ë³¸ì ìœ¼ë¡œ ì•ˆì „, `unsafe`ë¡œ ì œì–´ê¶Œ ìœ„ì„ | ê¸°ë³¸ì ìœ¼ë¡œ ì•ˆì „, `unsafe`ë¡œ í¬ì¸í„° í—ˆìš© |
| ì‚¬ìš© ë°©ì‹          | `unsafe { ... }` ë¸”ë¡ ë˜ëŠ” í•¨ìˆ˜        | `unsafe` í‚¤ì›Œë“œë¡œ í•¨ìˆ˜/ë¸”ë¡ ì„ ì–¸       |
| FFI ì—°ë™           | `extern "C"`, `bindgen` ë“± ê°•ë ¥ ì§€ì›   | `DllImport`, `fixed` ë“± ì œí•œì  ì§€ì›    |
| ëŸ°íƒ€ì„ ê²€ì‚¬        | ì—†ìŒ (ì»´íŒŒì¼ íƒ€ì„ ì¤‘ì‹¬)                | ì¼ë¶€ ëŸ°íƒ€ì„ ê²€ì‚¬ ìˆìŒ                   |
| ì„±ëŠ¥               | C++ ìˆ˜ì¤€ì˜ ê³ ì„±ëŠ¥                      | .NET ëŸ°íƒ€ì„ ìœ„ì—ì„œ ë™ì‘                 |


RustëŠ” ì»´íŒŒì¼ íƒ€ì„ì— ì•ˆì „ì„±ì„ ê°•í•˜ê²Œ ë³´ì¥í•˜ê³ , unsafeëŠ” ê·¸ ê²½ê³„ë¥¼ ëª…í™•íˆ í‘œì‹œí•©ë‹ˆë‹¤.
C#ì€ ëŸ°íƒ€ì„ ê¸°ë°˜ ì–¸ì–´ì´ê¸° ë•Œë¬¸ì— unsafeëŠ” ì œí•œì ì´ë©°, ì£¼ë¡œ í¬ì¸í„° ì—°ì‚°ì— ì‚¬ìš©ë©ë‹ˆë‹¤.


## ğŸ¤ Rustì™€ C++ ì—°ë™ ì‹œ unsafeì˜ ì—­í• 
RustëŠ” C/C++ê³¼ ì—°ë™í•  ë•Œ **FFI (Foreign Function Interface)**ë¥¼ ì‚¬ìš©í•˜ë©°, ì´ ê³¼ì •ì€ ëŒ€ë¶€ë¶„ unsafeì…ë‹ˆë‹¤.  
ì´ìœ ëŠ”:
- RustëŠ” ì™¸ë¶€ í•¨ìˆ˜ì˜ ë©”ëª¨ë¦¬ ì•ˆì „ì„± ë³´ì¥ ë¶ˆê°€
- C/C++ì˜ í¬ì¸í„°, êµ¬ì¡°ì²´, ë©”ëª¨ë¦¬ ëª¨ë¸ì€ Rustì™€ ë‹¤ë¦„
- Rust ì»´íŒŒì¼ëŸ¬ëŠ” ì™¸ë¶€ ì½”ë“œì˜ ë™ì‘ì„ ì¶”ë¡ í•  ìˆ˜ ì—†ìŒ

## âœ¨ ì–»ì„ ìˆ˜ ìˆëŠ” ì¥ì 
| í•­ëª©                   | ì„¤ëª…                                                   |
|------------------------|--------------------------------------------------------|
| ê³ ì„±ëŠ¥ ë¼ì´ë¸ŒëŸ¬ë¦¬ í™œìš© | `OpenCV`, `BLAS`, `SQLite`, `zlib` ë“± C/C++ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì§ì ‘ ì‚¬ìš© ê°€ëŠ¥ |
| ì ì§„ì  ë§ˆì´ê·¸ë ˆì´ì…˜    | ê¸°ì¡´ C/C++ ì‹œìŠ¤í…œì„ Rustë¡œ ë¶€ë¶„ì ìœ¼ë¡œ ì´ì „ ê°€ëŠ¥           |
| ì•ˆì „ì„± ë„ì…            | í•µì‹¬ ë¡œì§ì€ Rustë¡œ ì‘ì„±í•´ ë©”ëª¨ë¦¬ ì˜¤ë¥˜ ë°©ì§€, ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” FFIë¡œ ì—°ê²° |
| ì„±ëŠ¥ ìœ ì§€              | C++ ìˆ˜ì¤€ì˜ ì„±ëŠ¥ì„ ìœ ì§€í•˜ë©´ì„œ Rustì˜ ì•ˆì „ì„± ëª¨ë¸ ì ìš© ê°€ëŠ¥   |
| ì‹œìŠ¤í…œ í†µí•©            | OS API, ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„, ë„¤ì´í‹°ë¸Œ ì½”ë“œì™€ ì§ì ‘ ì—°ë™ ê°€ëŠ¥     |

ì˜ˆ: Servo ë¸Œë¼ìš°ì €ëŠ” Rustë¡œ ì‘ì„±ë˜ì—ˆì§€ë§Œ, JavaScript ì—”ì§„ì€ C++ë¡œ ì‘ì„±ëœ SpiderMonkeyë¥¼ FFIë¡œ ì—°ë™í•©ë‹ˆë‹¤.


### âš ï¸ ì£¼ì˜í•  ì 
- unsafeëŠ” â€œë¬´ì¡°ê±´ ìœ„í—˜í•˜ë‹¤â€ëŠ” ëœ»ì´ ì•„ë‹ˆë¼, â€œê°œë°œìê°€ ì±…ì„ì§„ë‹¤â€ëŠ” ëœ»ì…ë‹ˆë‹¤.
- unsafe ë¸”ë¡ ì•ˆì—ì„œë„ íƒ€ì… ê²€ì‚¬, ë¼ì´í”„íƒ€ì„ ê²€ì‚¬ ì¼ë¶€ëŠ” ìœ ì§€ë©ë‹ˆë‹¤.
- C/C++ê³¼ ì—°ë™í•  ë•ŒëŠ” Null pointer, dangling pointer, buffer overflow ë“± ì „í†µì ì¸ ì˜¤ë¥˜ì— ì£¼ì˜í•´ì•¼ í•©ë‹ˆë‹¤.

## ğŸ§  ê²°ë¡ 
Rustì˜ unsafeëŠ” ì œì–´ê¶Œì„ ë„˜ê²¨ì£¼ëŠ” ë„êµ¬ì´ë©°,
C#ì˜ unsafeë³´ë‹¤ í›¨ì”¬ ê°•ë ¥í•˜ê³  ì •êµí•œ ì‹œìŠ¤í…œ í”„ë¡œê·¸ë˜ë°ì„ ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤.
íŠ¹íˆ C++ê³¼ ì—°ë™í•  ë•ŒëŠ” unsafeë¥¼ í†µí•´ ì„±ëŠ¥ê³¼ ì•ˆì •ì„±ì˜ ê· í˜•ì„ ì¡ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

# Cì™€ ì—°ë™

Rustì™€ Cë¥¼ ì—°ë™í•˜ëŠ” ê°€ì¥ ê¸°ë³¸ì ì¸ FFI ìƒ˜í”Œ ì½”ë“œì…ë‹ˆë‹¤. 
Rustì—ì„œ C í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ëŠ” êµ¬ì¡°. 
ì´ ì˜ˆì œëŠ” ê°„ë‹¨í•œ add í•¨ìˆ˜ë¥¼ Cì—ì„œ ì •ì˜í•˜ê³ , Rustì—ì„œ í˜¸ì¶œí•˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤.

## ğŸ§© 1. C ì½”ë“œ (add.c)
```rust
// add.c
int add(int a, int b) {
    return a + b;
}
```

## ğŸ”§ ì»´íŒŒì¼
```
gcc -c add.c -o add.o
```


## ğŸ§© 2. Rust ì½”ë“œ (main.rs)
```rust
extern "C" {
    fn add(a: i32, b: i32) -> i32;
}

fn main() {
    unsafe {
        let result = add(3, 4);
        println!("3 + 4 = {}", result);
    }
}
```

- extern "C": C ABIë¥¼ ë”°ë¥´ëŠ” ì™¸ë¶€ í•¨ìˆ˜ ì„ ì–¸
- unsafe: RustëŠ” ì™¸ë¶€ í•¨ìˆ˜ì˜ ì•ˆì „ì„±ì„ ë³´ì¥í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì— unsafe ë¸”ë¡ì—ì„œ í˜¸ì¶œ

## ğŸ› ï¸ 3. Cargo ì„¤ì • (Cargo.toml)
```
[package]
name = "rust_ffi_sample"
version = "0.1.0"
edition = "2021"

[build-dependencies]
cc = "1.0"
```


## ğŸ› ï¸ 4. ë¹Œë“œ ìŠ¤í¬ë¦½íŠ¸ (build.rs)
```rust
fn main() {
    cc::Build::new()
        .file("add.c")
        .compile("libadd.a");
}
```

- Rustì˜ cc í¬ë ˆì´íŠ¸ë¥¼ ì‚¬ìš©í•´ C ì½”ë“œë¥¼ ì»´íŒŒì¼í•˜ê³  ë§í¬

### ğŸ“¦ ìµœì¢… êµ¬ì¡°
```
rust_ffi_sample/
â”œâ”€â”€ Cargo.toml
â”œâ”€â”€ build.rs
â”œâ”€â”€ add.c
â””â”€â”€ src/
    â””â”€â”€ main.rs
```


### âœ… ì‹¤í–‰ ê²°ê³¼
```
cargo run
# ì¶œë ¥: 3 + 4 = 7
```


## ğŸ§  í™•ì¥ ì•„ì´ë””ì–´
- #[repr(C)] êµ¬ì¡°ì²´ë¥¼ ì‚¬ìš©í•´ Cì™€ Rust ê°„ ë°ì´í„° êµ¬ì¡° ê³µìœ 
- bindgenì„ ì‚¬ìš©í•´ C í—¤ë” íŒŒì¼ì„ ìë™ìœ¼ë¡œ Rust ë°”ì¸ë”© ìƒì„±
- C++ê³¼ ì—°ë™í•  ë•ŒëŠ” extern "C"ë¡œ name mangling ë°©ì§€



## ğŸ”§ Rustê°€ C ì½”ë“œë¥¼ "ì§ì ‘" ì»´íŒŒì¼í•˜ì§„ ì•Šì§€ë§Œâ€¦
RustëŠ” ìì²´ì ìœ¼ë¡œ C ì»´íŒŒì¼ëŸ¬ë¥¼ í¬í•¨í•˜ê³  ìˆì§€ ì•Šì•„ìš”. í•˜ì§€ë§Œ ë‹¤ìŒ ë°©ì‹ìœ¼ë¡œ C ì»´íŒŒì¼ì„ ìë™í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
### âœ… ë°©ë²• 1: cc í¬ë ˆì´íŠ¸ ì‚¬ìš©
```rust
// build.rs
fn main() {
    cc::Build::new()
        .file("src/add.c")
        .compile("libadd.a");
}
```

- Rustê°€ gcc ë˜ëŠ” clangì„ í˜¸ì¶œí•´ì„œ C íŒŒì¼ì„ ì»´íŒŒì¼
- ê²°ê³¼ëŠ” .a ì •ì  ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ ìƒì„±ë˜ì–´ Rustì— ë§í¬ë¨

### âœ… ë°©ë²• 2: bindgenìœ¼ë¡œ C í—¤ë” ìë™ ë°”ì¸ë”©
[build-dependencies]
bindgen = "0.68"


- C í—¤ë” íŒŒì¼ì„ ë¶„ì„í•´ì„œ Rustìš© FFI ë°”ì¸ë”©ì„ ìë™ ìƒì„±
- build.rsì—ì„œ bindgen::Builderë¥¼ ì‚¬ìš©

## ğŸ§  ìš”ì•½
| í•­ëª©               | ì„¤ëª…                                                   |
|--------------------|--------------------------------------------------------|
| Rust ìì²´ ì»´íŒŒì¼ëŸ¬ | C ì½”ë“œ ì»´íŒŒì¼ ê¸°ëŠ¥ ì—†ìŒ                                 |
| ìë™í™” ë°©ì‹        | `build.rs` + `cc` í¬ë ˆì´íŠ¸ë¡œ C ì»´íŒŒì¼ ìë™í™” ê°€ëŠ¥         |
| í•„ìš” ë„êµ¬          | ì‹œìŠ¤í…œì— `gcc`, `clang` ë“± C ì»´íŒŒì¼ëŸ¬ê°€ ì„¤ì¹˜ë˜ì–´ ìˆì–´ì•¼ í•¨ |
| ë¹Œë“œ í†µí•©          | Rust ë¹Œë“œ ì‹œ C ì½”ë“œë„ í•¨ê»˜ ì»´íŒŒì¼ë˜ì–´ ì¼ê´€ëœ í™˜ê²½ ìœ ì§€ ê°€ëŠ¥ |
| FFI ì—°ë™           | `extern "C"`ë¡œ C í•¨ìˆ˜ í˜¸ì¶œ, `#[repr(C)]`ë¡œ êµ¬ì¡°ì²´ ê³µìœ  ê°€ëŠ¥ |



# Lib ì—°ë™
Rustì—ì„œ ê¸°ì¡´ì˜ DLL (Windows), LIB (ì •ì  ë¼ì´ë¸ŒëŸ¬ë¦¬),  
ë˜ëŠ” **SO (Linux ê³µìœ  ë¼ì´ë¸ŒëŸ¬ë¦¬)**ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë°©ë²•ì€ **FFI (Foreign Function Interface)**ë¥¼ í†µí•´ ì´ë£¨ì–´ì§€ë©°,  
unsafeì™€ extern "C" í‚¤ì›Œë“œë¥¼ í™œìš©.

## ğŸ§© 1. Windows: .dll ë˜ëŠ” .lib ì‚¬ìš©
## ğŸ”§ DLL í•¨ìˆ˜ ì„ ì–¸
```rust
extern "C" {
    fn add(a: i32, b: i32) -> i32;
}
```

### ğŸ”§ DLL ë¡œë“œ ë°©ì‹
- ì •ì  ë§í¬: .lib íŒŒì¼ì„ í•¨ê»˜ ì œê³µë°›ì€ ê²½ìš°, cargo:rustc-link-libë¡œ ë§í¬
- ë™ì  ë¡œë”©: libloading í¬ë ˆì´íŠ¸ë¥¼ ì‚¬ìš©í•´ ëŸ°íƒ€ì„ì— DLLì„ ë¡œë“œ

```rust
use libloading::Library;

fn main() {
    unsafe {
        let lib = Library::new("your.dll").unwrap();
        let func: libloading::Symbol<unsafe extern fn(i32, i32) -> i32> =
            lib.get(b"add").unwrap();
        println!("Result: {}", func(2, 3));
    }
}
```

### ğŸ”§ build.rs ì„¤ì • ì˜ˆì‹œ
```rust
fn main() {
    println!("cargo:rustc-link-lib=dylib=yourlib");
    println!("cargo:rustc-link-search=native=path/to/lib");
}
```


## ğŸ§© 2. Linux/macOS: .so ë˜ëŠ” .a ì‚¬ìš©

### ğŸ”§ SO í•¨ìˆ˜ ì„ ì–¸
```rust
extern "C" {
    fn compute(x: f64) -> f64;
}
```

## ğŸ”§ ë§í¬ ì„¤ì •
```
# Cargo.toml
[build-dependencies]
cc = "1.0"
```
```rust
// build.rs
fn main() {
    println!("cargo:rustc-link-lib=dylib=yourlib");
    println!("cargo:rustc-link-search=native=./libs");
}
```

- .so íŒŒì¼ì€ LD_LIBRARY_PATHì— ê²½ë¡œë¥¼ ì¶”ê°€í•˜ê±°ë‚˜, ì‹¤í–‰ ì‹œ í™˜ê²½ ë³€ìˆ˜ë¡œ ì§€ì •

## ğŸ§  í•µì‹¬ ìš”ì•½
| í•­ëª©               | ì„¤ëª…                                                   |
|--------------------|--------------------------------------------------------|
| `extern "C"` + `unsafe` | C ABIë¡œ ì™¸ë¶€ í•¨ìˆ˜ ì„ ì–¸, ë©”ëª¨ë¦¬ ì•ˆì „ì„±ì€ ê°œë°œìê°€ ì±…ì„ì§     |
| `.lib`, `.a` + `cargo:rustc-link-lib` | ì •ì  ë¼ì´ë¸ŒëŸ¬ë¦¬ ë§í¬ë¥¼ ìœ„í•œ ë¹Œë“œ ì„¤ì • (`build.rs`ì—ì„œ ì‚¬ìš©) |
| `libloading` + `.dll`, `.so` | ë™ì  ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë”©ì„ ìœ„í•œ ëŸ°íƒ€ì„ API (`libloading` í¬ë ˆì´íŠ¸) |
| `#[repr(C)]`       | Cì™€ ë™ì¼í•œ ë©”ëª¨ë¦¬ ë ˆì´ì•„ì›ƒì„ ë³´ì¥í•˜ëŠ” êµ¬ì¡°ì²´ ì„ ì–¸ ë°©ì‹         |
| `#[no_mangle]`     | í•¨ìˆ˜ ì´ë¦„ì„ ê·¸ëŒ€ë¡œ ìœ ì§€í•´ Cì—ì„œ í˜¸ì¶œ ê°€ëŠ¥í•˜ê²Œ í•¨               |



## âœ¨ ì‹¤ì „ íŒ
- C/C++ ë¼ì´ë¸ŒëŸ¬ë¦¬ì™€ ì—°ë™í•  ë•ŒëŠ” ë°˜ë“œì‹œ í•¨ìˆ˜ ì‹œê·¸ë‹ˆì²˜ì™€ ABIë¥¼ ì •í™•íˆ ë§ì¶°ì•¼ í•©ë‹ˆë‹¤.
- bindgenì„ ì‚¬ìš©í•˜ë©´ C í—¤ë” íŒŒì¼ì„ ìë™ìœ¼ë¡œ Rust ë°”ì¸ë”©ìœ¼ë¡œ ë³€í™˜í•  ìˆ˜ ìˆì–´ í¸ë¦¬í•©ë‹ˆë‹¤.
- #[repr(C)] êµ¬ì¡°ì²´ë¥¼ ì‚¬ìš©í•˜ë©´ Cì™€ Rust ê°„ ë°ì´í„° êµ¬ì¡°ë¥¼ ì•ˆì „í•˜ê²Œ ê³µìœ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---
