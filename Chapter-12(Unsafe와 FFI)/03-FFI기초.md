# FFI Basic

FFI(Foreign Function Interface)ëŠ” Rustê°€ ë‹¤ë¥¸ ì–¸ì–´(C, C++, Python ë“±)ì™€ ì§ì ‘ ìƒí˜¸ì‘ìš©í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” ê¸°ëŠ¥.  
RustëŠ” ì•ˆì „ì„±ì„ ì¤‘ì‹œí•˜ëŠ” ì–¸ì–´ì§€ë§Œ, ì‹œìŠ¤í…œ í”„ë¡œê·¸ë˜ë°ì„ ìœ„í•´ ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ì™€ ì—°ê²°í•  ìˆ˜ ìˆì–´ì•¼ í•˜ë‹ˆê¹Œ FFIëŠ” ì•„ì£¼ ì¤‘ìš”í•œ ì—­í• .

## ğŸ§  FFIë€?
Foreign Function Interfaceì˜ ì¤„ì„ë§ë¡œ, Rust ì½”ë“œì—ì„œ ì™¸ë¶€ ì–¸ì–´(C ë“±)ì˜ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ê±°ë‚˜,  
ë°˜ëŒ€ë¡œ ì™¸ë¶€ì—ì„œ Rust í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” ì¸í„°í˜ì´ìŠ¤.


## ğŸ”§ Rustì—ì„œ C í•¨ìˆ˜ í˜¸ì¶œí•˜ê¸°
### 1. C ì½”ë“œ ì¤€ë¹„
```rust
// example.c
#include <stdio.h>

void hello() {
    printf("Hello from C!\n");
}

int add(int a, int b) {
    return a + b;
}
```

ì´ê±¸ ì»´íŒŒì¼í•´ì„œ ê³µìœ  ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ ë§Œë“¤ì–´ì•¼ í•´:
```
gcc -shared -o libexample.so -fPIC example.c
```


### 2. Rustì—ì„œ C í•¨ìˆ˜ ì„ ì–¸
```rust
#[link(name = "example")]
extern "C" {
    fn hello();
    fn add(a: i32, b: i32) -> i32;
}

fn main() {
    unsafe {
        hello(); // C í•¨ìˆ˜ í˜¸ì¶œ
        let result = add(5, 7);
        println!("5 + 7 = {}", result);
    }
}
```

- #[link(name = "example")]: libexample.soë¥¼ ë§í¬í•˜ë¼ëŠ” ì˜ë¯¸
- extern "C": C ABI(Application Binary Interface)ë¥¼ ë”°ë¥´ê² ë‹¤ëŠ” ì„ ì–¸
- unsafe: RustëŠ” ì™¸ë¶€ í•¨ìˆ˜ì˜ ì•ˆì „ì„±ì„ ë³´ì¥í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì— ë°˜ë“œì‹œ unsafe ë¸”ë¡ì—ì„œ í˜¸ì¶œí•´ì•¼ í•¨

## ğŸ§± Rust â†’ Cë¡œ í•¨ìˆ˜ ë‚´ë³´ë‚´ê¸°
```rust
#[no_mangle]
pub extern "C" fn rust_add(a: i32, b: i32) -> i32 {
    a + b
}
```

- #[no_mangle]: Rustê°€ í•¨ìˆ˜ ì´ë¦„ì„ ë³€ê²½í•˜ì§€ ì•Šë„ë¡ í•¨
- extern "C": Cì—ì„œ í˜¸ì¶œí•  ìˆ˜ ìˆë„ë¡ ABIë¥¼ ë§ì¶¤
ì´ë ‡ê²Œ í•˜ë©´ Cì—ì„œ rust_addë¥¼ ì§ì ‘ í˜¸ì¶œí•  ìˆ˜ ìˆìŒ.

## ğŸ§µ ë¬¸ìì—´ê³¼ êµ¬ì¡°ì²´ ë‹¤ë£° ë•Œ ì£¼ì˜ì 
- ë¬¸ìì—´ì€ CStringê³¼ CStrë¥¼ ì‚¬ìš©í•´ ë³€í™˜í•´ì•¼ ì•ˆì „í•¨
- êµ¬ì¡°ì²´ëŠ” #[repr(C)]ë¥¼ ë¶™ì—¬ì„œ Cì™€ ë©”ëª¨ë¦¬ ë ˆì´ì•„ì›ƒì„ ë§ì¶°ì•¼ í•¨
- í¬ì¸í„°ëŠ” ë°˜ë“œì‹œ null ì²´í¬, ìœ íš¨ì„± ê²€ì‚¬, ë©”ëª¨ë¦¬ ì†Œìœ ê¶Œ ê´€ë¦¬ê°€ í•„ìš”

## ğŸ›¡ï¸ ì•ˆì „í•˜ê²Œ FFI ì“°ëŠ” íŒ
- ì™¸ë¶€ í•¨ìˆ˜ëŠ” ì•ˆì „í•œ wrapper í•¨ìˆ˜ë¡œ ê°ì‹¸ëŠ” ê²Œ ì¢‹ìŒ
- bindgenì„ ì‚¬ìš©í•˜ë©´ C í—¤ë” íŒŒì¼ì„ ìë™ìœ¼ë¡œ Rust ë°”ì¸ë”©ìœ¼ë¡œ ë³€í™˜ ê°€ëŠ¥
- ë©”ëª¨ë¦¬ ê´€ë¦¬ëŠ” ëª…í™•í•˜ê²Œ, ëˆ„ìˆ˜ ì—†ê²Œ!

## ğŸ¯ ìš”ì•½: Rustì˜ FFI ì‚¬ìš© í•µì‹¬
| ì‘ì—… ì˜ˆì‹œ               | ì„¤ëª…                                      |
|------------------------|-------------------------------------------|
| ì™¸ë¶€ C í•¨ìˆ˜ ì„ ì–¸        | `extern "C"`ë¡œ í•¨ìˆ˜ ì‹œê·¸ë‹ˆì²˜ ì •ì˜          |
| ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë§í¬    | `#[link(name = "libname")]`ë¡œ ì—°ê²°         |
| Rust í•¨ìˆ˜ Cì— ë…¸ì¶œ      | `#[no_mangle] pub extern "C" fn ...` ì‚¬ìš© |
| êµ¬ì¡°ì²´ êµí™˜             | `#[repr(C)]`ë¡œ ë©”ëª¨ë¦¬ ë ˆì´ì•„ì›ƒ ë§ì¶¤       |
| ë¬¸ìì—´ êµí™˜             | `CString`, `CStr`ë¡œ ì•ˆì „í•˜ê²Œ ë³€í™˜         |
| í˜¸ì¶œ ì‹œ ì•ˆì „ì„± ë³´ì¥     | `unsafe` ë¸”ë¡ì—ì„œë§Œ ì™¸ë¶€ í•¨ìˆ˜ í˜¸ì¶œ ê°€ëŠ¥   |

FFIëŠ” Rustì˜ ì•ˆì „ì„±ê³¼ ì„±ëŠ¥ì„ ìœ ì§€í•˜ë©´ì„œë„ ì™¸ë¶€ ì„¸ê³„ì™€ ì—°ê²°í•  ìˆ˜ ìˆëŠ” ê°•ë ¥í•œ ë„êµ¬. 

---

# Rust / C#

Rustì™€ C#ì€ ì„œë¡œ ë‹¤ë¥¸ ì„¸ê³„ì²˜ëŸ¼ ë³´ì¼ ìˆ˜ ìˆì§€ë§Œ, **FFI(Foreign Function Interface)**ë¥¼ í†µí•´ ì•„ì£¼ ì˜ ì—°ë™í•  ìˆ˜ ìˆìŒ.  
í•µì‹¬ì€ Rustì—ì„œ C ABIë¥¼ ë”°ë¥´ëŠ” ë°©ì‹ìœ¼ë¡œ í•¨ìˆ˜ë¥¼ ë…¸ì¶œí•˜ê³ , C#ì—ì„œ DllImportë¥¼ í†µí•´ ê·¸ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ëŠ” ê±°ì•¼.

## ğŸ”— Rust â†” C# ì—°ë™ ê°œìš”
### âœ… Rust ìª½: C ìŠ¤íƒ€ì¼ë¡œ í•¨ìˆ˜ ë…¸ì¶œ
```rust
#[no_mangle]
pub extern "C" fn add(a: i32, b: i32) -> i32 {
    a + b
}
```

- #[no_mangle]: í•¨ìˆ˜ ì´ë¦„ì„ ê·¸ëŒ€ë¡œ ìœ ì§€
- extern "C": C ABIë¥¼ ë”°ë¦„ â†’ C#ì—ì„œ í˜¸ì¶œ ê°€ëŠ¥
ì´ ì½”ë“œë¥¼ .dll ë˜ëŠ” .soë¡œ ë¹Œë“œí•´ì•¼ í•´:
```
cargo build --release
```

Windowsë¼ë©´ .dll, LinuxëŠ” .so, macOSëŠ” .dylibì´ ìƒì„±ë¼.

## âœ… C# ìª½: DllImportë¡œ Rust í•¨ìˆ˜ í˜¸ì¶œ
```csharp
using System;
using System.Runtime.InteropServices;

class Program
{
    [DllImport("your_rust_lib", CallingConvention = CallingConvention.Cdecl)]
    public static extern int add(int a, int b);

    static void Main()
    {
        int result = add(3, 4);
        Console.WriteLine($"3 + 4 = {result}");
    }
}
```

- "your_rust_lib"ëŠ” Rustì—ì„œ ë§Œë“  DLL ì´ë¦„ (í™•ì¥ì ì—†ì´)
- CallingConvention.Cdeclì€ Rustì˜ ê¸°ë³¸ í˜¸ì¶œ ë°©ì‹

## ğŸ§  êµ¬ì¡°ì²´ë‚˜ enumë„ ê°€ëŠ¥í• ê¹Œ?
ê°€ëŠ¥í•´! ë‹¨, Rust ìª½ì—ì„œ #[repr(C)]ë¥¼ ë¶™ì—¬ì„œ ë©”ëª¨ë¦¬ ë ˆì´ì•„ì›ƒì„ Cì™€ í˜¸í™˜ë˜ê²Œ ë§Œë“¤ì–´ì•¼ í•¨.  
ì˜ˆë¥¼ ë“¤ì–´:
```rust
#[repr(C)]
pub struct Point {
    x: f64,
    y: f64,
}
```

## C#ì—ì„œëŠ” ì´ë ‡ê²Œ ëŒ€ì‘:
```rust
[StructLayout(LayoutKind.Sequential)]
public struct Point {
    public double x;
    public double y;
}
```


## ğŸ› ï¸ ë„êµ¬ ì¶”ì²œ
- csharp_binderëŠ” Rust ì½”ë“œë¥¼ ìë™ìœ¼ë¡œ C# ë°”ì¸ë”©ìœ¼ë¡œ ë³€í™˜í•´ì£¼ëŠ” ë„êµ¬ì•¼
- rust-csharp-ffi ì˜ˆì œ í”„ë¡œì íŠ¸ë„ ì°¸ê³ í•  ë§Œí•´
- Rustì™€ .NET 9 í†µí•© ê°€ì´ë“œëŠ” ì„±ëŠ¥ ìµœì í™”ê¹Œì§€ ë‹¤ë¤„

## ğŸ¯ ìš”ì•½: Rust â†” C# FFI ì—°ë™ í•µì‹¬ ë¹„êµ
| í•­ëª©               | Rust ì¸¡ êµ¬í˜„                          | C# ì¸¡ í˜¸ì¶œ ë°©ì‹                        |
|--------------------|----------------------------------------|----------------------------------------|
| í•¨ìˆ˜ ë…¸ì¶œ ë°©ì‹      | `#[no_mangle] extern "C"`              | `[DllImport(...)]`                     |
| êµ¬ì¡°ì²´ í˜¸í™˜         | `#[repr(C)] struct`                    | `[StructLayout(...)] struct`           |
| ë¹Œë“œ ê²°ê³¼ë¬¼         | `.dll`, `.so`, `.dylib`                | í•´ë‹¹ í”Œë«í¼ì— ë§ëŠ” DLL ë¡œë”©            |
| í˜¸ì¶œ ì•ˆì „ì„±         | `unsafe` ë¸”ë¡ì—ì„œ í˜¸ì¶œ í•„ìš”            | `CallingConvention.Cdecl`ë¡œ ABI ì§€ì •   |


---


