## ğŸ§  Rustì—ì„œ ë¦¬í”Œë ‰ì…˜ê³¼ ë©”íƒ€ í”„ë¡œê·¸ë˜ë° í•˜ëŠ” ë²•

RustëŠ” ì „í†µì ì¸ ë¦¬í”Œë ‰ì…˜(reflection)ì„ ì§€ì›í•˜ì§€ ì•Šì§€ë§Œ, 
**ë©”íƒ€ í”„ë¡œê·¸ë˜ë°(metaprogramming)** ì€ ê°•ë ¥í•œ ë§¤í¬ë¡œ ì‹œìŠ¤í…œì„ í†µí•´ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
ì•„ë˜ì— ì£¼ìš” ë°©ë²•ë“¤ì„ ì •ë¦¬:

## ğŸ§  Rustì—ì„œ ë¦¬í”Œë ‰ì…˜ì€ ì™œ ì œí•œì ì¼ê¹Œ?
RustëŠ” ì •ì  íƒ€ì… ì‹œìŠ¤í…œê³¼ ì»´íŒŒì¼ íƒ€ì„ ì•ˆì „ì„±ì„ ì¤‘ì‹œí•˜ê¸° ë•Œë¬¸ì—, Javaë‚˜ Pythonì²˜ëŸ¼ ëŸ°íƒ€ì„ì— íƒ€ì… ì •ë³´ë¥¼ ì¡°íšŒí•˜ê±°ë‚˜ ìˆ˜ì •í•˜ëŠ” ë¦¬í”Œë ‰ì…˜ ê¸°ëŠ¥ì€ ì œê³µí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.  
ëŒ€ì‹ , ì»´íŒŒì¼ íƒ€ì„ì— ì½”ë“œ ìƒì„±ì„ ìë™í™”í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ë©”íƒ€ í”„ë¡œê·¸ë˜ë°ì„ êµ¬í˜„í•©ë‹ˆë‹¤.

## ğŸ› ï¸ Rust ë©”íƒ€ í”„ë¡œê·¸ë˜ë°ì˜ í•µì‹¬: ë§¤í¬ë¡œ ì‹œìŠ¤í…œ
### 1. ì„ ì–¸ì  ë§¤í¬ë¡œ (macro_rules!)
- ê°€ì¥ ê¸°ë³¸ì ì¸ ë§¤í¬ë¡œ ë°©ì‹
- íŒ¨í„´ ë§¤ì¹­ì„ í†µí•´ ì½”ë“œ ì¡°ê°ì„ ìƒì„±
- ì˜ˆì‹œ:
```rust
macro_rules! say_hello {
    () => {
        println!("Hello!");
    };
}

fn main() {
    say_hello!(); // Hello! ì¶œë ¥
}
```

- ë°˜ë³µë˜ëŠ” ì½”ë“œë¥¼ ì¤„ì´ê³ , ë„ë©”ì¸ íŠ¹í™” ì–¸ì–´(DSL)ë¥¼ ë§Œë“¤ ë•Œ ìœ ìš©
### 2. ì ˆì°¨ì  ë§¤í¬ë¡œ (Procedural Macros)
- ë” ë³µì¡í•œ ì½”ë“œ ìƒì„±ì„ ìœ„í•´ ì‚¬ìš©
- #[derive], #[attribute], #[function_like] í˜•íƒœë¡œ ì‚¬ìš©
- ì˜ˆì‹œ: êµ¬ì¡°ì²´ì— ë©”ì„œë“œë¥¼ ìë™ìœ¼ë¡œ ì¶”ê°€í•˜ëŠ” ë§¤í¬ë¡œ

```rust
use proc_macro::TokenStream;

#[proc_macro_attribute]
pub fn add_hello(attr: TokenStream, item: TokenStream) -> TokenStream {
    let attr = attr.to_string();
    let mut item = item.to_string();
    let hello_fn = format!("fn hello(&self) {{ println!(\"Hello, {}!\"); }}", attr);
    item.push_str(&hello_fn);
    item.parse().unwrap()
}

#[add_hello("world")]
struct Greeter;

fn main() {
    let greeter = Greeter;
    greeter.hello(); // Hello, world! ì¶œë ¥
}
```
- proc_macro í¬ë ˆì´íŠ¸ë¥¼ í†µí•´ êµ¬í˜„í•˜ë©°, ì™¸ë¶€ crateë¡œ ë¶„ë¦¬í•´ì•¼ í•¨

## ğŸ§© 1ë‹¨ê³„: ë§¤í¬ë¡œ ì •ì˜
```rust
#[proc_macro_attribute]
pub fn add_hello(attr: TokenStream, item: TokenStream) -> TokenStream {
```

- #[proc_macro_attribute]: ì´ í•¨ìˆ˜ê°€ attribute macroì„ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.
- add_hello: ë§¤í¬ë¡œ ì´ë¦„ì…ë‹ˆë‹¤. ì‚¬ìš© ì‹œ #[add_hello("world")]ì²˜ëŸ¼ êµ¬ì¡°ì²´ ìœ„ì— ë¶™ì…ë‹ˆë‹¤.
- attr: ë§¤í¬ë¡œì— ì „ë‹¬ëœ ì¸ì "world"ê°€ ë“¤ì–´ì˜µë‹ˆë‹¤.
- item: ë§¤í¬ë¡œê°€ ì ìš©ëœ ì½”ë“œ ì¡°ê° (struct Greeter)ì´ ë“¤ì–´ì˜µë‹ˆë‹¤.

## ğŸ§© 2ë‹¨ê³„: ë¬¸ìì—´ë¡œ ë³€í™˜
```rust
let attr = attr.to_string();
let mut item = item.to_string();
```

- TokenStreamì€ Rustì˜ í† í° ìŠ¤íŠ¸ë¦¼ íƒ€ì…ìœ¼ë¡œ, ì½”ë“œ ì¡°ê°ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.
- to_string()ì„ í†µí•´ "world"ì™€ struct Greeter;ë¥¼ ë¬¸ìì—´ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.

## ğŸ§© 3ë‹¨ê³„: ë©”ì„œë“œ ìƒì„±
```rust
let hello_fn = format!("fn hello(&self) {{ println!(\"Hello, {}!\"); }}", attr);
```

- hello_fnì€ êµ¬ì¡°ì²´ì— ì¶”ê°€í•  ë©”ì„œë“œì…ë‹ˆë‹¤.
- attr ê°’ "world"ë¥¼ í¬í•¨í•œ hello() ë©”ì„œë“œë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
- ê²°ê³¼:
```rust
fn hello(&self) {
    println!("Hello, world!");
}
```

## ğŸ§© 4ë‹¨ê³„: ì›ë˜ ì½”ë“œì— ë©”ì„œë“œ ì¶”ê°€
```rust
item.push_str(&hello_fn);
```

- ì›ë˜ êµ¬ì¡°ì²´ ì •ì˜ ë’¤ì— hello() ë©”ì„œë“œë¥¼ ë¬¸ìì—´ë¡œ ë¶™ì…ë‹ˆë‹¤.
- ìµœì¢…ì ìœ¼ë¡œ ë‹¤ìŒê³¼ ê°™ì€ ì½”ë“œê°€ ë©ë‹ˆë‹¤:
```rust
struct Greeter;
fn hello(&self) {
    println!("Hello, world!");
}
```


## ğŸ§© 5ë‹¨ê³„: ë‹¤ì‹œ TokenStreamìœ¼ë¡œ ë³€í™˜
```rust
item.parse().unwrap()
```

- ë¬¸ìì—´ë¡œ í•©ì³ì§„ ì½”ë“œë¥¼ ë‹¤ì‹œ TokenStreamìœ¼ë¡œ ë³€í™˜í•˜ì—¬ ì»´íŒŒì¼ëŸ¬ì— ë°˜í™˜í•©ë‹ˆë‹¤.
- unwrap()ì€ ë³€í™˜ ì‹¤íŒ¨ ì‹œ panicì„ ë°œìƒì‹œí‚µë‹ˆë‹¤.

## ğŸ§© 6ë‹¨ê³„: ë§¤í¬ë¡œ ì‚¬ìš©
```rust
#[add_hello("world")]
struct Greeter;
```

- ì´ êµ¬ì¡°ì²´ëŠ” add_hello ë§¤í¬ë¡œì— ì˜í•´ hello() ë©”ì„œë“œë¥¼ ìë™ìœ¼ë¡œ ê°–ê²Œ ë©ë‹ˆë‹¤.
- ì‚¬ìš© ì˜ˆ:
```rust
fn main() {
    let g = Greeter;
    g.hello(); // Hello, world!
}
```


## ğŸ§  ë³´ì¶© ì„¤ëª…
- ì´ ë§¤í¬ë¡œëŠ” ë§¤ìš° ë‹¨ìˆœí•œ ë°©ì‹ìœ¼ë¡œ ë™ì‘í•˜ë©°, ì‹¤ì œë¡œëŠ” synê³¼ quote í¬ë ˆì´íŠ¸ë¥¼ ì‚¬ìš©í•´ ë” ì•ˆì „í•˜ê³  ì •êµí•˜ê²Œ êµ¬í˜„í•˜ëŠ” ê²ƒì´ ì¼ë°˜ì ì…ë‹ˆë‹¤.
- í˜„ì¬ ë°©ì‹ì€ êµ¬ì¡°ì²´ ë‚´ë¶€ì— ë©”ì„œë“œë¥¼ ë„£ì§€ ì•Šê³ , êµ¬ì¡°ì²´ ì™¸ë¶€ì— ë©”ì„œë“œë¥¼ ì •ì˜í•˜ê¸° ë•Œë¬¸ì— impl ë¸”ë¡ì´ í•„ìš”í•©ë‹ˆë‹¤.

---


##  ğŸ” ë¦¬í”Œë ‰ì…˜ ëŒ€ì²´ ë°©ë²•
Rustì—ì„œ ë¦¬í”Œë ‰ì…˜ì´ í•„ìš”í•  ë•ŒëŠ” ë‹¤ìŒê³¼ ê°™ì€ ë°©ì‹ìœ¼ë¡œ ëŒ€ì²´í•©ë‹ˆë‹¤:
- Serde: ëŸ°íƒ€ì„ì— êµ¬ì¡°ì²´ë¥¼ JSON ë“±ìœ¼ë¡œ ì§ë ¬í™”/ì—­ì§ë ¬í™”í•˜ë©° íƒ€ì… ì •ë³´ë¥¼ ê°„ì ‘ì ìœ¼ë¡œ í™œìš©
- syn + quote: ì ˆì°¨ì  ë§¤í¬ë¡œì—ì„œ ASTë¥¼ íŒŒì‹±í•˜ê³  ì½”ë“œ ìƒì„±
- TypeId: std::any::TypeIdë¥¼ í†µí•´ íƒ€ì… ë¹„êµëŠ” ê°€ëŠ¥í•˜ì§€ë§Œ, íƒ€ì… ì´ë¦„ì´ë‚˜ í•„ë“œ ì¡°íšŒëŠ” ë¶ˆê°€ëŠ¥


ì´ì œ #[derive(Serialize, Deserialize)]ë¥¼ ë¶™ì¸ êµ¬ì¡°ì²´ Personì„ synê³¼ quoteë¥¼ ì‚¬ìš©í•´ì„œ ì ˆì°¨ì  ë§¤í¬ë¡œë¡œ í™•ì¥í•˜ê³ , 
ë³€ìˆ˜ì™€ ì—°ë™ë˜ëŠ” ë°©ì‹ê¹Œì§€ ë‹¨ê³„ë³„ë¡œ ì„¤ëª….

## ğŸ¯ ëª©í‘œ
- #[auto_hello] ë§¤í¬ë¡œë¥¼ Person êµ¬ì¡°ì²´ì— ë¶™ì´ë©´,
- êµ¬ì¡°ì²´ ë‚´ë¶€ í•„ë“œ(name, age)ë¥¼ í™œìš©í•´ ìë™ìœ¼ë¡œ hello() ë©”ì„œë“œë¥¼ ìƒì„±
- ì´ ë©”ì„œë“œëŠ” ë³€ìˆ˜ì™€ ì—°ë™ë˜ì–´ println!ìœ¼ë¡œ ì¸ì‚¬ ë©”ì‹œì§€ë¥¼ ì¶œë ¥

## ğŸ“¦ 1ë‹¨ê³„: í”„ë¡œì íŠ¸ ì„¤ì •
`Cargo.toml`
```
[lib]
proc-macro = true

[dependencies]
syn = { version = "2.0", features = ["full"] }
quote = "1.0"
proc-macro2 = "1.0"
```


## ğŸ§¬ 2ë‹¨ê³„: ë§¤í¬ë¡œ êµ¬í˜„
```rust
use proc_macro::TokenStream;
use quote::quote;
use syn::{parse_macro_input, DeriveInput, Data, Fields};

#[proc_macro_attribute]
pub fn auto_hello(_attr: TokenStream, item: TokenStream) -> TokenStream {
    // 1. êµ¬ì¡°ì²´ íŒŒì‹±
    let input = parse_macro_input!(item as DeriveInput);
    let struct_name = &input.ident;

    // 2. í•„ë“œ ì¶”ì¶œ
    let fields = match &input.data {
        Data::Struct(data_struct) => match &data_struct.fields {
            Fields::Named(named_fields) => &named_fields.named,
            _ => panic!("Expected named fields"),
        },
        _ => panic!("Expected a struct"),
    };

    // 3. nameê³¼ age í•„ë“œ ì°¾ê¸°
    let mut name_field = None;
    let mut age_field = None;

    for field in fields {
        let ident = field.ident.as_ref().unwrap().to_string();
        match ident.as_str() {
            "name" => name_field = Some(field.ident.clone().unwrap()),
            "age" => age_field = Some(field.ident.clone().unwrap()),
            _ => {}
        }
    }

    let name_field = name_field.expect("Missing 'name' field");
    let age_field = age_field.expect("Missing 'age' field");

    // 4. ì½”ë“œ ìƒì„±
    let expanded = quote! {
        #[derive(Serialize, Deserialize)]
        #input

        impl #struct_name {
            pub fn hello(&self) {
                println!("ì•ˆë…•í•˜ì„¸ìš”, ì €ëŠ” {}ì´ê³  {}ì‚´ì…ë‹ˆë‹¤.", self.#name_field, self.#age_field);
            }
        }
    };

    TokenStream::from(expanded)
}
```

## ğŸ§ª 3ë‹¨ê³„: êµ¬ì¡°ì²´ì— ë§¤í¬ë¡œ ì ìš©
```rust
use my_macro::auto_hello;

#[auto_hello]
struct Person {
    name: String,
    age: u32,
}
```


## ğŸ§ª 4ë‹¨ê³„: ë³€ìˆ˜ì™€ ì—°ë™
```rust
fn main() {
    let user = Person {
        name: String::from("JungHwan"),
        age: 30,
    };

    user.hello(); // ìë™ ìƒì„±ëœ ë©”ì„œë“œ í˜¸ì¶œ
}
```

ì¶œë ¥ ê²°ê³¼:
```
ì•ˆë…•í•˜ì„¸ìš”, ì €ëŠ” JungHwanì´ê³  30ì‚´ì…ë‹ˆë‹¤.
```


## ğŸ§  ì ˆì°¨ ìš”ì•½
| ë‹¨ê³„               | ì„¤ëª…                             |
|--------------------|----------------------------------|
| parse_macro_input! | TokenStreamì„ ASTë¡œ íŒŒì‹±         |
| Data::Struct       | êµ¬ì¡°ì²´ì¸ì§€ í™•ì¸                  |
| Fields::Named      | í•„ë“œ ì´ë¦„ ì¶”ì¶œ                   |
| quote!             | impl ë¸”ë¡ê³¼ hello() ë©”ì„œë“œ ìƒì„±  |
| TokenStream::from  | ìµœì¢… ì½”ë“œ ë°˜í™˜                   |



## ğŸ’¡ í™•ì¥ ì•„ì´ë””ì–´
- nameê³¼ age ì™¸ ë‹¤ë¥¸ í•„ë“œë„ ìë™ìœ¼ë¡œ ì¸ì‚¬ì— í¬í•¨
- serde_jsonê³¼ ì—°ë™í•´ JSONìœ¼ë¡œ ì§ë ¬í™” í›„ ì¶œë ¥
- #[auto_debug], #[auto_builder] ê°™ì€ ë§¤í¬ë¡œë¡œ í™•ì¥ ê°€ëŠ¥

---

# DeriveInput, Data, Fields, Field
DeriveInput, Data, Fields, Fieldê°€ ì–´ë–¤ ì—­í• ì„ í•˜ëŠ”ì§€ ì •í™•íˆ ì§šê³  ë„˜ì–´ê°€ì•¼ í•©ë‹ˆë‹¤.  
ì•„ë˜ì— ê° ë‹¨ê³„ë³„ë¡œ êµ¬ì¡°ì™€ ë™ì‘ ì›ë¦¬ë¥¼ ìì„¸íˆ ì„¤ëª….

## ğŸ§  ì „ì²´ íë¦„ ìš”ì•½
```
pub fn auto_hello(_attr: TokenStream, item: TokenStream) -> TokenStream
```
- `item`: êµ¬ì¡°ì²´ ì •ì˜ê°€ TokenStreamìœ¼ë¡œ ë“¤ì–´ì˜´ â†’ synìœ¼ë¡œ íŒŒì‹±
- `input`: êµ¬ì¡°ì²´ ì „ì²´ë¥¼ ë‚˜íƒ€ë‚´ëŠ” DeriveInput íƒ€ì…
- `input.data`: êµ¬ì¡°ì²´ ë‚´ë¶€ ë°ì´í„° â†’ Data::Structë¡œ ë‹¤ìš´ìºìŠ¤íŒ…
- `data_struct.fields`: í•„ë“œ ëª©ë¡ â†’ Fields::Namedë¡œ ë‹¤ìš´ìºìŠ¤íŒ…
- `Field`: ê°ê°ì˜ í•„ë“œ ì •ë³´ (name, age ë“±)
- `quote!`: ì½”ë“œ ìƒì„±
- `TokenStream::from`: ìµœì¢… ë°˜í™˜

## ğŸ” í•µì‹¬ íƒ€ì… ì„¤ëª…
### 1. DeriveInput
```rust
let input = parse_macro_input!(item as DeriveInput);
```

- DeriveInputì€ êµ¬ì¡°ì²´, ì—´ê±°í˜•, ìœ ë‹ˆì–¸ì„ ëª¨ë‘ í‘œí˜„í•  ìˆ˜ ìˆëŠ” ìµœìƒìœ„ íƒ€ì…
- ì£¼ìš” í•„ë“œ:
- `ident`: êµ¬ì¡°ì²´ ì´ë¦„ (Person)
- `data`: ì‹¤ì œ êµ¬ì¡°ì²´/ì—´ê±°í˜•/ìœ ë‹ˆì–¸ì˜ ë‚´ë¶€ ì •ë³´
- `attrs`: #[...] í˜•íƒœì˜ ì–´íŠ¸ë¦¬ë·°íŠ¸ë“¤
- ì˜ˆì‹œ êµ¬ì¡°:
```rust
DeriveInput {
    ident: Ident("Person"),
    data: Data::Struct(...),
    attrs: [Attribute],
    ...
}
```


### 2. Data::Struct
```rust
match &input.data {
    Data::Struct(data_struct) => ...
}
```

- DataëŠ” ì—´ê±°í˜•(enum), êµ¬ì¡°ì²´(struct), ìœ ë‹ˆì–¸(union)ì„ êµ¬ë¶„
- Data::StructëŠ” êµ¬ì¡°ì²´ì¼ ë•Œë§Œ í•´ë‹¹
- ë‚´ë¶€ í•„ë“œ:
- fields: êµ¬ì¡°ì²´ì˜ í•„ë“œë“¤ (Fields íƒ€ì…)

### 3. Fields::Named
```rust
match &data_struct.fields {
    Fields::Named(named_fields) => &named_fields.named,
}
```

- FieldsëŠ” ì„¸ ê°€ì§€ í˜•íƒœë¥¼ ê°€ì§:
- `Named`: { name: String } í˜•íƒœ
- `Unnamed`: (String, u32) í˜•íƒœ (íŠœí”Œ êµ¬ì¡°ì²´)
- `Unit`: struct Foo; í˜•íƒœ
- `named_fields.named`: Vec<Field> íƒ€ì…ìœ¼ë¡œ ê° í•„ë“œ ì •ë³´ê°€ ë“¤ì–´ ìˆìŒ

### 4. Field
for field in fields {
    let ident = field.ident.as_ref().unwrap().to_string();
    ...
}


- FieldëŠ” êµ¬ì¡°ì²´ì˜ ê° í•„ë“œë¥¼ ë‚˜íƒ€ëƒ„
- ì£¼ìš” í•„ë“œ:
- `ident`: í•„ë“œ ì´ë¦„ (name, age)
- `ty`: íƒ€ì… (String, u32)
- `attrs`: í•„ë“œì— ë¶™ì€ ì–´íŠ¸ë¦¬ë·°íŠ¸ë“¤
- ì˜ˆì‹œ êµ¬ì¡°:
```rust
Field {
    ident: Some(Ident("name")),
    ty: Type::Path(...),
    attrs: [],
    ...
}
```


### ğŸ§ª í•„ë“œ ì¶”ì¶œ ë¡œì§
```rust
let mut name_field = None;
let mut age_field = None;

for field in fields {
    let ident = field.ident.as_ref().unwrap().to_string();
    match ident.as_str() {
        "name" => name_field = Some(field.ident.clone().unwrap()),
        "age" => age_field = Some(field.ident.clone().unwrap()),
        _ => {}
    }
}
```

- field.identëŠ” Option<Ident>ì´ë¯€ë¡œ .as_ref().unwrap()ìœ¼ë¡œ êº¼ëƒ„
- ì´ë¦„ì´ "name" ë˜ëŠ” "age"ì¸ í•„ë“œë¥¼ ì°¾ì•„ì„œ ì €ì¥

### ğŸ§¬ ì½”ë“œ ìƒì„± (quote!)
```rust
let expanded = quote! {
    #[derive(Serialize, Deserialize)]
    #input

    impl #struct_name {
        pub fn hello(&self) {
            println!("ì•ˆë…•í•˜ì„¸ìš”, ì €ëŠ” {}ì´ê³  {}ì‚´ì…ë‹ˆë‹¤.", self.#name_field, self.#age_field);
        }
    }
};
```
- `#input`: ì›ë˜ êµ¬ì¡°ì²´ ê·¸ëŒ€ë¡œ ì‚½ì…
- `#struct_name`: êµ¬ì¡°ì²´ ì´ë¦„ (Person)
- `#name_field`, `#age_field`: í•„ë“œ ì´ë¦„ì„ ì½”ë“œì— ì‚½ì…
- `quote!`ëŠ” Rust ì½”ë“œ ì¡°ê°ì„ ìƒì„±í•˜ëŠ” ë§¤í¬ë¡œ

### ğŸ“¦ ìµœì¢… ë°˜í™˜
```rust
TokenStream::from(expanded)

```
- quote!ë¡œ ìƒì„±ëœ ì½”ë“œë¥¼ TokenStreamìœ¼ë¡œ ë³€í™˜
- ì»´íŒŒì¼ëŸ¬ê°€ ì´ ì½”ë“œë¥¼ ì‹¤ì œë¡œ ì»´íŒŒì¼

## ğŸ§  ì‹œê°ì  êµ¬ì¡° ìš”ì•½
| íƒ€ì…            | ì—­í•                                 |
|-----------------|-------------------------------------|
| DeriveInput     | êµ¬ì¡°ì²´ ì „ì²´ë¥¼ í‘œí˜„                   |
| Data::Struct    | êµ¬ì¡°ì²´ ë‚´ë¶€ ë°ì´í„°                   |
| Fields::Named   | `{}` í˜•íƒœì˜ í•„ë“œ ëª©ë¡                |
| Field           | ê° í•„ë“œì˜ ì´ë¦„, íƒ€ì…, ì–´íŠ¸ë¦¬ë·°íŠ¸ ë“± |
| quote!          | Rust ì½”ë“œ ìƒì„±                       |
| TokenStream     | ì»´íŒŒì¼ëŸ¬ì— ë°˜í™˜í•  ìµœì¢… ì½”ë“œ          |

---



