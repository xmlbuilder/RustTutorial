# backtracking line search

**백트래킹 라인서치(backtracking line search)** 는 최적화 알고리즘에서 스텝 크기를  
자동으로 줄여가며 **충분히 좋은 감소** 를 보장하는 방법입니다.  
수학적으로 정리.

## 📌 기본 아이디어
- 목적함수 $f(x)$ 를 최소화한다고 합시다.
- 현재 점 $x_k$ 에서 방향 $d_k$ 를 따라 이동하려고 합니다.
- 스텝 크기 $\alpha$ 를 1에서 시작해서 점점 줄여가며, Armijo 조건을 만족할 때까지 반복합니다.

## 📐 Armijo 조건 (충분한 감소 조건)

$$
f(x_k+\alpha d_k) \quad \leq \quad f(x_k)+c_1\alpha \nabla f(x_k)^{\top }d_k
$$

- $c_1\in (0,1)$ : 작은 상수 $(보통 10^{-4})$
- $\nabla f(x_k)^{\top }d_k<0$ : 하강 방향임을 의미
- 좌변: 실제 감소량
- 우변: 선형 근사에 기반한 기대 감소량의 일부
- 즉, 스텝을 줄였을 때 실제로 충분히 감소했는지 확인하는 조건입니다.

## ⚙️ 알고리즘 절차
- 초기 스텝 크기 $\alpha =1$ 설정
- Armijo 조건 검사
- 만족하면 스텝 수용
- 불만족하면 $\alpha \leftarrow \tau \alpha$  (예: $\tau =0.5$ )로 줄임
- 최대 반복 횟수까지 검사

## 📊 수학적 의미
- Newton이나 Gauss–Newton 같은 방법은 큰 스텝을 제안할 수 있는데, 이때 발산 위험이 있습니다.
- 백트래킹 라인서치는 스텝 크기를 기하급수적으로 줄여가며 안정성을 확보합니다.
- 결국, **충분히 좋은 감소** 를 보장하는 안전장치 역할을 합니다.

## ✅ 요약
- 백트래킹 라인서치 = 스텝 크기를 줄여가며 Armijo 조건을 만족할 때까지 반복하는 기법
- 수학적으로는 $f(x+\alpha d)\leq f(x)+c_1\alpha \nabla f(x)^{\top }d$ 조건을 검사
- 최적화에서 발산을 막고 안정적인 수렴을 보장하는 핵심 장치입니다

### 백트래킹 라인서치의 수렴성 보장
아래는 표준 가정하에서 백트래킹 라인서치가 전역적으로 **정지점(그라디언트가 0)** 으로 수렴함을 보장하는 증명 개요입니다.  
핵심은 Armijo(충분한 감소) 조건과 그라디언트의 Lipschitz 연속성을 결합해, 스텝 크기를 줄이면 언젠가 조건이 만족된다는 것,  
그리고 그 결과로 목적함수 값이 단조 감소하면서 그라디언트 노름이 0으로 간다는 것입니다.

## 설정과 가정
- 목적함수
 
$$
f:\mathbb{R^{\mathnormal{n}}}\rightarrow \mathbb{R}
$$

는 연속적으로 미분 가능이고, 그라디언트가 Lipschitz 연속이다. 즉, 어떤 $L>0$ 가 존재하여 모든 x,y에 대해

$$
\| \nabla f(x)-\nabla f(y)\| \leq L\| x-y\| .
$$

- f는 아래로 유계이다: $\inf _xf(x)>-\infty$ .
- 각 반복에서 선택된 하강 방향 $d_k$ 는

$$
\nabla f(x_k)^{\top }d_k < 0
$$

- 를 만족한다. (예: $d_k=-\nabla f(x_k)$ 인 경우의 최급강하법)
- 백트래킹 라인서치는 초기 에서 시작해 $\alpha \leftarrow \tau \alpha  (0<\tau <1)$ 로 축소하며, Armijo 조건

$$
f(x_k+\alpha d_k) \leq  f(x_k)+c_1 \alpha  \nabla f(x_k)^{\top }d_k,\quad c_1\in (0,1)
$$

- 을 만족하는 $\alpha$ 를 찾는다.

## Lemma 1: 충분한 감소는 항상 달성 가능
그라디언트의 Lipschitz 연속성으로부터, 테일러 근사와 잔여항 경계로
이를 Armijo 우변과 비교하면, 충분히 작은 $\alpha$ 에 대해

$$
f(x_k+\alpha d_k) \leq  f(x_k)+c_1 \alpha  \nabla f(x_k)^{\top }d_k
$$

가 성립한다. 
실제로, $\nabla f(x_k)^{\top }d_k<0$ 이므로 어떤 $\bar {\alpha }>0$ 가 존재하며,  
모든 $0<\alpha \leq \bar {\alpha }$ 에 대해 Armijo 조건이 만족된다.  
따라서 $\alpha$ 를 기하급수적으로 줄이는 백트래킹은 유한 단계 내에 조건을 만족하는 $\alpha$ 를 찾는다.

## Lemma 2: 함수값의 단조 감소와 수열의 유계성
Armijo 조건 수용 시,

$$
f(x_{k+1}) = f(x_k+\alpha _kd_k) \leq  f(x_k)+c_1 \alpha _k \nabla f(x_k)^{\top }d_k,
$$

우변의 마지막 항은 음수이므로 $f(x_{k+1})\leq f(x_k)$. 즉, $\{ f(x_k)\}$ 는 단조 감소한다.  
또한 f는 아래로 유계이므로 $\{ f(x_k)\}$ 는 수렴하는 유계 수열이다. 

### Zoutendijk-type 결과: 그라디언트의 소멸
최급강하법(또는 일반적인 하강 방향에서 적절한 각도 조건)을 가정하면, 다음과 같은 합의 유한성이 성립한다:

$$
\sum _{k=0}^{\infty }\cos ^2\theta _k \| \nabla f(x_k)\| ^2 < \infty ,
$$

여기서 $\theta _k$ 는 그라디언트와 방향 사이의 각도이고 

$$
\cos \theta _k=-\frac{\nabla f(x_k)^{\top }d_k}{\| \nabla f(x_k)\|  \| d_k\| }.
$$

최급강하에서는 $\cos \theta _k=1$ 이므로

$$
\sum _{k=0}^{\infty }\| \nabla f(x_k)\| ^2 < \infty .
$$

따라서 $\| \nabla f(x_k)\| \rightarrow 0$ 이다. 이는 수열이 정지점으로 수렴한다는 것을 의미한다.
핵심 아이디어는 Armijo 조건이 보장하는 **충분한 감소** 와 Lipschitz 그라디언트가 주는 상계로부터,  
각 스텝에서 최소한의 감소가 그라디언트 노름과 각도에 의해 하한되며, 그 합이 유한하므로 그라디언트가  
소멸한다는 표준 정리(Zoutendijk 정리)의 적용입니다.  

## Theorem: 전역 수렴 (최급강하 + 백트래킹 Armijo)
위 가정하에서, 최급강하 방향 $d_k=-\nabla f(x_k)$ 과 백트래킹 Armijo 라인서치를 사용하면

$$
\lim _{k\rightarrow \infty }\| \nabla f(x_k)\|  = 0.
$$

즉, 어느 부분수열이든 정지점으로 수렴하며, 전체 수열의 그라디언트 노름이 0으로 간다.  
함수가 추가로 구배-Lipschitz 이면서, 정지점이 고유하고 강볼록 등의 강한 가정이 있으면 $x_k\rightarrow x^{\star }$ 의 점수렴도 얻을 수 있다.  

## Newton/가우스–Newton 계열에 대한 보강

Newton/가우스–Newton 방향은 항상 하강 방향이 아닐 수 있으나, 백트래킹 Armijo를 결합하면 다음이 성립한다:
- 방향이 하강이면 Lemma 1에 의해 충분한 감소가 보장되어 수렴성 논리를 그대로 적용 가능.
- 방향이 하강이 아니면 스텝 축소로도 Armijo가 성립하지 않을 수 있으므로, 실무에서는 **하강이 아닐 때 그라디언트 하강으로 폴백** 을 사용한다.  
    이 경우 전체 알고리즘은 매 반복 최소한 최급강하의 Armijo 감소를 제공하므로 위 전역 수렴 결과를 유지한다.

## 요약
- 백트래킹 라인서치는 Lipschitz 그라디언트와 하강 방향 가정 하에, 항상 유한 단계 내 충분한 감소(Armijo)를 만족하는 스텝을 찾는다.
- 그 결과로 $f(x_k)$ 는 단조 감소하며 유계이고, Zoutendijk 정리에 의해 $\| \nabla f(x_k)\| \rightarrow 0.$
- 최급강하뿐 아니라 Newton/가우스–Newton도 하강 판정과 폴백을 결합하면 같은 결론을 얻는다.

---

