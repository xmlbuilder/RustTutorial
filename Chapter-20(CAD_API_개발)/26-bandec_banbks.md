# bandec

- **ë°´ë“œ í–‰ë ¬(Band Matrix)** ì— ëŒ€í•œ **LU ë¶„í•´(bandec)** ì™€ **ì „ì§„/í›„ì§„ ëŒ€ì…(banbks)** ì„ ìˆ˜í–‰í•˜ëŠ” ì•Œê³ ë¦¬ì¦˜ì…ë‹ˆë‹¤.  
- ì•„ë˜ì— ê° í•¨ìˆ˜ì˜ ìˆ˜í•™ì  ì˜ë¯¸, ìˆ˜ì‹ ì •ë¦¬, ê·¸ë¦¬ê³  ìˆ˜í•™ì  íƒ€ë‹¹ì„± ê²€í† ë¥¼ ë‹¨ê³„ë³„ë¡œ ì •ë¦¬.

## ğŸ“ 1. DenseMat íŠ¸ë ˆì‡ì˜ ìˆ˜í•™ì  ì˜ë¯¸
```rust
pub trait DenseMat {
    fn n_rows(&self) -> usize;
    fn n_cols(&self) -> usize;
    fn get(&self, r: usize, c: usize) -> f64;
    fn set(&mut self, r: usize, c: usize, v: f64);
    fn swap_rows(&mut self, i: usize, j: usize);
}
```

## ğŸ”¹ ìˆ˜í•™ì  í•´ì„
- í–‰ë ¬ $A\in \mathbb{R^{\mathnormal{n\times m}}}$ ì— ëŒ€í•´:
- get(i, j) â†’ $A_{ij}$
- set(i, j, v) â†’ $A_{ij}:=v$
- swap_rows(i, j) â†’ $A_{i\cdot }\leftrightarrow A_{j\cdot }$

### âœ… ìˆ˜í•™ì  íƒ€ë‹¹ì„±
- í–‰ ìŠ¤ì™‘ì€ $A_{i\cdot }\leftrightarrow A_{j\cdot }$ ë¡œ ì •í™•íˆ êµ¬í˜„ë¨
- ì—´ ìˆ˜ë§Œí¼ ë£¨í”„ë¥¼ ëŒë©° ê° ì›ì†Œë¥¼ êµí™˜í•˜ë¯€ë¡œ ìˆ˜í•™ì ìœ¼ë¡œ ë¬¸ì œ ì—†ìŒ

## ğŸ“˜ 2. bandec: ë°´ë“œ í–‰ë ¬ LU ë¶„í•´
### ğŸ”¹ ì…ë ¥ ì •ì˜
- $A\in \mathbb{R^{\mathnormal{n\times (m_1+m_2+1)}}}$ : ë°´ë“œ í–‰ë ¬
- $L$: í•˜ì‚¼ê° ë°´ë“œ ì €ì¥ìš© í–‰ë ¬
- $U$: ìƒì‚¼ê° ë°´ë“œë¡œ ë³€í™˜ëœ A
- $\mathrm{index}$: í”¼ë²— ì¸ë±ìŠ¤ (1-based)
- $d$: í–‰ êµí™˜ ë¶€í˜¸
### ğŸ”¹ ìˆ˜í•™ì  ê³¼ì •
- ìŠ¬ë¼ì´ë”© ì •ë ¬
- ìƒë‹¨ í–‰ë“¤ì„ ì™¼ìª½ìœ¼ë¡œ ì •ë ¬í•˜ì—¬ ë°´ë“œ í˜•íƒœë¡œ ë§ì¶¤
- í”¼ë²— ì„ íƒ

$$
\max _{j\in [i,i+m_1]}|A_{j,0}| â†’ pivot row
$$

- í–‰ êµí™˜
- $A_{i\cdot }\leftrightarrow A_{\mathrm{imax}\cdot }, d:=-d$
- í•˜ë¶€ ì œê±° (Forward Elimination)
- $r=\frac{A_{j,0}}{A_{i,0}}$
- $A_{j,k-1}:=A_{j,k}-r\cdot A_{i,k}$
- $L_{i,j-i-1}:=r$
## âœ… ìˆ˜í•™ì  íƒ€ë‹¹ì„±
- LU ë¶„í•´ì˜ ê¸°ë³¸ ì›ë¦¬ì™€ ì¼ì¹˜
- ë°´ë“œ êµ¬ì¡°ë¥¼ ìœ ì§€í•˜ë©° A=LU í˜•íƒœë¡œ ë¶„í•´
- pivotingê³¼ ì‘ì€ ê°’ ë°©ì–´ë„ í¬í•¨ë˜ì–´ ì•ˆì •ì 

## ğŸ“˜ 3. banbks: ì „ì§„/í›„ì§„ ëŒ€ì…
### ğŸ”¹ ìˆ˜í•™ì  ëª©ì 
- `LUx=Pb` ë¥¼ í’€ê¸° ìœ„í•œ ë‘ ë‹¨ê³„:
- `Ly=Pb` â†’ ì „ì§„ ëŒ€ì…
- `Ux=y` â†’ í›„ì§„ ëŒ€ì…
### ğŸ”¹ ìˆ˜ì‹ ì •ë¦¬
- ì „ì§„ ëŒ€ì… (Forward Substitution)

$$
b_j:=b_j\leftrightarrow b_{\mathrm{index}[j]-1}
$$

$$
b_k:=b_k-L_{j,k-j-1}\cdot b_j\quad \mathrm{for\  }k=j+1\dots j+m_1
$$

- í›„ì§„ ëŒ€ì… (Backward Substitution)

$$
x_j:=\left( b_j-\sum _{k=1}^{m_2}U_{j,k}\cdot x_{j+k}\right) /U_{j,0}
$$

### âœ… ìˆ˜í•™ì  íƒ€ë‹¹ì„±
- ì „í˜•ì ì¸ LU ë¶„í•´ ê¸°ë°˜ ì„ í˜• ì‹œìŠ¤í…œ í•´ë²•
- ë°´ë“œ êµ¬ì¡°ë¥¼ ê³ ë ¤í•œ ìµœì í™”ëœ ëŒ€ì… ë°©ì‹
- pivotingê³¼ ë°´ë“œ í­ ì œí•œì„ ì •í™•íˆ ë°˜ì˜


## ğŸ“Š ì „ì²´ ì•Œê³ ë¦¬ì¦˜ ìš”ì•½
| ë‹¨ê³„           | ìˆ˜í•™ì  ì—°ì‚°                          | ì½”ë“œ ë˜ëŠ” ìˆ˜ì‹ í‘œí˜„                                      | ì„¤ëª… |
|----------------|--------------------------------------|----------------------------------------------------------|------|
| í–‰ ìŠ¤ì™‘        | $A_{i\cdot} \leftrightarrow A_{j\cdot}$ | `swap_rows(i, j)`                                        | í”¼ë²— í–‰ êµí™˜ |
| LU ë¶„í•´        | $A = LU$                         | `bandec(...)`                                            | ë°´ë“œ í–‰ë ¬ ë¶„í•´ |
| ì „ì§„ ëŒ€ì…      | $Ly = Pb$                        | $y_k := y_k - L_{jk} \cdot y_j$                      | í•˜ì‚¼ê° í–‰ë ¬ L |
| í›„ì§„ ëŒ€ì…      | $Ux = y$                         | $x_j := \frac{y_j - \sum U_{jk} x_k}{U_{jj}}$        | ìƒì‚¼ê° í–‰ë ¬ U |

---

## ğŸ“˜ 2. banbks: ì „ì§„/í›„ì§„ ëŒ€ì…
### ğŸ”¹ ìˆ˜í•™ì  ëª©ì 
- `LUx=Pb` ë¥¼ í’€ê¸° ìœ„í•œ ë‘ ë‹¨ê³„:
- `Ly=Pb` â†’ ì „ì§„ ëŒ€ì…
- `Ux=y` â†’ í›„ì§„ ëŒ€ì…
### ğŸ”¹ ìˆ˜ì‹ ì •ë¦¬
- ì „ì§„ ëŒ€ì… (Forward Substitution)

$$
b_j:=b_j\leftrightarrow b_{\mathrm{index}[j]-1}
$$

$$
b_k:=b_k-L_{j,k-j-1}\cdot b_j\quad \mathrm{for\  }k=j+1\dots j+m_1
$$

- í›„ì§„ ëŒ€ì… (Backward Substitution)

$$
x_j:=\left( b_j-\sum _{k=1}^{m_2}U_{j,k}\cdot x_{j+k}\right) /U_{j,0}
$$

### âœ… ìˆ˜í•™ì  íƒ€ë‹¹ì„±
- ì „í˜•ì ì¸ LU ë¶„í•´ ê¸°ë°˜ ì„ í˜• ì‹œìŠ¤í…œ í•´ë²•
- ë°´ë“œ êµ¬ì¡°ë¥¼ ê³ ë ¤í•œ ìµœì í™”ëœ ëŒ€ì… ë°©ì‹
- pivotingê³¼ ë°´ë“œ í­ ì œí•œì„ ì •í™•íˆ ë°˜ì˜


## ğŸ“Š ì „ì²´ ì•Œê³ ë¦¬ì¦˜ ìš”ì•½
| ë‹¨ê³„           | ìˆ˜í•™ì  ì—°ì‚°                          | ì½”ë“œ ë˜ëŠ” ìˆ˜ì‹ í‘œí˜„                                      | ì„¤ëª… |
|----------------|--------------------------------------|----------------------------------------------------------|------|
| í–‰ ìŠ¤ì™‘        | $A_{i\cdot} \leftrightarrow A_{j\cdot}$ | `swap_rows(i, j)`                                        | í”¼ë²— í–‰ êµí™˜ |
| LU ë¶„í•´        | $A = LU$                         | `bandec(...)`                                            | ë°´ë“œ í–‰ë ¬ ë¶„í•´ |
| ì „ì§„ ëŒ€ì…      | $Ly = Pb$                        | $y_k := y_k - L_{jk} \cdot y_j$                      | í•˜ì‚¼ê° í–‰ë ¬ L |
| í›„ì§„ ëŒ€ì…      | $Ux = y$                         | $x_j := \frac{y_j - \sum U_{jk} x_k}{U_{jj}}$        | ìƒì‚¼ê° í–‰ë ¬ U |

---

## ğŸ” ì–´ë–»ê²Œ ë™ì‘í•˜ëƒë©´â€¦
### 1. bandec í•¨ìˆ˜
- ë°´ë“œ í–‰ë ¬ Aë¥¼ LU ë¶„í•´í•©ë‹ˆë‹¤:

$$
A=LU
$$

- ì—¬ê¸°ì„œ:
- $L$: í•˜ì‚¼ê° í–‰ë ¬ (ë°´ë“œ í˜•íƒœë¡œ alì— ì €ì¥)
- $U$: ìƒì‚¼ê° í–‰ë ¬ (ë°´ë“œ í˜•íƒœë¡œ aì— ì €ì¥)
- $index$: í”¼ë²— ì •ë³´ (í–‰ êµí™˜ ê¸°ë¡)
- $d$: í–‰ êµí™˜ ë¶€í˜¸ (í–‰ë ¬ì‹ ë¶€í˜¸ìš©)

### 2. banbks í•¨ìˆ˜
- LU ë¶„í•´ ê²°ê³¼ë¥¼ ì´ìš©í•´ Ax=bë¥¼ í‘¸ëŠ” ë‘ ë‹¨ê³„ ìˆ˜í–‰:

#### ğŸ”¹ ì „ì§„ ëŒ€ì… (Forward Substitution)

$$
Ly=Pb
$$

- Lê³¼ í”¼ë²— ì •ë³´ë¥¼ ì´ìš©í•´ ì¤‘ê°„ ë²¡í„° y ê³„ì‚°

#### ğŸ”¹ í›„ì§„ ëŒ€ì… (Backward Substitution)

$$
Ux=y
$$

- Uë¥¼ ì´ìš©í•´ ìµœì¢… í•´ x ê³„ì‚°

- âœ… ê²°ë¡ 
    - ë„¤, ì´ êµ¬ì¡°ì—ì„œëŠ” Ax = bë¥¼ ë„£ìœ¼ë©´ xë¥¼ ì •í™•íˆ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    - ë‹¨, AëŠ” ë°´ë“œ í–‰ë ¬ì´ì–´ì•¼ í•˜ê³ , LU ë¶„í•´ê°€ ê°€ëŠ¥í•œ ê²½ìš°ì—ë§Œ ì •í™•í•œ í•´ê°€ ë‚˜ì˜µë‹ˆë‹¤.
    - ìˆ˜ì¹˜ì ìœ¼ë¡œ ì•ˆì •í•œ ë°©ì‹ì´ë©°, ëŒ€ê·œëª¨ í¬ì†Œ í–‰ë ¬ì—ì„œë„ íš¨ìœ¨ì ì…ë‹ˆë‹¤.


## ğŸ§  ì „ì²´ íë¦„ ìš”ì•½
- â‘  A_dense ìƒì„± â†’ â‘¡ X_true ìƒì„± â†’ â‘¢ B = A_dense Ã— X_true
- â‘£ A_band ë³€í™˜ â†’ â‘¤ LU ë¶„í•´ (bandec) â†’ â‘¥ í•´ ê³„ì‚° (banbks)
- â‘¦ B â† x ë³µì›ë¨ â†’ â‘§ Bì™€ X_true ë¹„êµ


## ğŸ” ë‹¨ê³„ë³„ ìƒì„¸ ì„¤ëª…
### â‘  A_dense ìƒì„±: make_dense_band_dd(n, m1, m2)
- ëª©ì : ëŒ€ê°ìš°ì„¸í•œ ë°´ë“œ í–‰ë ¬ $A\in \mathbb{R^{\mathnormal{n\times n}}}$ ìƒì„±
- êµ¬ì„±:
- ëŒ€ê° ì„±ë¶„: $A_{ii}=6.0+\mathrm{ìƒí•˜\  ë°´ë“œì˜\  ì ˆëŒ“ê°’\  í•©}$
- í•˜ë¶€ ë°´ë“œ: $A_{i,i-k}=\sin (i+k)\cdot 0.05$
- ìƒë¶€ ë°´ë“œ: $A_{i,i+k}=\cos (i+3k)\cdot 0.05$
- âœ… ì´ í–‰ë ¬ì€ LU ë¶„í•´ ì‹œ pivot ì—†ì´ ì•ˆì •ì ìœ¼ë¡œ ì²˜ë¦¬ë©ë‹ˆë‹¤.

### â‘¡ X_true ìƒì„±
```rust
x_true.set(i, 0, (i as f64).sin());
x_true.set(i, 1, (i as f64).cos());
```
- ëª©ì : í•´ $x\in \mathbb{R^{\mathnormal{n\times 2}}}$ ìƒì„±
- êµ¬ì„±: ë‘ ê°œì˜ RHS (ì—´)
- ì²« ë²ˆì§¸ ì—´: $x_i^{(1)}=\sin (i)$
- ë‘ ë²ˆì§¸ ì—´: $x_i^{(2)}=\cos (i)$

### â‘¢ B ìƒì„±: dense_mul(&a_dense, &x_true)
- ëª©ì : $B=A\cdot X_{\mathrm{true}}$
- ê³„ì‚°:

$$
B_{i,c}=\sum _{k=0}^{n-1}A_{i,k}\cdot X_{k,c}
$$

- ê²°ê³¼: $B\in \mathbb{R^{\mathnormal{n\times 2}}}$, RHSì— ëŒ€ì‘í•˜ëŠ” ê²°ê³¼ ë²¡í„°

### â‘£ A_band ë³€í™˜: dense_to_band(&a_dense, m1, m2)
- ëª©ì : ë°´ë“œ í–‰ë ¬ í¬ë§·ìœ¼ë¡œ ë³€í™˜
- í¬ë§·:
- $A_{i,j}$ â†’ $A_{\mathrm{band}}[i][m1+j-i]$
- ëŒ€ê°: col = m1
- í•˜ë¶€: m1-1, ..., 0
- ìƒë¶€: m1+1, ..., m1+m2

### â‘¤ LU ë¶„í•´: bandec(...)
- ì…ë ¥: a_band, al, index, d
- ì¶œë ¥:
- a_band: ìƒì‚¼ê° í–‰ë ¬ Uë¡œ ë³€í˜•ë¨
- al: í•˜ì‚¼ê° í–‰ë ¬ Lì˜ ë°´ë“œ ì„±ë¶„ ì €ì¥
- index: í”¼ë²— ì¸ë±ìŠ¤ (1-based)
- d: í–‰ êµí™˜ ë¶€í˜¸

### â‘¥ í•´ ê³„ì‚°: banbks(...)
- ì…ë ¥: LU ë¶„í•´ ê²°ê³¼ì™€ RHS B
- ê³„ì‚°:
- ì „ì§„ ëŒ€ì…: $Ly=Pb$
- í›„ì§„ ëŒ€ì…: $Ux=y$
- ê²°ê³¼: Bê°€ í•´ xë¡œ ë®ì–´ì“°ê¸°ë¨

### â‘¦ ê²°ê³¼ ê²€ì¦
```rust
assert!(nearly_eq(got, want, 1e-10))
```

- got = b.get(i, c) â†’ ê³„ì‚°ëœ í•´
- want = x_true.get(i, c) â†’ ì›ë˜ í•´
- ì˜¤ì°¨ í—ˆìš© ë²”ìœ„: $10^{-10}$
- âœ… ì •í™•í•˜ê²Œ ë³µì›ë˜ì—ˆëŠ”ì§€ í™•ì¸

## ğŸ“Œ í•µì‹¬ ìš”ì•½
| ë‹¨ê³„        | í•¨ìˆ˜ ë˜ëŠ” ì…ë ¥ê°’         | ì¶œë ¥ ë˜ëŠ” ê²°ê³¼ê°’         | ìˆ˜í•™ì  ì˜ë¯¸ ë˜ëŠ” ëª©ì          |
|-------------|---------------------------|---------------------------|-------------------------------|
| â‘  í–‰ë ¬ ìƒì„± | `make_dense_band_dd`      | `a_dense`                 | ëŒ€ê°ìš°ì„¸ ë°´ë“œ í–‰ë ¬ A ìƒì„±     |
| â‘¡ í•´ ìƒì„±   | `x_true`                  | `x_true`                  | ì°¸ í•´ ë²¡í„° x ì„¤ì •             |
| â‘¢ ê³±ì…ˆ ê³„ì‚° | `dense_mul`               | `B = A Ã— x_true`          | ì„ í˜• ì‹œìŠ¤í…œ RHS ê³„ì‚°          |
| â‘£ í¬ë§· ë³€í™˜ | `dense_to_band`           | `a_band`                  | ë°´ë“œ ì €ì¥ í˜•ì‹ìœ¼ë¡œ ë³€í™˜       |
| â‘¤ LU ë¶„í•´   | `bandec`                  | `a_band`, `al`, `index`, `d` | A = LU ë¶„í•´ ìˆ˜í–‰              |
| â‘¥ í•´ ê³„ì‚°   | `banbks`                  | `b â† x`                   | Ax = b í•´ ê³„ì‚° (x ë³µì›ë¨)     |
| â‘¦ ê²€ì¦      | `assert!(got â‰ˆ want)`     | ë¹„êµ ê²°ê³¼                  | í•´ê°€ ì •í™•íˆ ë³µì›ë˜ì—ˆëŠ”ì§€ í™•ì¸ |
| â‘§ ë°˜ë³µ ë˜ëŠ” í™•ì¥ | ë‹¤ì–‘í•œ A, x | í…ŒìŠ¤íŠ¸ ë£¨í”„ ë˜ëŠ” ë²¤ì¹˜ë§ˆí¬ | ë‹¤ì–‘í•œ ì¼€ì´ìŠ¤ì— ëŒ€í•´ ë°˜ë³µ ìˆ˜í–‰ | ì•Œê³ ë¦¬ì¦˜ ì•ˆì •ì„± ê²€ì¦   |


## ğŸ“Œ ì „ì²´ ëª©í‘œ: ì„ í˜• ì‹œìŠ¤í…œ Ax = b í’€ê¸°
- ì…ë ¥:
- $A\in \mathbb{R^{\mathnormal{n\times n}}}$: ë°´ë“œ í–‰ë ¬
- $b\in \mathbb{R^{\mathnormal{n\times r}}}$: ìš°ë³€ ë²¡í„° ë˜ëŠ” í–‰ë ¬ (rê°œì˜ RHS)
- ì¶œë ¥:
- $x\in \mathbb{R^{\mathnormal{n\times r}}}$: í•´

---

## âœ… 1ë‹¨ê³„: bandec â€” Aë¥¼ LUë¡œ ë¶„í•´
### ğŸ”¹ ì…ë ¥ ë°ì´í„°
| ì¸ì     | ì„¤ëª… ë° ì—­í•                                                                  |
|----------|------------------------------------------------------------------------------|
| `a`      | ë°´ë“œ ì €ì¥ í˜•ì‹ì˜ í–‰ë ¬ A (`n Ã— (m1 + m2 + 1)`), LU ë¶„í•´ ëŒ€ìƒ                  |
| `m1`, `m2` | í•˜ë¶€ ë°´ë“œ í­ `m1`, ìƒë¶€ ë°´ë“œ í­ `m2` â€” ë°´ë“œ êµ¬ì¡° ì •ì˜ìš©                     |
| `al`     | í•˜ì‚¼ê° í–‰ë ¬ Lì˜ ë°´ë“œ ì„±ë¶„ ì €ì¥ì†Œ (`n Ã— m1`) â€” ë¶„í•´ ê²°ê³¼ ì¤‘ Lì˜ ì¼ë¶€ ì €ì¥     |
| `index`  | í”¼ë²— ì¸ë±ìŠ¤ ë°°ì—´ (`length = n`) â€” í–‰ êµí™˜ ì •ë³´ ì €ì¥ (1-based)                |
| `d`      | í–‰ êµí™˜ ë¶€í˜¸ (`+1` ë˜ëŠ” `-1`) â€” í–‰ë ¬ì‹ ë¶€í˜¸ ì¶”ì ìš©                           |

### ğŸ”¹ ìˆ˜í•™ì  ì¡°ì¹˜
- LU ë¶„í•´ ìˆ˜í–‰

$$
A=LU
$$

- L: ë‹¨ìœ„ í•˜ì‚¼ê° í–‰ë ¬ (ë°´ë“œ êµ¬ì¡°, alì— ì €ì¥)
- U: ìƒì‚¼ê° í–‰ë ¬ (ë°´ë“œ êµ¬ì¡°, aì— ë®ì–´ì“°ê¸°)
- í”¼ë²—íŒ… ì ìš©
- í–‰ êµí™˜ì„ í†µí•´ ìˆ˜ì¹˜ ì•ˆì •ì„± í™•ë³´
- í”¼ë²— ì •ë³´ëŠ” indexì— ì €ì¥
### ğŸ”¹ ì¶œë ¥ ê²°ê³¼
- a â†’ Uë¡œ ë³€í˜•ë¨
- al â†’ Lì˜ ë°´ë“œ ì„±ë¶„ ì €ì¥
- index â†’ í”¼ë²— ìˆœì„œ ì €ì¥
- d â†’ í–‰ êµí™˜ ë¶€í˜¸ ì €ì¥

## âœ… 2ë‹¨ê³„: banbks â€” LUì™€ bë¡œ x ê³„ì‚°
### ğŸ”¹ ì…ë ¥ ë°ì´í„°
| ì¸ì     | ì„¤ëª… ë° ì—­í•                                                                  |
|----------|------------------------------------------------------------------------------|
| `a`      | LU ë¶„í•´ëœ ìƒì‚¼ê° í–‰ë ¬ U (ë°´ë“œ ì €ì¥ í˜•ì‹, í¬ê¸°: n Ã— (m1 + m2 + 1))             |
| `al`     | í•˜ì‚¼ê° í–‰ë ¬ Lì˜ ë°´ë“œ ì„±ë¶„ ì €ì¥ì†Œ (í¬ê¸°: n Ã— m1)                              |
| `index`  | í”¼ë²— ì¸ë±ìŠ¤ ë°°ì—´ (ê¸¸ì´ n, 1-based) â€” `bandec`ì—ì„œ ìƒì„±ëœ í–‰ êµí™˜ ì •ë³´         |
| `b`      | ìš°ë³€ ë²¡í„° ë˜ëŠ” í–‰ë ¬ (í¬ê¸°: n Ã— r) â€” ì…ë ¥ì€ b, ì¶œë ¥ì€ í•´ xë¡œ ë®ì–´ì“°ê¸°ë¨       |

### ğŸ”¹ ìˆ˜í•™ì  ì¡°ì¹˜
- ì „ì§„ ëŒ€ì… (Forward Substitution)

$$
Ly=Pb
$$

- í”¼ë²— ìˆœì„œì— ë”°ë¼ b ì¬ë°°ì—´
- Lì„ ì´ìš©í•´ ì¤‘ê°„ ë²¡í„° y ê³„ì‚°
- í›„ì§„ ëŒ€ì… (Backward Substitution)

$$
Ux=y
$$

- Uë¥¼ ì´ìš©í•´ ìµœì¢… í•´ x ê³„ì‚°
- ê²°ê³¼ëŠ” bì— ë®ì–´ì“°ê¸°ë¨ â†’ $b\leftarrow x$

## ğŸ§  ì „ì²´ íë¦„ ìš”ì•½

### âœ… ì™œ ë‘ ë‹¨ê³„ê°€ ëª¨ë‘ í•„ìš”í•œê°€?
| ë‹¨ê³„     | ì—­í•  ë° í•„ìš”ì„± ì„¤ëª…                                                                 |
|----------|--------------------------------------------------------------------------------------|
| `bandec` | í–‰ë ¬ Aë¥¼ LU ë¶„í•´í•˜ì—¬ ê³„ì‚° ê°€ëŠ¥í•œ í˜•íƒœë¡œ ë³€í™˜í•¨. L, U, í”¼ë²— ì •ë³´ë¥¼ ìƒì„±í•¨.              |
| `banbks` | ë¶„í•´ëœ L, Uì™€ ìš°ë³€ ë²¡í„° bë¥¼ ì´ìš©í•´ í•´ xë¥¼ ê³„ì‚°í•¨. ì‹¤ì œë¡œ Ax = bë¥¼ í‘¸ëŠ” ë‹¨ê³„ì„.         |

### ğŸ” í•µì‹¬ íë¦„
- bandec ì—†ìœ¼ë©´ Aë¥¼ ê³„ì‚° ê°€ëŠ¥í•œ í˜•íƒœë¡œ ë°”ê¿€ ìˆ˜ ì—†ìŒ â†’ í•´ë¥¼ êµ¬í•  ìˆ˜ ì—†ìŒ
- banbks ì—†ìœ¼ë©´ ë¶„í•´ëœ Aë¥¼ ê°€ì§€ê³ ë„ bì— ëŒ€í•œ í•´ë¥¼ êµ¬í•  ìˆ˜ ì—†ìŒ â†’ í•´ë¥¼ êµ¬í•  ìˆ˜ ì—†ìŒ



## ğŸ§® ì˜ˆì œ ì„¤ì •
- í–‰ë ¬ A (3Ã—3 tridiagonal):

```math
A=\left[ \begin{matrix}4&1&0\\1&4&1\\0&1&4\end{matrix}\right]
```

- í•´ x:

```math
x=\left[ \begin{matrix}1\\2\\3\end{matrix}\right]
```
- ìš°ë³€ b=Ax:

```math
b=\left[ \begin{matrix}4\cdot 1+1\cdot 2=6\\1\cdot 1+4\cdot 2+1\cdot 3=12\\1\cdot 2+4\cdot 3=14\end{matrix}\right] \Rightarrow b=\left[ \begin{matrix}6\\12\\14\end{matrix}\right] 
```

### ğŸ”§ Step 1: bandec â€” LU ë¶„í•´

LU ë¶„í•´ ê²°ê³¼:

```math
( L = \begin{bmatrix} 1 & 0 & 0 \\0.25 & 1 & 0 \\0 & 0.2667 & 1 \end{bmatrix} )
```

```math
( U = \begin{bmatrix} 4 & 1 & 0 \\0 & 3.75 & 1 \\0 & 0 & 3.7333 \end{bmatrix} )
```

- í”¼ë²— index: [1, 2, 3] (1-based, no row swaps needed)
- í–‰ êµí™˜ ë¶€í˜¸ d=+1

### ğŸ”§ Step 2: banbks â€” í•´ ê³„ì‚°
#### ğŸ”¹ ì „ì§„ ëŒ€ì…: 

```math
Ly=b
```

#### ğŸ”¹ í›„ì§„ ëŒ€ì…: 

```math
Ux=y
```

- âœ… ì›ë˜ xì™€ ì •í™•íˆ ì¼ì¹˜!

## ğŸ¯ ìš”ì•½
| ë‹¨ê³„       | ìˆ˜ì‹ ë˜ëŠ” ê°œë… | í•¨ìˆ˜ ë˜ëŠ” ì²˜ë¦¬ | ì„¤ëª…                         | ê²°ê³¼ ë˜ëŠ” ëª©ì          |
|------------|----------------|----------------|------------------------------|------------------------|
| ë¬¸ì œ ì •ì˜  | $b = Ax$         | â€”              | ì„ í˜• ì‹œìŠ¤í…œ ì„¤ì •             | í•´ xë¥¼ êµ¬í•˜ëŠ” ê²ƒì´ ëª©í‘œ |
| ë¶„í•´ ë‹¨ê³„  | $A = LU$        | `bandec`       | í–‰ë ¬ Aë¥¼ LUë¡œ ë¶„í•´           | L, U, í”¼ë²— ì •ë³´ ìƒì„±    |
| í•´ ê³„ì‚°    | $LUx = b$        | `banbks`       | LU ë¶„í•´ ê²°ê³¼ì™€ bë¡œ x ê³„ì‚°    | í•´ xë¥¼ ì–»ìŒ            |

---

## ì†ŒìŠ¤ ì½”ë“œ
```rust
/// Band matrix LU decomposition
///
/// - a: n x (m1 + m2 + 1) â€” transformed in-place into U
/// - al: n x m1 â€” stores the lower band of L
/// - index: length n, pivot indices (stored as 1-based; compatible with original C++ convention)
/// - d: (out) sign of row exchanges (+/-1)
pub fn on_bandec<A: DenseMat, L: DenseMat>(
    a: &mut A,
    m1: usize,
    m2: usize,
    al: &mut L,
    index: &mut [usize],
    d: &mut f64,
) {
    let n = a.n_rows();
    let num1 = m1 + m2 + 1;

    debug_assert_eq!(a.n_cols(), num1, "a must be n x (m1+m2+1)");
    debug_assert_eq!(al.n_rows(), n);
    debug_assert!(al.n_cols() >= m1, "al must have at least m1 columns");
    debug_assert_eq!(index.len(), n);

    // ìƒë¶€ë¡œ ì •ë ¬(ìŠ¬ë¼ì´ë”©) + ì™¼ìª½ 0 ì±„ìš°ê¸°
    let mut num2 = m1;
    for i in 0..m1 {
        // a[i][0..] â† a[i][(m1-i)..(num1-1)]
        for j in (m1 - i)..num1 {
            let v = a.get(i, j);
            a.set(i, j - num2, v);
        }
        num2 -= 1;
        // ì˜¤ë¥¸ìª½ ëìª½ì„ 0ìœ¼ë¡œ ì±„ì›€
        for j in (num1 - num2 - 1)..num1 {
            a.set(i, j, 0.0);
        }
    }

    *d = 1.0;
    let mut num3 = m1;

    for i in 0..n {
        // í”¼ë²— ì°¾ê¸°: a[i..min(i+num3-i, n-1)][0] ì¤‘ ì ˆëŒ€ê°’ ìµœëŒ€
        let mut val1 = a.get(i, 0);
        let mut imax = i;

        if num3 < n {
            num3 += 1;
        } // ë‹¤ìŒ í–‰ê¹Œì§€ì˜ ë°´ë“œ ë†’ì´ í™•ì¥

        for j in (i + 1)..num3.min(n) {
            let aj0 = a.get(j, 0);
            if aj0.abs() > val1.abs() {
                val1 = aj0;
                imax = j;
            }
        }

        // 1-based pivot index ì €ì¥ (ì›ë³¸ C++ê³¼ ë™ì¼)
        index[i] = imax + 1;

        if val1 == 0.0 {
            // ì›ë³¸ê³¼ ë™ì¼í•œ 'ì‘ì€ ê°’' ë°©ì–´
            a.set(i, 0, 1e-40);
        }

        // í–‰ êµí™˜ (0..num1-1 ì—´ê¹Œì§€ë§Œ)
        if imax != i {
            *d = -*d;
            for j in 0..num1 {
                let tmp = a.get(i, j);
                a.set(i, j, a.get(imax, j));
                a.set(imax, j, tmp);
            }
        }

        // í•˜ë¶€ ì œê±° (forward elimination in band form)
        for j in (i + 1)..num3.min(n) {
            let r = a.get(j, 0) / a.get(i, 0);
            // al[i][j - i - 1] = r;
            al.set(i, j - i - 1, r);

            // a[j][k-1] = a[j][k] - r * a[i][k]
            for k in 1..num1 {
                let new_val = a.get(j, k) - r * a.get(i, k);
                a.set(j, k - 1, new_val);
            }
            // ë§ˆì§€ë§‰ ì¹¸ 0ìœ¼ë¡œ
            a.set(j, num1 - 1, 0.0);
        }
    }
}
```

```rust
/// Forward/Backward substitution
///
/// - a: Band matrix containing LU decomposition (n x (m1 + m2 + 1)) â€” result from `bandec`
/// - al: Lower band of L (n x m1) â€” result from `bandec`
/// - index: 1-based pivot indices obtained from `bandec`
/// - b: n x n_rhs (right-hand side and solution stored in-place)
pub fn on_banbks<A: DenseMat, L: DenseMat, B: DenseMat>(
    a: &A,
    m1: usize,
    m2: usize,
    al: &L,
    index: &[usize],
    b: &mut B,
) {
    let n = a.n_rows();
    let num1 = m1 + m2 + 1;

    debug_assert_eq!(a.n_cols(), num1, "a must be n x (m1+m2+1)");
    debug_assert_eq!(al.n_rows(), n);
    debug_assert!(al.n_cols() >= m1);
    debug_assert_eq!(index.len(), n);
    debug_assert_eq!(b.n_rows(), n, "b must have n rows");

    let n_rhs = b.n_cols();

    for col in 0..n_rhs {
        // ì „ì§„ ëŒ€ì…: L * y = P*b
        let mut num2 = m1;
        for j in 0..n {
            let ip = index[j] - 1; // 1-based â†’ 0-based
            if ip != j {
                let tmp = b.get(j, col);
                b.set(j, col, b.get(ip, col));
                b.set(ip, col, tmp);
            }

            if num2 < n {
                num2 += 1;
            }

            for k in (j + 1)..num2.min(n) {
                let new_val = b.get(k, col) - al.get(j, k - j - 1) * b.get(j, col);
                b.set(k, col, new_val);
            }
        }

        // í›„ì§„ ëŒ€ì…: U * x = y  (banded back-substitution)
        let mut num4 = 1usize;
        for j in (0..n).rev() {
            let mut val = b.get(j, col);
            for k in 1..num4 {
                // a[j][k]ëŠ” Uì˜ ìƒë¶€ë°´ë“œ; b[k+j][col]ëŠ” ê·¸ ìœ„ì— í•´ë‹¹í•˜ëŠ” y/x
                val -= a.get(j, k) * b.get(j + k, col);
            }
            val /= a.get(j, 0);
            b.set(j, col, val);

            if num4 < num1 {
                num4 += 1;
            }
        }
    }
}
```

---


