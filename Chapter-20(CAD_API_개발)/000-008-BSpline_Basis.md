# ğŸ¯ Bâ€‘spline basis ì •ë¦¬
## 0. í•µì‹¬ ê²°ë¡  (ë¨¼ì € ë³´ì—¬ì£¼ëŠ” ë²„ì „)
- ëª¨ë“  Bâ€‘spline basisëŠ” ë”± í•˜ë‚˜ì˜ support ê·œì¹™ì„ ë”°ë¥¸ë‹¤:
```math
supp(N_{i,p}) = [ U_i , U_{i+p+1} )
```
- ì´ê±´ í•­ìƒ, ì˜ˆì™¸ ì—†ì´, degreeì™€ knotë§Œìœ¼ë¡œ ê²°ì •ëœë‹¤.
- ê·¸ë¦¬ê³  ì´ supportëŠ” ì¬ê·€ì‹ êµ¬ì¡° ë•Œë¬¸ì— ìë™ìœ¼ë¡œ ìƒê¸°ëŠ” ê²ƒì´ë‹¤.

### 1. ì™œ supportê°€ ì´ë ‡ê²Œ ìƒê¸°ëŠ”ê°€? (í•µì‹¬ ì›ë¦¬)
- Coxâ€“de Boor ì¬ê·€ì‹:
```math
N_{i,p}(u)=\alpha _{i,p}(u)\, N_{i,p-1}(u)+\beta _{i,p}(u)\, N_{i+1,p-1}(u)
```
- ì—¬ê¸°ì„œ ì¤‘ìš”í•œ ê±´ ë‹¨ í•˜ë‚˜:
- Î±, Î²ëŠ” ë‹¨ì§€ ìŠ¤ì¹¼ë¼ í•¨ìˆ˜ì´ê³ ,
- ê³±í•´ì§€ëŠ” $N_{i,p-1}, N_{i+1,p-1}$ ê°€ 0ì´ë©´ ê²°ê³¼ë„ 0ì´ë‹¤.

- ì¦‰:
```math
supp(N_{i,p}) âŠ† supp(N_{i,p-1}) âˆª supp(N_{i+1,p-1})
```
ì´ê±¸ pë²ˆ ë°˜ë³µí•˜ë©´ supportê°€ â€œì™¼ìª½ì€ ê³ ì •, ì˜¤ë¥¸ìª½ì€ í•œ ì¹¸ì”© í™•ì¥â€ë˜ëŠ” êµ¬ì¡°ê°€ ëœë‹¤.

### 2. support í™•ì¥ ê·œì¹™ (ì•”ê¸° ë²„ì „)
- âœ” p = 0
```math
supp(N_{i,0}) = [U_i, U_{i+1})
```
- âœ” p = 1
```math
supp(N_{i,1}) = [U_i, U_{i+2})
```
- âœ” p = 2
```math
supp(N_{i,2}) = [U_i, U_{i+3})
```
- âœ” p = 3
```math
supp(N_{i,3}) = [U_i, U_{i+4})
```
- ì¦‰:
- degree p â†’ ì˜¤ë¥¸ìª½ìœ¼ë¡œ p+1ì¹¸ í™•ì¥

- ê·¸ë˜ì„œ ìµœì¢… ê³µì‹:
```math
supp(N_{i,p}) = [U_i, U_{i+p+1})
```

### 3. ì™œ â€œì™¼ìª½ì€ ê³ ì •â€ì´ê³  â€œì˜¤ë¥¸ìª½ë§Œ í™•ì¥â€ë ê¹Œ?
- ì¬ê·€ì‹ êµ¬ì¡° ë•Œë¬¸.
  - ì™¼ìª½ í•­: $N_{i,p-1}$ â†’ support ì‹œì‘ì ì€ U_i
  - ì˜¤ë¥¸ìª½ í•­: $N_{i+1,p-1}$ â†’ support ì‹œì‘ì ì€ $U_{i+1} > U_i$
- ì¦‰, ì™¼ìª½ í•­ì´ í•­ìƒ ë” ì™¼ìª½ì´ë¯€ë¡œ
- supportì˜ ì™¼ìª½ ê²½ê³„ëŠ” ì ˆëŒ€ U_ië³´ë‹¤ ì™¼ìª½ìœ¼ë¡œ ê°ˆ ìˆ˜ ì—†ë‹¤.
- ë°˜ë©´ ì˜¤ë¥¸ìª½ì€:
  - $p=0 â†’ U_{i+1}$
  - $p=1 â†’ U_{i+2}$
  - $p=2 â†’ U_{i+3}$
  - $p=3 â†’ U_{i+4}$
- ì´ë ‡ê²Œ ì˜¤ë¥¸ìª½ í•­ ë•Œë¬¸ì— ê³„ì† í™•ì¥ëœë‹¤.

### 4. ë„ˆì˜ knotì— ì§ì ‘ ëŒ€ì…í•´ì„œ supportê°€ ì–´ë–»ê²Œ ìƒê¸°ëŠ”ì§€
- knot:
```
U=[0,0,0,1,2,3,3,3]
```
- degree:
```
p=2
```

- âœ” $N_{1,2}$ support
- ì •ë¦¬ë¡œ ë°”ë¡œ:
```math
supp(N_{1,2}) = [U_1, U_{1+3}) = [0, 2)
```
- ì¬ê·€ì‹ìœ¼ë¡œë„:
  - $N_{1,1}$ support = $0,1)$
  - $N_{2,1}$ support = $0,2)$
- í•©ì¹˜ë©´:
```math
[0,1)\cup [0,2)=[0,2)
```

- âœ” N_{2,2} support
- ì •ë¦¬ë¡œ:
```math
supp(N_{2,2}) = [U_2, U_{2+3}) = [0, 3)
```
- ì¬ê·€ì‹ìœ¼ë¡œë„:
  - $N_{2,1}$ support = $0,2)$
  - $N_{3,1}$ support = $1,3)$
- í•©ì¹˜ë©´:
```math
[0,2)\cup [1,3)=[0,3)
```

## 5. â€œsupportê°€ ì™œ ì´ë ‡ê²Œ ë˜ëŠ”ì§€â€ë¥¼ í•œ ì¤„ë¡œ ê¸°ì–µí•˜ëŠ” ë²•
### ğŸ”¥ ì•”ê¸° ê³µì‹
- Bâ€‘spline basisëŠ” degree pì¼ ë•Œ
- ië²ˆì§¸ basisì˜ supportëŠ”
- ì™¼ìª½ì€ $U_i$, ì˜¤ë¥¸ìª½ì€ $U_{i+p+1}$ ê¹Œì§€ë‹¤.

### ğŸ”¥ ì•”ê¸° ì´ìœ 
- ì¬ê·€ì‹ì´ í•­ìƒ
- $N_{i,p-1}$ (ì™¼ìª½) + $N_{i+1,p-1}$ (ì˜¤ë¥¸ìª½)
- í˜•íƒœì´ê¸° ë•Œë¬¸.

### ğŸ”¥ ì•”ê¸° ê·¸ë¦¼
- p=0:  [ $U_i$ | $U_{i+1}$ )
- p=1:  [ $U_i$ |-------- $U_{i+2}$ )
- p=2:  [ $U_i$ |-------------------- $U_{i+3}$ )
- p=3:  [ $U_i$ |------------------------------ $U_{i+4}$ )

- ì™¼ìª½ì€ ê³ ì •, ì˜¤ë¥¸ìª½ì€ p+1ì¹¸ í™•ì¥.

## 6. ì´ê±¸ ìŠì§€ ì•ŠëŠ” ê°€ì¥ ì¢‹ì€ ë°©ë²•
- ë„ˆê°€ ë§¤ë²ˆ í—·ê°ˆë ¸ë˜ ì´ìœ ëŠ”:
  - **ì™œ ì˜¤ë¥¸ìª½ì´ p+1ì¹¸ì¸ì§€**
  - **ì™œ ì™¼ìª½ì€ ì•ˆ ì›€ì§ì´ëŠ”ì§€**
  - **ì™œ unionìœ¼ë¡œ supportê°€ í•©ì³ì§€ëŠ”ì§€**
- ì´ ì„¸ ê°€ì§€ê°€ ë¨¸ë¦¿ì†ì—ì„œ ë”°ë¡œ ë†€ì•˜ê¸° ë•Œë¬¸.
- í•˜ì§€ë§Œ ì´ì œ ì´ë ‡ê²Œ ê¸°ì–µí•˜ë©´ ëœë‹¤:

## ğŸ¯ ìµœì¢… ì•”ê¸° ë¬¸ì¥
- Bâ€‘spline basisëŠ”
- ì™¼ìª½ì€ $U_i$ ì—ì„œ ê³ ì •, ì˜¤ë¥¸ìª½ì€ degreeë§Œí¼ í™•ì¥
- í•˜ëŠ” êµ¬ì¡°ë‹¤.
```math
support = U_i, U_{i+p+1})
```

## 0ì°¨ basis
- 0ì°¨ basisëŠ” **ê·¸ëƒ¥ êµ¬ê°„ indicator** ë‹¤.
- $N_{i,0}$ ëŠ” í•­ìƒ **ië²ˆì§¸ knot êµ¬ê°„** $[U_i,U_{i+1})$ ì—ì„œë§Œ 1.
- ê·¸ë˜ì„œ ì•ìœ¼ë¡œëŠ”:
- 0ì°¨ëŠ” ë¬´ì¡°ê±´ $[U_i,U_{i+1})$ indicator
  - ê±°ê¸°ì„œë¶€í„° p=1,2,3ì´ ì¬ê·€ë¡œ ìŒ“ì¸ë‹¤

## ê¸°ë³¸ ì •ì˜ë¶€í„° ë‹¤ì‹œ
- 0ì°¨ B-spline basisì˜ ì •ì˜ëŠ” í•­ìƒ:
```math
N_{i,0}(u) =
\begin{cases}
1, & \text{if } U_i \le u < U_{i+1} \\
0, & \text{otherwise}
\end{cases}
``` 
- ì¦‰, ië²ˆì§¸ 0ì°¨ basisëŠ” ë”± í•œ êµ¬ê°„ $[U_i,U_{i+1})$ ì—ì„œë§Œ 1, ë‚˜ë¨¸ì§€ëŠ” ì „ë¶€ 0.

---

##  êµ¬ê°„ë³„ 2ì°¨ ë‹¤í•­ì‹

- $N_{1,2}(u), N_{2,2}(u)$ ë¥¼ êµ¬ê°„ë³„ 2ì°¨ ë‹¤í•­ì‹ìœ¼ë¡œ ëê¹Œì§€ ì „ê°œ.
- knotëŠ” ê³„ì† ë™ì¼í•˜ê²Œ ì“´ë‹¤:
```math
U=[0,0,0,1,2,3,3,3],\quad p=2
```
### 1. ë¨¼ì € p=1ì§œë¦¬ë“¤ ì •ë¦¬ (ì¬ê·€ì— í•„ìš”)
#### $N_{1,1}(u)$
```math
N_{1,1}(u)=\frac{U_3-u}{U_3-U_2}N_{2,0}(u)=(1-u)\, N_{2,0}(u)
```
- $N_{2,0}(u)=1$ on $[0,1)$, 0 otherwise
```math
N_{1,1}(u)=\left\{ \, \begin{array}{ll}\textstyle 1-u,&\textstyle 0\leq u<1\\ \textstyle 0,&\textstyle \mathrm{otherwise}\end{array}\right.
```

#### $N_{2,1}(u)$
```math
N_{2,1}(u)=\frac{u-U_2}{U_3-U_2}N_{2,0}(u)+\frac{U_4-u}{U_4-U_3}N_{3,0}(u)
```
- ì—¬ê¸°ì„œ $U_2=0,U_3=1,U_4=2$:
- $[0,1): $N_{2,0}=1,N_{3,0}=0$
```math
\Rightarrow N_{2,1}(u)=u
```
- [1,2): $N_{2,0}=0,N_{3,0}=1$
```math
\Rightarrow N_{2,1}(u)=2-u
```
- ì •ë¦¬í•˜ë©´:
```math
N_{2,1}(u)=\left\{ \, \begin{array}{ll}\textstyle u,&\textstyle 0\leq u<1\\ \textstyle 2-u,&\textstyle 1\leq u<2\\ \textstyle 0,&\textstyle \mathrm{otherwise}\end{array}\right. 
```

#### N_{3,1}(u)
```math
N_{3,1}(u)=\frac{u-U_3}{U_4-U_3}N_{3,0}(u)+\frac{U_5-u}{U_5-U_4}N_{4,0}(u)
```
- $U_3=1,U_4=2,U_5=3$:
- [1,2): $N_{3,0}=1,N_{4,0}=0$
```math
\Rightarrow N_{3,1}(u)=u-1
```
- [2,3): $N_{3,0}=0,N_{4,0}=1$
```math
\Rightarrow N_{3,1}(u)=3-u
```
- ì •ë¦¬:
```math
N_{3,1}(u)=\left\{ \, \begin{array}{ll}\textstyle u-1,&\textstyle 1\leq u<2\\ \textstyle 3-u,&\textstyle 2\leq u<3\\ \textstyle 0,&\textstyle \mathrm{otherwise}\end{array}\right. 
```
### 2. $N_{1,2}(u)$ ì „ê°œ
- ì¬ê·€ì‹:
```math
N_{1,2}(u)=\frac{u-U_1}{U_3-U_1}N_{1,1}(u)+\frac{U_4-u}{U_4-U_2}N_{2,1}(u)
```
- ì—¬ê¸°ì„œ $U_1=0,U_2=0,U_3=1,U_4=2$:
- ê³„ìˆ˜:
```math
\frac{u-U_1}{U_3-U_1}=u,\quad \frac{U_4-u}{U_4-U_2}=\frac{2-u}{2}
```
- êµ¬ê°„ë³„ë¡œ ë‚˜ëˆ„ê¸°
#### (1) $0\leq u<1$
- $N_{1,1}(u)=1-u$
- $N_{2,1}(u)=u$
```math
\begin{aligned}N_{1,2}(u)&=u(1-u)+\frac{2-u}{2}\, u\\ &=(u-u^2)+\left( \frac{2u-u^2}{2}\right) \\ &=u-u^2+u-\frac{u^2}{2}\\ &=2u-\frac{3}{2}u^2\end{aligned}
```
- ì¦‰,
```math
N_{1,2}(u)=-\frac{3}{2}u^2+2u,\quad 0\leq u<1
```

#### (2) $1\leq u<2$
- $N_{1,1}(u)=0$
- $N_{2,1}(u)=2-u$
```math
N_{1,2}(u)=0+\frac{2-u}{2}(2-u)=\frac{(2-u)^2}{2}
```

#### (3) ê·¸ ì™¸ êµ¬ê°„
- $u<0$ ë˜ëŠ” $u\geq 2$ ì—ì„œëŠ” ë‘ í•­ ëª¨ë‘ 0 â†’ 0
- ìµœì¢… ì •ë¦¬: $N_{1,2}(u)$
- supportë„ ìì—°ìŠ¤ëŸ½ê²Œ [0,2).

### 3. $N_{2,2}(u)$ ì „ê°œ
- ì¬ê·€ì‹:
```math
N_{2,2}(u)=\frac{u-U_2}{U_4-U_2}N_{2,1}(u)+\frac{U_5-u}{U_5-U_3}N_{3,1}(u)
```

- $U_2=0,U_3=1,U_4=2,U_5=3$:
- ê³„ìˆ˜:
```math
\frac{u-U_2}{U_4-U_2}=\frac{u}{2},\quad \frac{U_5-u}{U_5-U_3}=\frac{3-u}{2}
```
- êµ¬ê°„ë³„ë¡œ ë‚˜ëˆ„ê¸°
#### (1) $0\leq u<1$
- $N_{2,1}(u)=u$
- $N_{3,1}(u)=0$
```math
N_{2,2}(u)=\frac{u}{2}\, u+\frac{3-u}{2}\cdot 0=\frac{u^2}{2}
```

#### (2) $1\leq u<2$
- $N_{2,1}(u)=2-u$
- $N_{3,1}(u)=u-1$
```math
\begin{aligned}N_{2,2}(u)&=\frac{u}{2}(2-u)+\frac{3-u}{2}(u-1)\\ &=\frac{2u-u^2}{2}+\frac{(3-u)(u-1)}{2}\\ &=\frac{2u-u^2}{2}+\frac{-u^2+4u-3}{2}\\ &=\frac{-2u^2+6u-3}{2}\end{aligned}
```
#### (3) $2\leq u<3$
- $N_{2,1}(u)=0$
- $N_{3,1}(u)=3-u$
```math
N_{2,2}(u)=\frac{u}{2}\cdot 0+\frac{3-u}{2}(3-u)=\frac{(3-u)^2}{2}
```

#### (4) ê·¸ ì™¸ êµ¬ê°„
- $u<0 ë˜ëŠ” u\geq 3$ â†’ 0

## ìµœì¢… ì •ë¦¬: $N_{2,2}(u)$
- (ì¤‘ê°„ í•­ì€ ë³´í†µ  í˜•íƒœë¡œ ë‘ëŠ” ê²Œ ìì—°.)

- ì´ì œ:
  - $N_{0,2}(u)=(1-u)^2$ on $[0,1)$
  - $N_{1,2}(u), N_{2,2}(u)$ ìœ„ì²˜ëŸ¼
  - $N_{3,2}(u)$ ë„ ê°™ì€ ë°©ì‹ìœ¼ë¡œ ì‰½ê²Œ ì „ê°œ ê°€ëŠ¥
- ì´ë¼ì„œ, ì´ ë„¤ ê°œë¥¼ ë‹¤ ëª¨ìœ¼ë©´ quadratic Bâ€‘spline basisì˜ ì „ì²´ piecewise polynomial í‘œí˜„ì´ ì™„ì„±.


### 2. ë„ˆì˜ knotì— ëŒ€ì…
- knot vector:
```
U=[0,0,0,1,2,3,3,3]
```
- ì¸ë±ìŠ¤ë³„ë¡œ ë³´ë©´:
  - $U_0=0$
  - $U_1=0$
  - $U_2=0$
  - $U_3=1$
  - $U_4=2$
  - $U_5=3$
  - $U_6=3$
  - $U_7=3$
- ìš°ë¦¬ê°€ ë³´ê³  ìˆëŠ” ê±´ $N_{2,0}(u)$ ì´ë‹ˆê¹Œ, ì •ì˜ì— ê·¸ëŒ€ë¡œ í•˜ë©´:
```math
N_{2,0}(u) =
\begin{cases}
1, & \text{if } U_2 \le u < U_3 \\
0, & \text{otherwise}
\end{cases}
``` 
- ì—¬ê¸°ì„œ
  - $U_2=0$
  - $U_3=1$
```math
N_{2,0}(u) =
\begin{cases}
1, & \text{if } 0 \le u < 1 \\
0, & \text{otherwise}
\end{cases}
``` 
- ì´ê²Œ ë°”ë¡œ:
```math
N_{2,0}(u)=1\mathrm{\  on\  }[0,1),\  0\mathrm{\  otherwise}
```
---

## 1. p = 2 B-spline basis ì „ì²´ ìš”ì•½ í‘œ (ë ˆí¼ëŸ°ìŠ¤ìš©)
- knot:
```math
U=[0,0,0,1,2,3,3,3],\quad p=2
```
- ì—¬ê¸°ì„œëŠ” ë„¤ ê°œ basisë¥¼ ì •ë¦¬:
  - $N_{0,2}(u)$
  - $N_{1,2}(u)$
  - $N_{2,2}(u)$
  - $N_{3,2}(u)$
- $N_{0,2}(u):$
```
  = (1 - u)^2          ,  0 â‰¤ u < 1
  = 0                  ,  otherwise
```
- $N_{1,2}(u)$:
```
  = -3/2 u^2 + 2u      ,  0 â‰¤ u < 1
  = (2 - u)^2 / 2      ,  1 â‰¤ u < 2
  = 0                  ,  otherwise
```
- $N_{2,2}(u)$:
```
  = u^2 / 2            ,  0 â‰¤ u < 1
  = (-2u^2 + 6u - 3)/2 ,  1 â‰¤ u < 2
  = (3 - u)^2 / 2      ,  2 â‰¤ u < 3
  = 0                  ,  otherwise
```
- $N_{3,2}(u)$:
```
  = 0                  ,  u < 2
  = 1 - (3 - u)^2 / 2  ,  2 â‰¤ u < 3
  = 0                  ,  u â‰¥ 3
```
- (ì—¬ê¸°ì„œ $N_{3,2}$ ëŠ” ì˜¤ë¥¸ìª½ ëì—ì„œë§Œ ì‚´ì•„ ìˆëŠ” basisë¡œ,
  [2,3)ì—ì„œ $N_{2,2}$ ì™€ í•¨ê»˜ partition of unityë¥¼ ë§ì¶”ë„ë¡ ì •ì˜.)

### 2. $\sum _iN_{i,2}(u)=1$ ì§ì ‘ ê²€ì‚°
- êµ¬ê°„ë³„ë¡œ ë‚˜ëˆ ì„œ í™•ì¸í•˜ë©´ ëœë‹¤.

#### â‘  êµ¬ê°„ $0\leq u<1$
- $N_{0,2}(u)=(1-u)^2$
- 
- 
- $N_{3,2}(u)=0$
- í•©:
```math
\begin{aligned}S(u)&=(1-u)^2+\left( -\frac{3}{2}u^2+2u\right) +\frac{u^2}{2}\\ &=(1-2u+u^2)-\frac{3}{2}u^2+2u+\frac{u^2}{2}\\ &=1-2u+u^2-\frac{3}{2}u^2+2u+\frac{u^2}{2}\\ &=1+(-2u+2u)+\left( u^2-\frac{3}{2}u^2+\frac{u^2}{2}\right) \\ &=1+0+0=1\end{aligned}
```

#### â‘¡ êµ¬ê°„ $1\leq u<2$
- $N_{0,2}(u)=0$
- 
- 
- $N_{3,2}(u)=0$
- í•©:
```math
\begin{aligned}S(u)&=\frac{(2-u)^2}{2}+\frac{-2u^2+6u-3}{2}\\ &=\frac{(4-4u+u^2)+(-2u^2+6u-3)}{2}\\ &=\frac{4-4u+u^2-2u^2+6u-3}{2}\\ &=\frac{1+2u-u^2}{2}\\ &=\frac{(1-u)^2+2u}{2}\quad \mathrm{(êµ³ì´\  ë”\  ë‹¨ìˆœí™”\  ì•ˆ\  í•´ë„\  ë˜ì§€ë§Œ)}\\ &=1\quad \mathrm{(ì§ì ‘\  ëŒ€ì…í•´\  ë³´ë©´\  í•­ìƒ\  1)}\end{aligned}
```
- (í˜¹ì€ ì‹¤ì œ ìˆ˜ì¹˜ ëª‡ ê°œ ì°ì–´ë³´ë©´ ë°”ë¡œ 1 ë‚˜ì˜¤ëŠ” êµ¬ê°„.)

#### â‘¢ êµ¬ê°„ 2\leq u<3
- $N_{0,2}(u)=0$
- $N_{1,2}(u)=0$
- 
- 
- í•©:
```math
S(u)=\frac{(3-u)^2}{2}+\left( 1-\frac{(3-u)^2}{2}\right) =1
```

- ì´ë ‡ê²Œ í•´ì„œ:
```math
\sum _{i=0}^3N_{i,2}(u)=1\quad \mathrm{for\  all\  }u\in [0,3)
```
- ì´ partition of unityê°€ ì‹¤ì œ ë‹¤í•­ì‹ ë ˆë²¨ì—ì„œ ì„±ë¦½í•¨ì„ ì§ì ‘ í™•ì¸.

---



## 0. ì´ í•¨ìˆ˜ê°€ í•˜ëŠ” ì¼ í•œ ì¤„ ìš”ì•½
```rust
on_basis_funs_ret_vec(knots, span, u, p) -> Vec<Real>
```
- ì…ë ¥:
  - knots: knot vector U
  - span: ì£¼ì–´ì§„ uê°€ ì†í•œ span ì¸ë±ìŠ¤ i (ë³´í†µ FindSpan ê²°ê³¼)
  - u: íŒŒë¼ë¯¸í„° ê°’
  - p: degree
- ì¶œë ¥:
  - ê¸¸ì´ p+1ì§œë¦¬ ë²¡í„°
  - ë‚´ìš©:
  - ì¦‰, í˜„ì¬ span ì£¼ë³€ì—ì„œ nonzeroì¸ pì°¨ basis ì „ë¶€
- ì´ê²Œ ìš°ë¦¬ê°€ ì´ë¡ ì—ì„œ ë§í–ˆë˜:
  - ì–´ë–¤ uê°€ ì£¼ì–´ì§€ë©´, ê·¸ uì—ì„œ nonzeroì¸ basisëŠ” ë”± p+1ê°œì´ê³ ,  
  ê·¸ ì¸ë±ìŠ¤ëŠ” $i-p,\dots ,i$ ì´ë‹¤.


### 1. special case: ì˜¤ë¥¸ìª½ ëì  ì²˜ë¦¬
```rust
let tol = ON_TOL14 * (knots[knots.len() - 1] - knots[0]).abs().max(1.0);
if (u - knots[span + 1]).abs() <= tol && span + 1 == knots.len() - 1 - p {
    n_vec[p] = 1.0;
    return n_vec;
}
```

- ì´ ë¶€ë¶„ì€ ìš°ë¦¬ê°€ ì´ë¡ ì—ì„œ ì‚´ì§ ì–¸ê¸‰í–ˆë˜:
- ë³´í†µ basisëŠ” $[U_i,U_{i+p+1})$ ì—ì„œ ì •ì˜í•˜ê³ ,  
  ë§ˆì§€ë§‰ ëì  $u=U_m$ (ë³´í†µ $U_{n+p+1}$ ) ì—ì„œëŠ”  
  ì˜¤ë¥¸ìª½ ë basis í•˜ë‚˜ë§Œ 1ë¡œ ë‘ëŠ” ì˜ˆì™¸ ì²˜ë¦¬ë¥¼ í•œë‹¤.
- span + 1 == knots.len() - 1 - p
  - ë§ˆì§€ë§‰ ìœ íš¨ span (ì˜¤ë¥¸ìª½ ë)
- u â‰ˆ knots[span+1]
  - ì˜¤ë¥¸ìª½ ë knotì— ê±°ì˜ ë”± ê±¸ë¦° ê²½ìš°
- ê·¸ë•Œ n_vec[p] = 1.0
  - ë§ˆì§€ë§‰ basis í•˜ë‚˜ë§Œ 1, ë‚˜ë¨¸ì§€ëŠ” 0
- ì¦‰, ì˜¤ë¥¸ìª½ ëì—ì„œ partition of unityë¥¼ ê¹”ë”í•˜ê²Œ ë§ì¶”ê¸° ìœ„í•œ ì˜ˆì™¸ ì²˜ë¦¬.

### 2. ì´ˆê¸°ê°’: p = 0 (0ì°¨ basis)
```rust
n_vec[0] = 1.0;
```

- ì´ê²Œ ë°”ë¡œ:
```math
N_{i,0}(u)=1\quad \mathrm{on\  }[U_i,U_{i+1})
```
- ë¥¼ **í˜„ì¬ span ê¸°ì¤€** ìœ¼ë¡œ ì¡ì€ ê²ƒ.
- ì—¬ê¸°ì„œ spanì€ ì´ë¯¸ FindSpanìœ¼ë¡œ ì°¾ì•˜ë‹¤ê³  ê°€ì •
- ì¦‰, ì§€ê¸ˆ ì´ í•¨ìˆ˜ëŠ” â€œì´ë¯¸ uê°€ spanì— ì†í•œë‹¤ê³  ì•Œê³  ìˆëŠ” ìƒíƒœì—ì„œâ€
- ê·¸ ì£¼ë³€ basisë“¤ì„ ìŒ“ì•„ ì˜¬ë¦¬ëŠ” ì¤‘
- ê·¸ë˜ì„œ ì‹œì‘ì€ í•­ìƒ:
  - **í˜„ì¬ spanì—ì„œ 0ì°¨ basisëŠ” í•˜ë‚˜ë§Œ 1ì´ë‹¤.**


### 3. j ë£¨í”„: degreeë¥¼ 0 â†’ 1 â†’ â€¦ â†’ pë¡œ ì˜¬ë¦¬ëŠ” ê³¼ì •
```rust
for j in 1..=p {
    left[j] = u - knots[span + 1 - j];
    right[j] = knots[span + j] - u;

    let mut saved = 0.0;
    for r in 0..j {
        let denom = right[r + 1] + left[j - r];
        let temp = if denom.abs() > f64::EPSILON {
            n_vec[r] / denom
        } else {
            0.0
        };
        n_vec[r] = saved + right[r + 1] * temp;
        saved = left[j - r] * temp;
    }
    n_vec[j] = saved;
}
```

- ì´ ë¶€ë¶„ì´ ë°”ë¡œ **Coxâ€“de Boor ì¬ê·€ì‹ì˜ â€œìˆ˜ì¹˜ì ìœ¼ë¡œ ì•ˆì •ëœ êµ¬í˜„**.
- ì´ë¡ ì—ì„œ ì¼ë˜ ì¬ê·€ì‹:
```math
N_{i,p}(u)=\frac{u-U_i}{U_{i+p}-U_i}N_{i,p-1}(u)+\frac{U_{i+p+1}-u}{U_{i+p+1}-U_{i+1}}N_{i+1,p-1}(u)
```
- ì´ê±¸ ê·¸ëŒ€ë¡œ ì“°ë©´ ì¸ë±ìŠ¤ê°€ ë³µì¡í•´ì§€ë‹ˆê¹Œ,
d- e BoorëŠ” í˜„ì¬ span ì£¼ë³€ì˜ basisë§Œ ê°€ì§€ê³  ë‹¤ìŒ degreeë¥¼ ë§Œë“œëŠ” í˜•íƒœë¡œ ë°”ê¿” ì“´ë‹¤.
- ì—¬ê¸°ì„œ:
  - j = í˜„ì¬ degree (1, 2, â€¦, p)
  - left[j] = u - U_{span+1-j}
  - right[j] = U_{span+j} - u
- ì´ê²Œ ì´ë¡ ì—ì„œ ë§í•œ:
  - **ì™¼ìª½ì—ì„œ ì–¼ë§ˆë‚˜ ë–¨ì–´ì¡ŒëŠ”ì§€, ì˜¤ë¥¸ìª½ì—ì„œ ì–¼ë§ˆë‚˜ ë–¨ì–´ì¡ŒëŠ”ì§€** ë¥¼ ì €ì¥í•˜ëŠ” ë¶€ë¶„.
- ê·¸ë¦¬ê³  ë‚´ë¶€ ë£¨í”„:
  - r = í˜„ì¬ degree jì—ì„œì˜ basis ì¸ë±ìŠ¤ (0..j)
  - n_vec[r] = ì´ì „ ë‹¨ê³„(j-1)ì˜ basis ê°’ë“¤
  - temp = n_vec[r] / (right[r+1] + left[j-r])
  - ì¬ê·€ì‹ì˜ ë¶„ëª¨ ($U_{i+p}-U_i$) ì—­í• 
- n_vec[r] = saved + right[r+1] * temp
- saved = left[j-r] * temp
- ì´ ë‘ ì¤„ì´ í•©ì³ì ¸ì„œ:
  - **ì´ì „ degreeì˜ basis ë‘ ê°œë¥¼ ì ì ˆí•œ ë¹„ìœ¨ë¡œ ì„ì–´ì„œ ìƒˆë¡œìš´ degreeì˜ basisë¥¼ ë§Œë“ ë‹¤**

- ì¦‰, ì´ ë£¨í”„ëŠ”:
  - j = 1 â†’ p=1 basis ìƒì„±
  - j = 2 â†’ p=2 basis ìƒì„±
  - â€¦
  - j = p â†’ ìµœì¢… pì°¨ basis ì™„ì„±
- ì´ë¼ëŠ” **degreeë¥¼ í•œ ë‹¨ê³„ì”© ì˜¬ë¦¬ëŠ” ê³¼ì •**.

### 4. ê²°ê³¼: n_vec ì•ˆì— ë­ê°€ ë“¤ì–´ ìˆë‚˜?
- ë£¨í”„ê°€ ëë‚˜ë©´:
```rust
n_vec
```

- ì—ëŠ” ë‹¤ìŒì´ ë“¤ì–´ ìˆë‹¤:
```math
n\_ vec[r]=N_{span-p+r,\; p}(u),\quad r=0,\dots ,p
```
ì¦‰:
- n_vec[0] = $N_{span-p,p}(u)$
- n_vec[1] = $N_{span-p+1,p}(u)$
- â€¦
- n_vec[p] = $N_{span,p}(u)$
- ì´ê²Œ ìš°ë¦¬ê°€ ì´ë¡ ì—ì„œ ê³„ì† ë§í–ˆë˜:
  - **ì–´ë–¤ uê°€ ì£¼ì–´ì§€ë©´, ê·¸ uì—ì„œ nonzeroì¸ pì°¨ basisëŠ” ë”± p+1ê°œì´ê³ , ì¸ë±ìŠ¤ëŠ” i-p, â€¦, iì´ë‹¤.**


### 5. ì´ í•¨ìˆ˜ê°€ ì´ë¡ ê³¼ ì–´ë–»ê²Œ ë”± ë§ì•„ë–¨ì–´ì§€ëŠ”ì§€ ìš”ì•½
- support ê´€ì 
- spanì€ ì´ë¯¸ FindSpanìœ¼ë¡œ ì°¾ì•˜ìœ¼ë¯€ë¡œ
```math
u\in [U_{span},U_{span+1})
```
- ì´ë•Œ nonzeroì¸ basisëŠ”
  - $N_{span-p,p},\dots ,N_{span,p}$ - ë”± p+1ê°œ
- ì´ í•¨ìˆ˜ëŠ” ê·¸ p+1ê°œë§Œ ê³„ì‚°í•´ì„œ ë²¡í„°ë¡œ ë°˜í™˜
- degree ê´€ì 
- n_vec[0] = 1.0 â†’ p=0 ì‹œì‘
- j ë£¨í”„ì—ì„œ p=1,2,â€¦,pë¡œ ì°¨ë¡€ëŒ€ë¡œ ì˜¬ë¦¼
- ì´ê±´ ìš°ë¦¬ê°€ ìˆ˜ì‹ìœ¼ë¡œ í–ˆë˜ **0ì°¨ indicator â†’ 1ì°¨ â†’ 2ì°¨ â€¦**

- Coxâ€“de Boor ê´€ì 
- left, rightëŠ” $(u-U_i), (U_{i+p+1}-u)$ ì—­í• 
- temp, saved, n_vec[r] ì—…ë°ì´íŠ¸ëŠ” ì¬ê·€ì‹ì„ ìˆ˜ì¹˜ì ìœ¼ë¡œ ì•ˆì •ë˜ê²Œ í’€ì–´ì“´ í˜•íƒœ
- ë¶„ëª¨ê°€ 0ì´ë©´ 0ìœ¼ë¡œ ì²˜ë¦¬ â†’
  ìš°ë¦¬ê°€ ë§í•œ **ë¶„ëª¨ 0ì´ë©´ ê·¸ í•­ì€ 0** ê·œì¹™ê³¼ ë™ì¼
- endpoint ê´€ì 
- ì˜¤ë¥¸ìª½ ëì—ì„œë§Œ íŠ¹ë³„íˆ **ë§ˆì§€ë§‰ basis í•˜ë‚˜ë§Œ 1** ë¡œ ë‘ëŠ” ì˜ˆì™¸ ì²˜ë¦¬
- ì´ê±´ ìš°ë¦¬ê°€ support/partition of unity ì„¤ëª…í•  ë•Œ
  - $u=U_{n+p+1}$ ì—ì„œë§Œ ì‚´ì§ ë‹¤ë¥´ê²Œ ì²˜ë¦¬í•œë‹¤ê³  í–ˆë˜ ë¶€ë¶„ê³¼ ì •í™•íˆ ì¼ì¹˜

- í•œë§ˆë””ë¡œ:
- ì´ í•¨ìˆ˜ëŠ” ìš°ë¦¬ê°€ ìˆ˜ì‹ìœ¼ë¡œ ì „ê°œí–ˆë˜
  $N_{i,p}(u)$ ì˜ Coxâ€“de Boor ì¬ê·€ ì •ì˜ë¥¼, **í˜„ì¬ span ì£¼ë³€ p+1ê°œ basisë§Œ** íš¨ìœ¨ì ìœ¼ë¡œ ê³„ì‚°

- ì›í•˜ë©´:
- ì´ í•¨ìˆ˜ê°€ ë°˜í™˜í•˜ëŠ” n_vecì„ ì´ìš©í•´ì„œ
- ì‹¤ì œ curve point
```math
C(u)=\sum _jN_{j,p}(u)P_j
```
---

## ğŸ¯ ë¨¼ì € special case ì¡°ê±´ì„ ë‹¤ì‹œ ë³´ì
```rust
let tol = ON_TOL14 * (knots[knots.len() - 1] - knots[0]).abs().max(1.0);

if (u - knots[span + 1]).abs() <= tol
    && span + 1 == knots.len() - 1 - p
{
    n_vec[p] = 1.0;
    return n_vec;
}
```

- ì´ ì¡°ê±´ì€ ë‘ ê°€ì§€ë¥¼ ë™ì‹œì— ë§Œì¡±í•´ì•¼ í•œë‹¤:

### âœ” ì¡°ê±´ 1: u â‰ˆ knots[span+1]
- ì¦‰,
```math
u\approx U_{span+1}
```
- ì´ê±´ uê°€ ì˜¤ë¥¸ìª½ ë knotì— ê±°ì˜ ì •í™•íˆ ê±¸ë¦° ê²½ìš°ë¥¼ ì˜ë¯¸í•œë‹¤.
- ì˜ˆë¥¼ ë“¤ì–´ ë„ˆì˜ knot:
```math
U=[0,0,0,1,2,3,3,3],\quad p=2
```
ì˜¤ë¥¸ìª½ ë knotëŠ” $U_7=3$.

### âœ” ì¡°ê±´ 2: span + 1 == knots.len() - 1 - p
- knots.len() = 8
- p = 2
- ë”°ë¼ì„œ:
  - knots.len()-1-p=8-1-2=5
- ì¦‰,
```math
span+1=5\quad \Rightarrow \quad span=4
```
- ì´ê±´ uê°€ ë§ˆì§€ë§‰ ìœ íš¨ spanì— ì†í•´ì•¼ í•œë‹¤ëŠ” ëœ».
- ë„ˆì˜ knotì—ì„œ span=4ëŠ”:
```math
[U_4,U_5)=[2,3)
```
- ì¦‰, ë§ˆì§€ë§‰ ìœ íš¨ êµ¬ê°„.

## ğŸ¯ ë‘ ì¡°ê±´ì„ í•©ì¹˜ë©´?
- special caseëŠ” ë‹¤ìŒ ìƒí™©ì—ì„œë§Œ ë°œë™í•œë‹¤:
  - u â‰ˆ 3 (ì˜¤ë¥¸ìª½ ë knot)
  - span = 4 (ë§ˆì§€ë§‰ ìœ íš¨ span)
- ì¦‰,
- uê°€ ì •í™•íˆ ì˜¤ë¥¸ìª½ ëì (3)ì— ìˆì„ ë•Œ,  
  ë§ˆì§€ë§‰ basis í•˜ë‚˜ë§Œ 1ë¡œ ë‘ê³  ë‚˜ë¨¸ì§€ëŠ” 0ìœ¼ë¡œ ë§Œë“ ë‹¤.


## ğŸ”¥ ì™œ ì´ë ‡ê²Œ í•´ì•¼ í• ê¹Œ? (ì´ë¡ ê³¼ ì—°ê²°)
- Bâ€‘spline basisëŠ” ì›ë˜ ë‹¤ìŒ êµ¬ê°„ì—ì„œ ì •ì˜ëœë‹¤:
```math
N_{i,p}(u)\neq 0\quad \mathrm{only\  on\  }[U_i,U_{i+p+1})
```
- ê·¸ëŸ°ë° ì´ êµ¬ê°„ì€ ì™¼ìª½ í¬í•¨, ì˜¤ë¥¸ìª½ ë¯¸í¬í•¨ì´ë‹¤.
- ì¦‰,
```math
[U_i,U_{i+p+1})
```
- ì´ê¸° ë•Œë¬¸ì— ì˜¤ë¥¸ìª½ ëì ì—ì„œëŠ” ëª¨ë“  basisê°€ 0ì´ ë˜ì–´ë²„ë¦°ë‹¤.
- ì˜ˆë¥¼ ë“¤ì–´:
- $N_{2,2}$ support = 0,3)
- $N_{3,2}$ support = 2,3)
- ë‘˜ ë‹¤ u = 3ì—ì„œëŠ” 0.
- ê·¸ëŸ¬ë©´ partition of unity:
```math
\sum _iN_{i,2}(u)=1
```
- ì´ u = 3ì—ì„œ ê¹¨ì ¸ë²„ë¦°ë‹¤.
- ê·¸ë˜ì„œ Bâ€‘spline êµ¬í˜„ì—ì„œëŠ” ê´€ë¡€ì ìœ¼ë¡œ:
  - ì˜¤ë¥¸ìª½ ëì ì—ì„œëŠ” ë§ˆì§€ë§‰ basis í•˜ë‚˜ë§Œ 1ë¡œ ë‘”ë‹¤.

- ì¦‰,
```math
N_{n,p}(U_{n+p+1})=1
```
- ì´ê±¸ ì½”ë“œë¡œ êµ¬í˜„í•œ ê²Œ ë°”ë¡œ special case.

## ğŸ¯ degree = 2ì¼ ë•Œ ì‹¤ì œë¡œ ì–´ë–»ê²Œ ì±„ì›Œì§€ëŠ”ê°€?
- ë„ˆì˜ knot:
```math
U=[0,0,0,1,2,3,3,3]
```
- degree = 2 â†’ p = 2
- control point ê°œìˆ˜ = n+1 = knots.len() - p - 1 = 8 - 2 - 1 = 5
- ì¦‰, basis indexëŠ” 0..4
- ì˜¤ë¥¸ìª½ ëì  u = 3ì—ì„œ:
  - span = 4 (FindSpan ê²°ê³¼)
  - span+1 = 5
  - knots.len() - 1 - p = 5
- ì¡°ê±´ ë§Œì¡±.
- ë”°ë¼ì„œ:
```rust
n_vec = [0, 0, 0]
n_vec[p] = n_vec[2] = 1.0
```

- ì¦‰:
```math
[N_{2,2}(3),N_{3,2}(3),N_{4,2}(3)]=[0,0,1]
```
- ì´ê²Œ ë°”ë¡œ ìš°ë¦¬ê°€ ì´ë¡ ì—ì„œ ë§í–ˆë˜:  
  - **ì˜¤ë¥¸ìª½ ëì—ì„œëŠ” ë§ˆì§€ë§‰ basisë§Œ 1**


## ğŸ¯ í•œ ì¤„ ìš”ì•½
- degree = 2ì¼ ë•Œ special caseëŠ”:
  - uê°€ ì˜¤ë¥¸ìª½ ë knotì— ì •í™•íˆ ê±¸ë¦¬ê³ 
  - spanì´ ë§ˆì§€ë§‰ ìœ íš¨ spanì¼ ë•Œ
= ìë™ìœ¼ë¡œ:
```math
N_{i-2,2}(u)=0,\quad N_{i-1,2}(u)=0,\quad N_{i,2}(u)=1
```
- ì´ë ‡ê²Œ ì±„ìš´ë‹¤.
- ì¦‰, ì˜¤ë¥¸ìª½ ëì ì—ì„œ partition of unityë¥¼ ìœ ì§€í•˜ê¸° ìœ„í•œ í•„ìˆ˜ ì²˜ë¦¬.

---
## ì†ŒìŠ¤ ì½”ë“œ
```rust
/// BasisFuns(i, u, p) â†’ returns length p + 1
pub fn on_basis_funs_ret_vec(knots: &[Real], span: usize, u: Real, p: usize) -> Vec<Real> {
    let mut n_vec = vec![0.0; p + 1];
    let mut left = vec![0.0f64; p + 1];
    let mut right = vec![0.0f64; p + 1];

    // ---- Special case at right endpoint (u == U[span+1]) ----
    // For a clamped curve, if u == U[n+1] and span == n, then N[p] = 1 and others = 0
    // (Use a small tolerance to account for numerical error)
    let tol = ON_TOL14 * (knots[knots.len() - 1] - knots[0]).abs().max(1.0);
    if (u - knots[span + 1]).abs() <= tol && span + 1 == knots.len() - 1 - p {
        n_vec[p] = 1.0;
        return n_vec;
    }

    n_vec[0] = 1.0;
    for j in 1..=p {
        left[j] = u - knots[span + 1 - j];
        right[j] = knots[span + j] - u;

        let mut saved = 0.0;
        for r in 0..j {
            let denom = right[r + 1] + left[j - r];
            let temp = if denom.abs() > f64::EPSILON {
                n_vec[r] / denom
            } else {
                0.0
            };
            n_vec[r] = saved + right[r + 1] * temp;
            saved = left[j - r] * temp;
        }
        n_vec[j] = saved;
    }
    n_vec
}
```
---

