# de Casteljau Bezier

- ì»¨íŠ¸ë¡¤ í¬ì¸íŠ¸ë“¤ $P_i$ ì—ì„œ ì‹œìž‘í•´ì„œ,
- de Casteljau ìž¬ê·€ì‹
```math
P_{k,i}=(1-u_0)P_{k-1,i}+u_0P_{k-1,i+1}
```
- ë¥¼ k=1ë¶€í„° nê¹Œì§€ ë°˜ë³µí•´ì„œ ë‚´ë ¤ê°€ë©´,
- ë§ˆì§€ë§‰ì— ë‚¨ëŠ” $P_{n,0}(u_0)$ ê°€ ë°”ë¡œ BÃ©zier ê³¡ì„  ìœ„ì˜ ì‹¤ì œ ì  ì¢Œí‘œë‹¤.


## BÃ©zier ê³¡ì„ ì˜ ë‘ ê°€ì§€ í‘œí˜„
- Bernstein í•© í‘œí˜„
```math
C(u)=\sum _{i=0}^nB_{i,n}(u)\, P_i
```
- de Casteljau ìž¬ê·€ ì•Œê³ ë¦¬ì¦˜
```math
P_{k,i}(u)=(1-u)P_{k-1,i}(u)+uP_{k-1,i+1}(u),\quad C(u)=P_{n,0}(u)
```
- ì´ ë‘˜ì´ **ì™„ì „ížˆ ê°™ì€ ì  C(u)** ë¥¼ ì¤€ë‹¤.

- ì§ì ‘ ëˆˆì— ë³´ì´ê²Œ ì „ê°œ.

### 1. n=2 (2ì°¨)ì—ì„œ ë¨¼ì € í™•ì¸
- 2ì°¨ BÃ©zier:
```math
C(u)=(1-u)^2P_0+2u(1-u)P_1+u^2P_2
```
- de Casteljau:
- 1ë‹¨ê³„:
```math
P_{1,0}=(1-u)P_0+uP_1
```
```math
P_{1,1}=(1-u)P_1+uP_2
```
- 2ë‹¨ê³„:
```math
P_{2,0}=(1-u)P_{1,0}+uP_{1,1}
```
- ì´ì œ $P_{2,0}$ ì„ ì „ê°œí•´ë³´ìž:

- ì¦‰,
```math
P_{2,0}=C(u)
```
- 2ì°¨ì—ì„œëŠ” ë‘ í‘œí˜„ì´ ì™„ì „ížˆ ë™ì¼í•¨ì´ ì§ì ‘ ë³´ì¸ë‹¤.

### 2. ì¼ë°˜ nì— ëŒ€í•´ ì•„ì´ë””ì–´: â€œì„ í˜• ë³´ê°„ì˜ ë°˜ë³µ = Bernstein ì¡°í•©â€
- í•µì‹¬ ì•„ì´ë””ì–´ëŠ”:
    - de CasteljauëŠ” ì„ í˜• ë³´ê°„ì„ në²ˆ ë°˜ë³µí•˜ëŠ” ì•Œê³ ë¦¬ì¦˜
    - ì„ í˜• ë³´ê°„ì„ ë°˜ë³µí•˜ë©´, ê²°êµ­ ê° P_iì— ë¶™ëŠ” ê³„ìˆ˜ê°€ Bernstein ë‹¤í•­ì‹ì´ ëœë‹¤
- ì´ë¥¼ ì¡°ê¸ˆ ë” êµ¬ì¡°ì ìœ¼ë¡œ ë³´ìž.

### 3. de Casteljauë¥¼ ê³„ìˆ˜ í˜•íƒœë¡œ ë‹¤ì‹œ ì“°ê¸°
- ì´ˆê¸°:
```math
P_{0,i}=P_i
```
- 1ë‹¨ê³„(k=1):
```math
P_{1,i}=(1-u)P_{0,i}+uP_{0,i+1}
```
- ì´ê±¸ â€œê³„ìˆ˜â€ ê´€ì ì—ì„œ ë³´ë©´:
```math
P_{1,i}=\sum _{j=0}^n\alpha _{i,j}^{(1)}(u)\, P_j
```
- ì‹¤ì œë¡œëŠ”:
- $P_{1,0}=(1-u)P_0+uP_1$
- $P_{1,1}=(1-u)P_1+uP_2$
- â€¦
- ì¦‰, ê° ë‹¨ê³„ì—ì„œ ê³„ìˆ˜ë“¤ì´ $(1-u), u$ ë¡œ ì„žì—¬ ë‚˜ê°„ë‹¤.
- kë‹¨ê³„ì—ì„œ:
```math
P_{k,i}=\sum _{j=0}^n\alpha _{i,j}^{(k)}(u)\, P_j
```
- ê·¸ë¦¬ê³  ìž¬ê·€ì‹:
```math
P_{k,i}=(1-u)P_{k-1,i}+uP_{k-1,i+1}
```
- ê³„ìˆ˜ë¡œ ì“°ë©´:
```math
\alpha _{i,j}^{(k)}(u)=(1-u)\, \alpha _{i,j}^{(k-1)}(u)+u\, \alpha _{i+1,j}^{(k-1)}(u)
```
- ì´ˆê¸° ì¡°ê±´:
```math
\alpha _{i,j}^{(0)}(u)=\left\{ \, \begin{array}{ll}\textstyle 1&\textstyle i=j\\ \textstyle 0&\textstyle i\neq j\end{array}\right.
``` 
- ì´ êµ¬ì¡°, ì–´ë””ì„œ ë§Žì´ ë³¸ í˜•íƒœì§€?

### 4. ì´ ìž¬ê·€ì‹ì€ ì‚¬ì‹¤ Bernstein ìž¬ê·€ì‹ê³¼ ë™ì¼í•˜ë‹¤
- Bernstein ë‹¤í•­ì‹ ìž¬ê·€ì‹:
```math
B_{i,n}(u)=(1-u)B_{i,n-1}(u)+uB_{i-1,n-1}(u)
```
- ì§€ê¸ˆ ìš°ë¦¬ê°€ ì–»ì€ ê³„ìˆ˜ ìž¬ê·€ì‹:
```math
\alpha _{i,j}^{(k)}(u)=(1-u)\, \alpha _{i,j}^{(k-1)}(u)+u\, \alpha _{i+1,j}^{(k-1)}(u)
```
- ì¸ë±ìŠ¤ë¥¼ ì ì ˆížˆ ë°”ê¾¸ë©´,
- **kë‹¨ê³„ì—ì„œ ië²ˆì§¸ ì ì— ë¶™ëŠ” jë²ˆì§¸ ì»¨íŠ¸ë¡¤ í¬ì¸íŠ¸ì˜ ê³„ìˆ˜** ê°€
    ê²°êµ­ ì–´ë–¤ Bernstein ë‹¤í•­ì‹ì´ ëœë‹¤ëŠ” ê±¸ ë³¼ ìˆ˜ ìžˆìŒ.
- íŠ¹ížˆ ë§ˆì§€ë§‰ ë‹¨ê³„ k=n,i=0ì—ì„œ:
```math
P_{n,0}(u)=\sum _{j=0}^n\alpha _{0,j}^{(n)}(u)\, P_j
```
- ì´ë•Œ $\alpha _{0,j}^{(n)}(u)$ ê°€ ë°”ë¡œ $B_{j,n}(u)$ ê°€ ëœë‹¤.
- ì¦‰:
```math
P_{n,0}(u)=\sum _{j=0}^nB_{j,n}(u)\, P_j=C(u)
```

### 5. ì§ê´€ì ìœ¼ë¡œ ì •ë¦¬í•˜ë©´
- de CasteljauëŠ” **ì»¨íŠ¸ë¡¤ í¬ì¸íŠ¸ë“¤ì„ u ë¹„ìœ¨ë¡œ ê³„ì† ì„žì–´ê°€ëŠ” ê³¼ì •**
- ì´ ì„žìž„ì˜ ëª¨ë“  ì¡°í•©ì„ ì „ê°œí•˜ë©´,  
    ê° $P_i$ ì— ë¶™ëŠ” ê³„ìˆ˜ëŠ” **uì™€ (1-u)ì˜ ì¡°í•©** ìœ¼ë¡œ ì´ë£¨ì–´ì§„ ë‹¤í•­ì‹ì´ ëœë‹¤
- ê·¸ ë‹¤í•­ì‹ì´ ë°”ë¡œ Bernstein ë‹¤í•­ì‹ $B_{i,n}(u)$
- ê·¸ëž˜ì„œ ë§ˆì§€ë§‰ì— ë‚˜ì˜¤ëŠ” $P_{n,0}(u)$ ëŠ”
```math
P_{n,0}(u)=\sum _{i=0}^nB_{i,n}(u)\, P_i=C(u)
```
- ì¦‰, â€œBernstein í•© í‘œí˜„â€ê³¼ **de Casteljau ì•Œê³ ë¦¬ì¦˜** ì€
    ì™„ì „ížˆ ê°™ì€ ê³¡ì„ , ê°™ì€ ì ì„ ë‹¤ë¥¸ ë°©ì‹ìœ¼ë¡œ ê³„ì‚°í•˜ëŠ” ê²ƒì¼ ë¿ì´ë‹¤.

## 6. í•œ ë¬¸ìž¥ ìš”ì•½
- de CasteljauëŠ” ì»¨íŠ¸ë¡¤ í¬ì¸íŠ¸ë¥¼ ì„ í˜• ë³´ê°„ìœ¼ë¡œ ë°˜ë³µí•´ì„œ ì„žëŠ” ì•Œê³ ë¦¬ì¦˜ì´ê³ ,  
    ê·¸ ë°˜ë³µ ë³´ê°„ì—ì„œ ìžì—°ìŠ¤ëŸ½ê²Œ ìƒê¸°ëŠ” ê³„ìˆ˜ë“¤ì´ ë°”ë¡œ Bernstein ë‹¤í•­ì‹ì´ê¸° ë•Œë¬¸ì—,  
- ë§ˆì§€ë§‰ ì  $P_{n,0}(u)$ ëŠ”
```math
P_{n,0}(u)=\sum _{i=0}^nB_{i,n}(u)\, P_i=C(u)
```
- ë¡œ, Bernstein í‘œí˜„ê³¼ ì™„ì „ížˆ ë™ì¼í•œ ê²°ê³¼ë¥¼ ì¤€ë‹¤.

```rust
fn de_casteljau_scalar(ctrl: &[Real], t: Real) -> Real {
    let mut tmp = ctrl.to_vec();
    let n = tmp.len();
    if n == 0 {
        return 0.0;
    }
    for r in 1..n {
        for i in 0..(n - r) {
            tmp[i] = (1.0 - t) * tmp[i] + t * tmp[i + 1];
        }
    }
    tmp[0]
}
```
```rust
fn de_casteljau_point3(ctrl: &[Point3D], t: Real) -> Point3D {
    let mut tmp = ctrl.to_vec();
    let n = tmp.len();
    if n == 0 {
        return Point3D::zero();
    }
    for r in 1..n {
        for i in 0..(n - r) {
            tmp[i] = Point3D {
                x: (1.0 - t) * tmp[i].x + t * tmp[i + 1].x,
                y: (1.0 - t) * tmp[i].y + t * tmp[i + 1].y,
                z: (1.0 - t) * tmp[i].z + t * tmp[i + 1].z,
            };
        }
    }
    tmp[0]
}
```
- ì„ ê·¸ëŒ€ë¡œ ì½”ë“œë¡œ ì˜®ê¸°ë©´ ë°”ë¡œ ì´ í˜•íƒœê°€ ëœë‹¤.
---

## ðŸŸ¦ 1. ìž…ë ¥: ì»¨íŠ¸ë¡¤ í¬ì¸íŠ¸ ë°°ì—´
- ì˜ˆë¥¼ ë“¤ì–´ $ctrl = [P_0,P_1,\dots ,P_n]$
- ìˆ˜ì‹ì—ì„œëŠ”:
```math
P_{0,i}=P_i
```
- ì½”ë“œì—ì„œëŠ”:
```rust
let mut tmp = ctrl.to_vec();
```

- ì¦‰, $tmp[i] = P_{0,i}$
    - ì´ˆê¸° ì‚¼ê°í˜•ì˜ ë§¨ ìœ„ ì¤„ì„ ê·¸ëŒ€ë¡œ ë³µì‚¬

## ðŸŸ¦ 2. ë°”ê¹¥ ë£¨í”„: k = 1..n (ì‚¼ê°í˜•ì˜ ë‹¨ê³„)
- ìˆ˜ì‹ì—ì„œëŠ”:
```math
k=1,2,\dots ,n
```
- ì½”ë“œì—ì„œëŠ”:
```rust
for r in 1..n {
```

- ì—¬ê¸°ì„œ rì´ ë°”ë¡œ ìˆ˜ì‹ì˜ kì— í•´ë‹¹í•œë‹¤.
- ì¦‰:
    - r = 1 â†’ ì²« ë²ˆì§¸ ë³´ê°„
    - r = 2 â†’ ë‘ ë²ˆì§¸ ë³´ê°„
    - â€¦
    - r = n â†’ ë§ˆì§€ë§‰ ë³´ê°„

## ðŸŸ¦ 3. ì•ˆìª½ ë£¨í”„: i = 0..(n-k)
- ìˆ˜ì‹ì—ì„œëŠ”:
```math
i=0,1,\dots ,n-k
```
- ì½”ë“œì—ì„œëŠ”:
```rust
for i in 0..(n - r) {
```

- ì™„ì „ížˆ ë™ì¼í•˜ë‹¤.

## ðŸŸ¦ 4. í•µì‹¬ ë³´ê°„ì‹:
```math
tmp[i] = (1-t) * tmp[i] + t * tmp[i+1]
```
- ìˆ˜ì‹:
```math
P_{k,i}(t)=(1-t)P_{k-1,i}(t)+tP_{k-1,i+1}(t)
```
- ì½”ë“œ:
```math
tmp[i] = (1.0 - t) * tmp[i] + t * tmp[i + 1];
```

- ì´ê±´ ìˆ˜ì‹ì„ 1:1ë¡œ ì˜®ê¸´ ê²ƒì´ë‹¤.
- $tmp[i] â†’ P_{k-1,i}$
- $tmp[i+1] â†’ P_{k-1,i+1}$
- $tmp[i] = â€¦ â†’ P_{k,i}$ ë¡œ ì—…ë°ì´íŠ¸
- ì¦‰, ì‚¼ê°í˜•ì˜ ë‹¤ìŒ ì¤„ì„ ê³„ì‚°í•˜ëŠ” ê³¼ì •ì„ ê·¸ëŒ€ë¡œ êµ¬í˜„í•œ ê²ƒ.

## ðŸŸ¦ 5. ë°˜ë³µì´ ëë‚˜ë©´ tmp[0]ë§Œ ë‚¨ëŠ”ë‹¤
- ìˆ˜ì‹ì—ì„œëŠ”:
```math
C(t)=P_{n,0}(t)
```
- ì½”ë“œì—ì„œëŠ”:
```rust
tmp[0]
```

- ì¦‰:
- ì²« ë²ˆì§¸ ì¤„: $P0, P1, P2, â€¦, Pn$
- ë‘ ë²ˆì§¸ ì¤„: $P_{1,0}, P_{1,1}, â€¦$
- ì„¸ ë²ˆì§¸ ì¤„: $P_{2,0}, P_{2,1}, â€¦$
- â€¦
- ë§ˆì§€ë§‰ ì¤„: $P_{n,0}$
- ì´ ë§ˆì§€ë§‰ í•˜ë‚˜ê°€ ê³¡ì„  ìœ„ì˜ ì .

## ðŸŸ¦ 6. Point3D ë²„ì „ë„ ì™„ì „ížˆ ë™ì¼
- ìŠ¤ì¹¼ë¼ ë²„ì „:
```rust
tmp[i] = (1-t)*tmp[i] + t*tmp[i+1];
```

- Point3D ë²„ì „:
```rust
tmp[i] = Point3D {
    x: (1-t)*tmp[i].x + t*tmp[i+1].x,
    y: (1-t)*tmp[i].y + t*tmp[i+1].y,
    z: (1-t)*tmp[i].z + t*tmp[i+1].z,
};
```

- ì¦‰, ë²¡í„° ë³´ê°„ì„ ì„±ë¶„ë³„ë¡œ ìˆ˜í–‰í•œ ê²ƒì¼ ë¿ ìˆ˜ì‹ì€ ì™„ì „ížˆ ë™ì¼í•˜ë‹¤.

## ðŸŸ¦ 7. ì „ì²´ ëŒ€ì‘í‘œ
| ìˆ˜ì‹ í‘œí˜„                                   | ì½”ë“œ í‘œí˜„                                   |
|---------------------------------------------|----------------------------------------------|
| P_{0,i} = P_i                               | tmp = ctrl.to_vec()                          |
| k = 1 .. n                                  | for r in 1..n                                |
| i = 0 .. (n - k)                            | for i in 0..(n - r)                          |
| $P_{k,i} = (1 - t) * P_{k-1,i} + t * P_{k-1,i+1}$ | tmp[i] = (1.0 - t) * tmp[i] + t * tmp[i+1] |
| $C(t) = P_{n,0}$                              | tmp[0]                                       |


- ì¦‰, ì½”ë“œê°€ de Casteljau ì•Œê³ ë¦¬ì¦˜ì„ 100% ì •í™•í•˜ê²Œ êµ¬í˜„í•˜ê³  ìžˆë‹¤.

## ðŸŸ¦ 8. í•œ ë¬¸ìž¥ ìš”ì•½
- ì´ ì½”ë“œëŠ” de Casteljau ìˆ˜ì‹
```math
P_{k,i}=(1-t)P_{k-1,i}+tP_{k-1,i+1}
```
- ì„ ê·¸ëŒ€ë¡œ ë‘ ì¤‘ì²© forë¬¸ìœ¼ë¡œ êµ¬í˜„í•œ ê²ƒì´ë©°, ë§ˆì§€ë§‰ tmp[0]ì´ ê³¡ì„  ìœ„ì˜ ì  C(t)ì´ ëœë‹¤.

```rust
// -----------------------------
// Evaluate Bezier curve control points (Point3D)
// -----------------------------
fn eval_bezier_curve_point3(ctrl: &[Point3D], t: Real) -> Point3D {
    de_casteljau_point3(ctrl, t)
}

// Evaluate Bezier function (scalar)
fn eval_bezier_function(ctrl: &[Real], t: Real) -> Real {
    de_casteljau_scalar(ctrl, t)
}
```
---
