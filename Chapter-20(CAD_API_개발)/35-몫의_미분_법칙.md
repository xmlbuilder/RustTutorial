# 몫의 미분 법칙

이 함수들은 고차 도함수 계산에서 자주 등장하는 **몫의 미분 법칙(Quotient Rule)** 을 다변수에 대해 일반화한 구현입니다.  
특히 곡면이나 곡선의 파라메트릭 표현에서 F=\frac{X}{W} 형태의 함수에 대해 도함수를 계산할 때 사용됩니다.  
아래에 각 함수의 기능, 수식, 단계별 설명을 정리.  

## 📘 전체 개요
### 목적
- 파라메트릭 함수 $F(s,t)=\frac{X(s,t)}{W(s,t)}$ 또는 $F(r,s,t)=\frac{X(r,s,t)}{W(r,s,t)}$ 에 대해
- 고차 도함수 $\partial ^nF/\partial s^i\partial t^j$ 또는 $\partial ^nF/\partial r^i\partial s^j\partial t^k$ 를 계산
입력 구조
- v: 각 도함수 블록에 대해 [X,Y,Z,...,W] 형태로 저장된 배열
- v_stride: 각 블록의 크기 (예: dim + 1)
- dim: 공간 차원 (예: 3 → X, Y, Z)
- der_count: 최대 미분 차수

## 🧮 핵심 수식: 몫의 미분 법칙
### 1변수 버전 (기본형)

$$
F(u)=\frac{X(u)}{W(u)}\Rightarrow F'=\frac{X'}{W}-\frac{W'}{W}\cdot F
$$

### 2변수 버전

$$
F(s,t)=\frac{X(s,t)}{W(s,t)}
$$
- 1차 도함수

$$
F_s=\frac{X_s}{W}-\frac{W_s}{W}\cdot F\\& F_t=\frac{X_t}{W}-\frac{W_t}{W}\cdot F
$$
- 2차 도함수

$$
F_{ss}=\frac{X_{ss}}{W}-2\frac{W_s}{W}F_s-\frac{W_{ss}}{W}F\\& F_{st}=\frac{X_{st}}{W}-\frac{W_s}{W}F_t-\frac{W_t}{W}F_s-\frac{W_{st}}{W}F\\& F_{tt}=\frac{X_{tt}}{W}-2\frac{W_t}{W}F_t-\frac{W_{tt}}{W}F
$$

- 고차 일반식


### 3변수 버전

$$
F(r,s,t)=\frac{X(r,s,t)}{W(r,s,t)}
$$

- 1차 도함수


$$
F_r=\frac{X_r}{W}-\frac{W_r}{W}\cdot F\\& F_s=\frac{X_s}{W}-\frac{W_s}{W}\cdot F\\& F_t=\frac{X_t}{W}-\frac{W_t}{W}\cdot F
$$

- 2차 도함수

$$
F_{rr}=\frac{X_{rr}}{W}-2\frac{W_r}{W}F_r-\frac{W_{rr}}{W}F\\ F_{rs}=\frac{X_{rs}}{W}-\frac{W_r}{W}F_s-\frac{W_s}{W}F_r-\frac{W_{rs}}{W}F\\ F_{rt}=\dots \quad F_{ss},F_{st},F_{tt}\mathrm{도\  동일\  구조}
$$

- 고차 일반식


## 🔧 함수별 기능 설명
### 🔹 idx2(v_stride, i, j)
- 2변수 파셜 도함수 블록의 인덱스를 계산
- 블록 순서는 총차수 d=i+j 기준으로 삼각형 배열
- 수식:

$$
\mathrm{index}=\left( \frac{d(d+1)}{2}+j\right) \cdot v_{\mathrm{stride}}
$$

### 🔹 idx3(v_stride, i, j, k)
- 3변수 파셜 도함수 블록의 인덱스를 계산
- 블록 순서는 총차수 d=i+j+k 기준으로 3차원 피라미드 배열
- 수식:

$$
\mathrm{index}=v_{\mathrm{stride}}\cdot \left( \frac{d(d+1)(d+2)}{6}+\frac{(j+k)(j+k+1)}{2}+k\right)
$$


### 🔹 evaluate_quotient_rule2
- 2변수 몫 함수 $F(s,t)=X/W$ 에 대해 고차 도함수 계산
- 단계:
    - 모든 블록을 W로 나눠서 X/W로 변환
    - 1차 도함수 계산: $F_s$ , $F_t$
    - 2차 도함수 계산: $F_{ss}$ , $F_{st}$ , $F_{tt}$
    - 3차 이상 도함수는 일반식으로 누적 계산

### 🔹 evaluate_quotient_rule3
- 3변수 몫 함수 $F(r,s,t)=X/W$ 에 대해 고차 도함수 계산
- 단계:
    - 모든 블록을 W로 나눠서 $X/W$ 로 변환
    - 1차 도함수 계산: $F_r$ , $F_s$ , $F_t$
    - 2차 도함수 계산: $F_{rr}$ , $F_{rs}$ , $F_{rt}$ , $F_{ss}$ , $F_{st}$ , $F_{tt}$
    - 3차 이상 도함수는 일반식으로 누적 계산

## 📌 요약

| 함수 이름                  | 적용 대상             | 기능 요약 또는 수식 설명                                                                 |
|---------------------------|-----------------------|------------------------------------------------------------------------------------------|
| `idx2`                    | 2변수 도함수 인덱스   | $\left( \frac{(i+j)(i+j+1)}{2} + j \right) \cdot v_s$                                |
| `idx3`                    | 3변수 도함수 인덱스   | $v_s \cdot \left( \frac{d(d+1)(d+2)}{6} + \frac{(j+k)(j+k+1)}{2} + k \right)$         |
| `evaluate_quotient_rule2` | $F(s,t) = X/W$     | 2변수 몫 함수의 고차 도함수 계산 (1차, 2차, n차 일반식 포함)                           |
| `evaluate_quotient_rule3` | $F(r,s,t) = X/W$   | 3변수 몫 함수의 고차 도함수 계산 (1차, 2차, n차 일반식 포함)                           |

---




