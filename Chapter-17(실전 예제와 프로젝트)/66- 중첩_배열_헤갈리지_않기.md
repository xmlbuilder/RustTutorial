
# 중첩 배열 다루기
##  4중 중첩 배열로 설명
- Rust의 vec![vec![vec![vec![...]]]] 패턴은 문법적으로는 간단하지만,  
    i, j, k, l이 각각 무엇을 의미하는지 머릿속에서 정리되지 않으면 금방 혼란이 온다.


## 🎯 먼저, 이 코드가 의미하는 구조부터 정리해보자
```rust
let mut bd = vec![
    vec![vec![vec![0.0 as Real; q + 1]; p + 1]; vdr + 1];
    udr + 1
];
```

- 이건 4차원 배열이다.
- 즉:
```rust
bd[i][j][k][l]
```
- 이렇게 접근하는 구조.

### 🧱 1. 각 차원의 의미를 설명하면
- Rust의 vec![X; N]은 X를 N번 복제해서 벡터를 만든다.
- 따라서:
#### 1) 가장 안쪽
```rust
vec![0.0 as Real; q + 1]
```
- 길이가 q+1인 1차원 벡터
- 인덱스: l

#### 2) 그 바깥
```rust
vec![ vec![0.0; q+1]; p + 1 ]
```
- (p+1)개의 1차원 벡터
- 인덱스: k
#### 3) 그 바깥
```rust
vec![ vec![vec![0.0; q+1]; p+1]; vdr + 1 ]
```
- (vdr+1)개의 2차원 벡터
- 인덱스: j
#### 4) 가장 바깥
```rust
vec![ vec![vec![vec![0.0; q+1]; p+1]; vdr+1]; udr + 1 ]
```

- (udr+1)개의 3차원 벡터
- 인덱스: i

### 🧭 2. 그래서 최종 구조는 이렇게 된다
```rust
bd[i][j][k][l]
```

| Dimension | Index | Length     | Description                     |
|----------|--------|------------|---------------------------------|
| 4D       | i      | udr + 1    | Outermost vector                |
| 3D       | j      | vdr + 1    | Inside i                        |
| 2D       | k      | p + 1      | Inside j                        |
| 1D       | l      | q + 1      | Innermost vector (Real values)  |

```
bd
 └── [i]  (udr+1)
      └── [j]  (vdr+1)
           └── [k]  (p+1)
                └── [l]  (q+1)  --> Real 값
```
```rust
bd[i][j][k][l]
```
```
i: 0 .. udr
j: 0 .. vdr
k: 0 .. p
l: 0 .. q
```

- 즉:
    - i → 가장 큰 그룹
    - j → 그 안의 그룹
    - k → 그 안의 그룹
    - l → 실제 값

### 🧠 3. 헷갈리지 않는 “4차원 벡터 암기법”
#### ✔ 1) 가장 안쪽부터 이름 붙이기
```
L = q+1
K = p+1
J = vdr+1
I = udr+1
```

#### ✔ 2) 구조를 이렇게 그리기
```
I 개의
  J 개의
    K 개의
      L 개의 Real 값
```

#### ✔ 3) 코드로 표현하면
```rust
bd: Vec<          // I
      Vec<        // J
        Vec<      // K
          Vec<Real> // L
        >
      >
    >
```
- 이렇게 보면 절대 헷갈리지 않는다.

### 🧩 4. 실제 접근 예시
```rust
bd[i][j][k][l] = 3.14;
```
- 이때:
    - i ∈ [0, udr]
    - j ∈ [0, vdr]
    - k ∈ [0, p]
    - l ∈ [0, q]

### 🛠 5. 더 깔끔하게 쓰는 방법 (추천)
- Rust에서는 이런 구조를 타입으로 명확히 표현하면 훨씬 덜 헷갈린다.
```rust
type BD = Vec<Vec<Vec<Vec<Real>>>>;
```

- 또는 더 의미 있게:
```rust
type LDim = Vec<Real>;
type KDim = Vec<LDim>;
type JDim = Vec<KDim>;
type IDim = Vec<JDim>;

let mut bd: IDim = vec![vec![vec![vec![0.0; q+1]; p+1]; vdr+1]; udr+1];
```

- 이렇게 하면 머릿속에서 구조가 훨씬 명확해진다.

### ⭐  충첩 배열 가이드 요약
- 안쪽부터 바깥으로 확장된다
- vec![X; N]은 **X를 N번 복제**
- 4차원 벡터는 bd[i][j][k][l]
- 각 차원의 길이는 바깥에서 안쪽 순서대로  
    udr+1, vdr+1, p+1, q+1
- 타입 alias를 쓰면 훨씬 명확해진다

---

