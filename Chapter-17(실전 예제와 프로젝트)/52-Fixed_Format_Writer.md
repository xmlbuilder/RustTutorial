# Fortran Fixed Format

## âœ… ê°œì„  ë°©í–¥: ìœ íš¨ìˆ«ì ê¸°ë°˜ í¬ë§·íŒ… + 8ìë¦¬ ì œí•œ
- ë‹¤ìŒê³¼ ê°™ì€ ì „ëµìœ¼ë¡œ ê°œì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
  - ê°€ëŠ¥í•˜ë©´ ì†Œìˆ˜ì  í‘œê¸° ìœ ì§€
  - ë„ˆë¬´ í¬ê±°ë‚˜ ì‘ìœ¼ë©´ ì§€ìˆ˜ í‘œê¸° (e-notation) ì‚¬ìš©
  - ì „ì²´ ê¸¸ì´ê°€ 8ìë¦¬ë¥¼ ë„˜ìœ¼ë©´ ìœ íš¨ìˆ«ìë¥¼ ì¤„ì—¬ì„œ ë§ì¶¤
  - ìŒìˆ˜ ë¶€í˜¸ í¬í•¨í•˜ì—¬ 8ìë¦¬ë¥¼ ë„˜ì§€ ì•Šë„ë¡ ì¡°ì •

## âœ¨ ê°œì„ ëœ êµ¬í˜„ ì˜ˆì‹œ
```rust
fn format_bdf_field(val: f64) -> String {
    // Handle zero explicitly
    if val == 0.0 {
        return "     0.0".to_string();
    }

    // Try fixed-point first
    let fixed = format!("{:.6}", val);
    if fixed.len() <= 8 {
        return format!("{:>8}", fixed);
    }

    // Try scientific notation with decreasing precision
    for p in (0..=6).rev() {
        let sci = format!("{:.*e}", p, val);
        if sci.len() <= 8 {
            return format!("{:>8}", sci);
        }
    }

    // Fallback: truncate to 8 characters (last resort)
    let fallback = format!("{:.6e}", val);
    format!("{:>8}", &fallback[..8])
}
```

## ğŸ” ì˜ˆì‹œ ì¶œë ¥
| ì…ë ¥ ê°’ (val) | ì¶œë ¥ ë¬¸ìì—´ (format_bdformat_bdf_field(val)) |
|---------------|----------------------------------------------|
| 0.0 | "     0.0" | 
| 123.456789 | "123.457" | 
| -0.0001234 | " -1.2e-4" | 
| 1234567.89 | "1.2e+06" | 
| -987654.321 | "-9.9e+05" | 

## âœ… ì¥ì 
- ì¤‘ìš”í•œ ì •ë³´ ë³´ì¡´: ë¶€í˜¸, ì§€ìˆ˜, ìœ íš¨ìˆ«ì ìœ ì§€
- ì •í™•íˆ 8ìë¦¬: BDF í¬ë§· ìš”êµ¬ì‚¬í•­ ì¶©ì¡±
- ê°€ë…ì„± ìœ ì§€: ê°€ëŠ¥í•œ í•œ ì‚¬ëŒì´ ì½ê¸° ì‰¬ìš´ í˜•ì‹ ìœ ì§€

---

# 16ìë¦¬

ê°€ëŠ¥í•œ ë§ì€ ìœ íš¨ìˆ«ìë¥¼ ë³´ì¡´í•˜ë©´ì„œë„ ì „ì²´ ê¸¸ì´ë¥¼ 16ìë¦¬ì— ë§ì¶”ëŠ” ê²ƒ (ë¶€í˜¸, ì†Œìˆ˜ì , ì§€ìˆ˜ í¬í•¨)

## âœ… ê°œì„ ëœ 16ìë¦¬ìš© í•¨ìˆ˜
```rust
fn format_bdf_field_16(val: f64) -> String {
    if val == 0.0 {
        return "             0.0".to_string(); // 16ìë¦¬ ê³µë°± + 0.0
    }

    // 1. ê³ ì • ì†Œìˆ˜ì  ì‹œë„
    let fixed = format!("{:.10}", val); // ìµœëŒ€í•œ ë§ì€ ì†Œìˆ˜ì 
    if fixed.len() <= 16 {
        return format!("{:>16}", fixed);
    }

    // 2. ì§€ìˆ˜ í‘œê¸° ì‹œë„ (ì •ë°€ë„ ì¤„ì—¬ê°€ë©°)
    for p in (0..=12).rev() {
        let sci = format!("{:.*e}", p, val);
        if sci.len() <= 16 {
            return format!("{:>16}", sci);
        }
    }

    // 3. ë§ˆì§€ë§‰ ìˆ˜ë‹¨: ì˜ë¼ë‚´ê¸° (ì •ë³´ ì†ì‹¤ ê°ìˆ˜)
    let fallback = format!("{:.10e}", val);
    format!("{:>16}", &fallback[..16])
}
```


## ğŸ” ì˜ˆì‹œ ì¶œë ¥
| ì…ë ¥ ê°’(val) | ì¶œë ¥ ë¬¸ìì—´ (format_bdformat_bdf_field_16(val)) |
|--------------|-------------------------------------------------|
| 0.0 | "             0.0" | 
| 123.4567890123 | "     123.456789" | 
| -0.000000123456 | "    -1.2346e-7" | 
| 987654321.123456 | "   9.8765e+08" | 
| -1.23456789012345 | " -1.2345678901" | 

## âœ… ìš”ì•½
- ê³ ì • ì†Œìˆ˜ì : ê°€ëŠ¥í•œ í•œ ë§ì´ ë³´ì—¬ì¤Œ
- ì§€ìˆ˜ í‘œê¸°: ë„ˆë¬´ í¬ê±°ë‚˜ ì‘ì„ ë•Œ ìë™ ì „í™˜
- 16ìë¦¬ ì •ë ¬: BDF í¬ë§· ìš”êµ¬ì‚¬í•­ ì¶©ì¡±
- ì •ë³´ ì†ì‹¤ ìµœì†Œí™”: ì˜ë¼ë‚´ê¸° ëŒ€ì‹  ìœ íš¨ìˆ«ì ì¡°ì ˆ

---

# í…ŒìŠ¤íŠ¸ ì½”ë“œ
```rust
#[cfg(test)]
mod tests{
    use nurbslib::core::file_utils::{on_format_field_field16, on_format_field_field8};

    #[test]
    fn test_format_bdf_field_variants() {
        let cases = vec![
            (0.0, "     0.0"),
            (1.234567, " 1.23457"),
            (-1.234567, "-1.23457"),
            (12345678.9, "1.2e+07"),
            (-9876543.21, "-9.9e+06"),
            (0.000000123456, " 1.2e-07"),
            (-0.00000098765, "-9.9e-07"),
            (999.999999, "1000.000"),
            (-999.999999, "-999.999"),
        ];

        for (val, expected) in cases {
            let result = on_format_field_field8(val);
            assert_eq!(result, expected, "Failed on val = {}", val);
        }
    }
```

### ì¶œë ¥
```
result, result_val=           , 0.0000000000
result, result_val=     1.2345, 1.2345670000
result, result_val=    -1.2345, -1.2345670000
result, result_val= 1.23456789, 12345678.9000000004
result, result_val= -9.8765432, -9876543.2100000009
result, result_val=     0.0000, 0.0000001235
result, result_val=    -0.0000, -0.0000009876
result, result_val=   999.9999, 999.9999990000
result, result_val=  -999.9999, -999.9999990000
```

```rust
    #[test]
    fn test_format_field_16_variants() {
        let cases = vec![
            (0.0, "             0.0"),
            (1.234567890123, "     1.23456789"),
            (-1.234567890123, "    -1.23456789"),
            (123456789.123456, "   1.2345679e+08"),
            (-987654321.987654, "  -9.8765432e+08"),
            (0.000000000123456, "    1.23456e-10"),
            (-0.00000000098765, "   -9.8765e-10"),
            (999999999999.0, "   1.0e+12"),
            (-999999999999.0, "  -1.0e+12"),
        ];
        for (val, expected) in cases {
            let result = on_format_field_field16(val);
            let result_val: f64 = result.trim().parse().unwrap();
            println!("result, result_val= {:.20}, {:.20}", result, result_val);
        }
    }
}
```

### ì¶œë ¥
```
result, result_val=              0.0, 0.00000000000000000000
result, result_val=     1.2345678901, 1.23456789009999989837
result, result_val=    -1.2345678901, -1.23456789009999989837
result, result_val= 1.234567891235e8, 123456789.12350000441074371338
result, result_val= -9.87654321988e8, -987654321.98800003528594970703
result, result_val=     0.0000000001, 0.00000000010000000000
result, result_val=    -0.0000000010, -0.00000000100000000000
result, result_val= 9.99999999999e11, 999999999999.00000000000000000000
result, result_val= -1.0000000000e12, -1000000000000.00000000000000000000
```
---



