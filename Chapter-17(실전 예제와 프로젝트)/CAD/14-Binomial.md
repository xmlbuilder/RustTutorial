# Binomial

## 🧮 핵심 기능 요약
### 1️⃣ on_binomial(n, k) -> usize
- 기능: 일반적인 이항 계수 계산
- 공식:

$$
{n \choose k}=\frac{n!}{k!(n-k)!}
$$

- 제약: usize 범위 내에서만 정확히 계산됨 (큰 수는 오버플로우 위험)

### 2️⃣ on_binomial_u128(n, k) -> Option<u128>
- 기능: 큰 수를 다루기 위해 u128 사용 + 약분 최적화
- 핵심 로직:
- 분자:     $n\times (n-1)\times \dots \times (n-k+1)$
- 분모:     $k!$
- 약분: 분모의 각 항을 분자의 항들과 최대공약수(GCD)로 나눔
- 오버플로우 방지: checked_mul, checked_div 사용
- 장점: 매우 큰 n,k 값에서도 안전하게 계산 가능

### 3️⃣ Binomial 구조체 (메모이제이션 기반)
- 기능: f64 기반 이항 계수 계산 (재귀 + 캐싱)
- 공식: 파스칼의 항등식 사용

$$
{n \choose k}={n-1 \choose k}+{n-1 \choose k-1}
$$

- 장점: 반복 계산 방지, 실수형 결과로 근사값 제공

## 📐 수학적 개념 요약

| 표현                      | 설명 또는 성질                                                  |
|---------------------------|------------------------------------------------------------------|
| $\binom{n}{k}$          | $n$개 중 $k$개를 선택하는 조합의 수 (이항 계수)              |
| $\binom{n}{k} = \frac{n!}{k!(n-k)!}$ | 기본 정의: 팩토리얼 기반 조합 공식                      |
| $\binom{n}{k} = \binom{n-1}{k} + \binom{n-1}{k-1}$ | 파스칼의 항등식: 재귀적 관계식                         |
| $\binom{n}{k} = \binom{n}{n-k}$      | 대칭성: 선택 순서가 중요하지 않음                        |
| $\binom{n}{0} = \binom{n}{n} = 1$    | 경계 조건: 아무것도 선택하지 않거나 모두 선택하는 경우   |

- CAD(Computer-Aided Design)에서 수학이 사용되는 이유는 정확한 모델링, 시뮬레이션, 최적화, 그리고 자동화를 가능하게 하기 때문입니다.  
- 특히 기하학과 대수학은 CAD의 핵심 기반입니다.

## 📐 CAD에서 사용되는 주요 수학 분야

| 수학 분야           | CAD에서의 활용 설명                                                                 |
|----------------------|--------------------------------------------------------------------------------------|
| 기하학 (Geometry)     | 점, 선, 면, 곡선, 솔리드 등 2D/3D 형상 정의 및 모델링의 기본                       |
| 대수학 (Algebra)      | 객체의 위치, 크기, 방향 등을 수식으로 표현하고 계산                                |
| 삼각법 (Trigonometry) | 각도, 회전, 원호, 곡선 길이 계산 등 정밀한 기하 연산에 필수                         |
| 선형대수학 (Linear Algebra) | 행렬을 통한 변환(이동, 회전, 스케일링), 좌표계 변환, 벡터 연산에 사용됨         |
| 미적분학 (Calculus)   | 곡면의 기울기, 곡률, 형상 변화율 분석 및 최적화                                     |
| 통계학 (Statistics)   | 시뮬레이션 결과 분석, 품질 관리, 공차 분석 등에서 사용                              |
| 미분방정식 (Differential Equations) | 유체 흐름, 열전달, 응력 해석 등 물리적 시뮬레이션에 사용됨         |
| 수치해석 (Numerical Analysis) | 복잡한 방정식의 근사 해법. FEA, CFD 등 해석 알고리즘의 기반                   |

## 🧠 CAD에서 수학이 필요한 이유
- 정확성: 수학적 정의를 통해 오차 없는 설계가 가능
- 효율성: 반복 작업 자동화, 수식 기반 설계 변경
- 시각화: 수학 모델을 기반으로 3D 시뮬레이션 및 렌더링
- 최적화: 설계 조건에 따른 최적 구조 계산
- 상호운용성: 수학 기반 포맷 덕분에 다양한 시스템과 연동 가능

## 🧭 예시: CAD에서 수학이 적용되는 실제 기능
- Bezier 곡선 / NURBS: 곡선과 곡면을 수학적으로 정의하여 부드러운 형상 생성
- BIM 모델링: 건축 요소의 위치, 크기, 관계를 수학적으로 표현
- Finite Element Analysis (FEA): 구조 해석 시 미분방정식 기반의 수치 해석 사용
- CAM 경로 계산: 공작 기계의 이동 경로를 수학적으로 최적화



## 📐 이항 계수의 주요 수학적 특성
### 1️⃣ 기본 정의

$$
{n \choose k}=\frac{n!}{k!(n-k)!}
$$

- n개 중 k개를 선택하는 경우의 수
- 팩토리얼 기반 정의

2️⃣ 파스칼의 항등식

$$
{n \choose k}={n-1 \choose k}+{n-1 \choose k-1}
$$

- 파스칼 삼각형의 생성 원리
- 재귀적 계산에 활용

3️⃣ 대칭성

$$
{n \choose k}={n \choose n-k}
$$

- 선택 순서가 중요하지 않음을 반영

4️⃣ 경계 조건

$$
{n \choose 0}={n \choose n}=1
$$

- 아무것도 선택하지 않거나 모두 선택하는 경우

5️⃣ 전체 합

$$
\sum _{k=0}^n{n \choose k}=2^n
$$

- 모든 조합의 개수는 집합의 부분집합 수와 같음

6️⃣ 교대 합

$$
\sum _{k=0}^n(-1)^k{n \choose k}=0
$$

- 짝수/홀수 항의 교대 합은 0

7️⃣ 제곱합

$$
\sum _{k=0}^n{n \choose k}^2={2n \choose n}
$$

- 이항 계수의 제곱합은 중앙값을 기준으로 대칭

8️⃣ 일반 항 (Binomial Expansion)

$$
(x+y)^n=\sum _{k=0}^n{n \choose k}x^{n-k}y^k
$$

- 이항 정리의 핵심
- 다항식 전개 시 계수로 등장

🧠 활용 분야
- 조합론: 경우의 수 계산
- 확률론: 이항 분포, 베르누이 시행
- 대수학: 다항식 전개, 항등식 증명
- 수치해석: 근사 계산, 테일러 전개
- 컴퓨터 과학: 알고리즘 설계, 동적 계획법

---

# Binomial

**Binomial(이항 계수)** 는 Bezier 곡선의 수학적 정의에서 핵심적인 역할을 합니다.  
Bezier 곡선은 단순한 기하학이 아니라, 이항 계수와 다항식의 조합으로 만들어지는 Bernstein 다항식 기반의 곡선.

## 🎯 왜 Binomial이 Bezier에 사용되는가?
Bezier 곡선은 다음과 같은 수식으로 정의됩니다:

$$
B(t)=\sum _{i=0}^n{n \choose i}(1-t)^{n-i}t^iP_i
$$

- $P_i$: 제어점
- $t$: 매개변수 $(0\leq t\leq 1)$
- ${n \choose i}$: 이항 계수, 각 항의 가중치를 결정

## 🔍 이항 계수의 역할
- 곡선의 형태를 결정하는 가중치로 작용
- 각 제어점 P_i에 대해 얼마나 영향을 줄지 계산
- 곡선의 모든 점은 제어점들의 선형 조합으로 표현되며, 이 조합의 가중치가 바로 이항 계수

## 📐 수학적 구조: Bernstein 다항식
Bezier 곡선은 Bernstein basis polynomial의 선형 조합으로 구성됩니다:

$$
B_i^n(t)={n \choose i}(1-t)^{n-i}t^i
$$

- 이 함수는 t에 따라 제어점의 영향을 부드럽게 변화시킴
- 전체 곡선은 $B(t)=\sum B_i^n(t)P_i$ 로 표현됨

## 🧠 요약하면…

| 요소               | 설명                                                                 |
|--------------------|----------------------------------------------------------------------|
| 이항 계수           | 각 제어점에 부여되는 가중치 역할. 곡선의 형태를 결정하는 핵심 수학적 요소 |
| Bernstein 다항식    | Bezier 곡선을 구성하는 기본 함수. 이항 계수 × 다항식으로 정의됨         |
| 곡선 정의 방식       | $\sum_{i=0}^{n} \binom{n}{i} (1 - t)^{n - i} t^i P_i$ 형태로 표현됨     |
| 제어점 영향력 조절  | 이항 계수와 $t$의 조합으로 각 제어점의 영향력이 부드럽게 변화됨         |
| 수학적 안정성과 대칭성 | 곡선의 연속성, 대칭성, 형태 안정성을 수학적으로 보장함                   |

## 📊 시각적 예시
Bezier 곡선의 각 제어점은 이항 계수에 의해 가중치가 부여되며, t의 변화에 따라 곡선이 부드럽게 형성됩니다.  
이항 계수는 곡선의 형상 안정성, 대칭성, 연속성을 수학적으로 보장하는 핵심 요소입니다.

# Bezier -> Polynomial

Bezier 곡선을 다항식(Polynomial) 형태로 바꾸는 것은 수학적으로 가능합니다.  
실제로 Bezier 곡선은 Bernstein 다항식의 선형 조합으로 구성되어 있기 때문에, 이를 표준 다항식 형태로 변환할 수 있습니다.

## 🔄 Bezier → Polynomial 변환 알고리즘
## 🎯 기본 Bezier 정의 (n차)

$$
B(t)=\sum _{i=0}^n{n \choose i}(1-t)^{n-i}t^iP_i
$$

- 이 식은 Bernstein basis로 표현된 곡선
- 목표는 이를 단순한 다항식 형태로 바꾸는 것:

$$
B(t)=a_0+a_1t+a_2t^2+\dots +a_nt^n
$$

## 🧠 변환 방법
- 각 항 전개:
- $(1-t)^{n-i}t^i$ 를 다항식으로 전개
- 예: $(1-t)^2t=t-2t^2+t^3$
- 이항 계수 적용:
- 각 항에 ${n \choose i}$ 를 곱함
- 제어점 $P_i$ 적용:
- 각 항에 $P_i$ 를 곱함 (벡터일 경우 x, y 각각 적용)
- 모든 항을 정리:
- 같은 차수의 항끼리 합산하여 최종 다항식 계수 a_i 도출

## ✅ 변환이 쉬운가?

| 조건                   | 난이도 및 설명                                                             |
|------------------------|---------------------------------------------------------------------------|
| 저차 Bezier (2차, 3차) | 매우 쉬움. 수작업 또는 간단한 코드로 다항식 전개 가능                     |
| 고차 Bezier (5차 이상) | 복잡해짐. 항 수가 많아지고 계산량 증가. 자동화 알고리즘 또는 CAS 필요     |
| 벡터 제어점 포함       | x, y, z 각각 따로 다항식으로 변환해야 하므로 계산이 늘어남                 |
| 실시간 변환 필요       | CAD/그래픽 시스템에서는 최적화된 알고리즘으로 빠르게 처리 가능             |
| 수치 안정성 고려       | 고차일수록 부동소수점 오차가 누적될 수 있어 정밀한 수치 해석이 필요         |


## 📌 예시: 2차 Bezier
### 제어점: $P_0$, $P_1$, $P_2$

$$
B(t)=(1-t)^2P_0+2(1-t)tP_1+t^2P_2
$$

### 전개하면:

$$
B(t)=P_0-2P_0t+P_0t^2+2P_1t-2P_1t^2+P_2t^2
$$

### 정리하면:

$$
B(t)=(P_0)+(-2P_0+2P_1)t+(P_0-2P_1+P_2)t^2
$$

### 즉, 다항식 계수:
- $a_0=P_0$
- $a_1=-2P_0+2P_1$
- $a_2=P_0-2P_1+P_2$

## ✅ Polynomial 대신 Binomial을 쓰는 대표적인 이유
| 이유                         | 설명                                                                 |
|------------------------------|----------------------------------------------------------------------|
| 수학적 안정성              | Bernstein 다항식은 이항 계수를 기반으로 하여 수치적으로 더 안정적임     |
| 제어점 기반 표현           | Binomial 표현은 제어점과 직접 연결되어 있어 곡선 제어가 직관적임        |
| 대칭성과 연속성 유지       | 이항 계수는 곡선의 대칭성과 매끄러운 연결을 자연스럽게 보장함           |
| 계산 최적화                | Polynomial은 고차일수록 계산량이 많아지지만 Binomial은 재귀적 계산이 가능 |
| 의미적 명확성              | Binomial은 “조합”이라는 의미를 내포해 있어 곡선의 구조적 해석이 쉬움     |
| 파스칼 삼각형과 연결       | Binomial 기반은 파스칼 삼각형과 연결되어 있어 재귀적 구성에 유리함       |
| 실시간 제어에 적합         | CAD/그래픽 시스템에서 실시간 제어 시 Binomial 표현이 더 직관적이고 빠름   |


## 📌 예시: Bezier 곡선에서의 선택
- Polynomial 표현:

$$
B(t)=a_0+a_1t+a_2t^2+\dots +a_nt^n
$$

- 계산은 빠르지만 제어점과의 연결이 약함
- Binomial 표현 (Bernstein basis):

$$
B(t)=\sum _{i=0}^n{n \choose i}(1-t)^{n-i}t^iP_i
$$

- 제어점 기반, 대칭성 보장, 실시간 제어에 유리

- Binomial 표현은 수학적으로 안정적이고, 제어점 기반의 직관적인 곡선 제어가 가능하기 때문에  
    CAD, 그래픽, 애니메이션 등에서 Polynomial보다 선호되는 경우가 많습니다.

---

# on_binomial_table


## 🧮 수학적 배경: 이항 계수
이항 계수는 다음과 같이 정의됩니다:  

$$
{n \choose k}=\frac{n!}{k!(n-k)!}
$$  

하지만 실무에서는 재귀적 관계를 이용해 계산하는 것이 효율적입니다:  

$$
{n \choose 0}={n \choose n}=1\\ \quad\quad {n \choose k}={n-1 \choose k-1}+{n-1 \choose k}\quad \mathrm{for\  }1\leq k\leq n-1
$$


### ✅ 1. on_binomial_table(n_max) 함수 검증
이 함수는 $0\leq n\leq n_{\mathrm{max}}$ 범위의 모든 이항 계수를 계산합니다.
#### 🔍 단계별 수식 대응
```rust
c[n][0] = 1.0;
c[n][n] = 1.0;
```
- 수식: ${n \choose 0}={n \choose n}=1$

```rust
c[n][k] = c[n - 1][k - 1] + c[n - 1][k];
```

- 수식: ${n \choose k}={n-1 \choose k-1}+{n-1 \choose k}$

#### ✅ 검증 결과: 파스칼의 삼각형 정의를 정확히 따름

### ✅ 2. on_update_binomial_coefficients(coeffs, max_degree) 함수 검증
이 함수는 기존 이항 계수 테이블을 확장하거나 보완합니다.

#### 🔍 핵심 로직
```rust
if coeffs[n].len() == n + 1 {
    start_n = n + 1;
}
```

- 유효한 행인지 확인: $\mathrm{len}=n+1$ 이면 ${n \choose k}$ 가 모두 계산된 상태
```rust
row[k] = prev[k - 1] + prev[k];
```

- 수식: ${n \choose k}={n-1 \choose k-1}+{n-1 \choose k}$

#### ✅ 검증 결과: 기존 테이블을 기반으로 정확히 확장하며, 수학적으로 일관됨

## 📌 요약

| 함수 이름                         | 수학적 의미                          | 주요 동작 요약                                 |
|----------------------------------|--------------------------------------|------------------------------------------------|
| on_binomial_table(n_max)         | 파스칼 삼각형 생성                   | $\binom{n}{k} = \binom{n-1}{k-1} + \binom{n-1}{k}$ 재귀 계산 |
| on_update_binomial_coefficients  | 기존 테이블 확장 및 보완            | 누락된 행만 계산하여 기존 테이블을 효율적으로 갱신 |

---





