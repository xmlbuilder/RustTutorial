# LU Decompsitiohn and Solving Linear Systems

## ì†ŒìŠ¤ ì½”ë“œ
```rust
use crate::core::prelude::Real;

pub struct LU {
    pub a: Vec<Vec<Real>>, // in-place LU (upper on diag/upper, lower in strict lower)
}
```
```rust
pub fn on_m_ludcmp_full(mut a: Vec<Vec<Real>>, ludt: Real) -> Option<LU> {
    let n = a.len();
    if n == 0 || a.iter().any(|r| r.len() != n) {
        return None;
    }

    for i in 0..n {
        // U (í–‰ i, ì—´ j>=i)
        for j in i..n {
            let mut sum = 0.0;
            for k in 0..i {
                sum += a[i][k] * a[k][j];
            }
            a[i][j] -= sum;
        }

        // L (í–‰ j>i, ì—´ i)
        for j in (i + 1)..n {
            let mut sum = 0.0;
            for k in 0..i {
                sum += a[j][k] * a[k][i];
            }
            if a[i][i].abs() < ludt {
                return None;
            } // ì›ë³¸ì˜ NUM_ERR ì—­í• 
            a[j][i] = (a[j][i] - sum) / a[i][i];
        }
    }
    Some(LU { a })
}
```
```rust
pub fn on_lu_solve(lu: &LU, b: &mut [Real]) -> bool {
    let n = lu.a.len();
    if b.len() != n {
        return false;
    }

    // Ly = b
    for i in 0..n {
        let mut s = b[i];
        for k in 0..i {
            s -= lu.a[i][k] * b[k];
        }
        b[i] = s; // Lì˜ ëŒ€ê°ì€ 1
    }
    // Ux = y
    for i in (0..n).rev() {
        let mut s = b[i];
        for k in (i + 1)..n {
            s -= lu.a[i][k] * b[k];
        }
        let uii = lu.a[i][i];
        if uii.abs() < 1e-30 {
            return false;
        }
        b[i] = s / uii;
    }
    true
}
```

## ğŸ“Œ ì½”ë“œ êµ¬ì¡° ì •ë¦¬

### 1. LU êµ¬ì¡°ì²´
```rust
pub struct LU {
    pub a: Vec<Vec<Real>>, // in-place LU (UëŠ” ëŒ€ê°/ìƒì‚¼ê°, Lì€ í•˜ì‚¼ê°)
}
```

- í•˜ë‚˜ì˜ í–‰ë ¬ a ì•ˆì— LU ë¶„í•´ ê²°ê³¼ë¥¼ ì €ì¥í•©ë‹ˆë‹¤.
- ëŒ€ê° ë° ìƒì‚¼ê° ë¶€ë¶„ì€ U í–‰ë ¬, ì—„ê²©í•œ í•˜ì‚¼ê° ë¶€ë¶„ì€ L í–‰ë ¬ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.
- Lì˜ ëŒ€ê°ì€ í•­ìƒ 1ë¡œ ê°€ì •í•©ë‹ˆë‹¤.

### 2. on_m_ludcmp_full
```rust
pub fn on_m_ludcmp_full(mut a: Vec<Vec<Real>>, ludt: Real) -> Option<LU>
```

- ì…ë ¥ í–‰ë ¬ aë¥¼ LU ë¶„í•´í•©ë‹ˆë‹¤.
- ludtëŠ” pivotì´ ë„ˆë¬´ ì‘ì„ ë•Œ(â‰ˆ0) ì‹¤íŒ¨í•˜ë„ë¡ í•˜ëŠ” ì„ê³„ê°’ì…ë‹ˆë‹¤.
- ì•Œê³ ë¦¬ì¦˜:
- U ê³„ì‚°

$$
U_{ij}=A_{ij}-\sum _{k=0}^{i-1}L_{ik}U_{kj},\quad j\geq i
$$


- L ê³„ì‚°

$$
L_{ji}=\frac{A_{ji}-\sum _{k=0}^{i-1}L_{jk}U_{ki}}{U_{ii}},\quad j>i
$$


- ë§Œì•½ $U_{ii}$ ê°€ ë„ˆë¬´ ì‘ìœ¼ë©´ $(abs < ludt)$ â†’ ë¶„í•´ ì‹¤íŒ¨.

### 3. on_lu_solve
```rust
pub fn on_lu_solve(lu: &LU, b: &mut [Real]) -> bool
```

- ë¶„í•´ëœ LUë¥¼ ì´ìš©í•´ Ax = bë¥¼ í’‰ë‹ˆë‹¤.
- ê³¼ì •:
- $Ly = b$ (ì „ì§„ ëŒ€ì…, forward substitution)

$$
y_i=b_i-\sum _{k=0}^{i-1}L_{ik}y_k
$$

- (ì—¬ê¸°ì„œ Lì˜ ëŒ€ê°ì€ 1)


- $Ux = y$ (í›„ì§„ ëŒ€ì…, backward substitution)

$$
x_i=\frac{y_i-\sum _{k=i+1}^{n-1}U_{ik}x_k}{U_{ii}}
$$

- ë§Œì•½ $U_{ii}$ ê°€ ë„ˆë¬´ ì‘ìœ¼ë©´ $(abs < 1e-30)$ â†’ ì‹¤íŒ¨.

### ğŸ“ ìˆ˜ì‹ ìš”ì•½
- LU ë¶„í•´:

$$
A=L\cdot U
$$

- ì—¬ê¸°ì„œ
- $L$: ë‹¨ìœ„ í•˜ì‚¼ê° í–‰ë ¬ (ëŒ€ê° = 1)
- $U$: ìƒì‚¼ê° í–‰ë ¬
- í•´ë²•:
ì„ í˜• ë°©ì •ì‹ Ax=bë¥¼ í’€ ë•Œ

$$
LUx=b
$$

- ë¨¼ì €

$$
Ly=b
$$

    - â†’ ì „ì§„ ëŒ€ì…ìœ¼ë¡œ y êµ¬í•¨.

- ê·¸ ë‹¤ìŒ

$$
Ux=y
$$

    - â†’ í›„ì§„ ëŒ€ì…ìœ¼ë¡œ x êµ¬í•¨.

## âœ¨ ì •ë¦¬ëœ íë¦„- `on_m_ludcmp_full` â†’ í–‰ë ¬ `A` ë¥¼ `LU` ë¡œ ë¶„í•´
- `on_lu_solve` â†’ LUë¥¼ ì´ìš©í•´ $Ax=b$ ë¥¼ í‘¼ë‹¤
- Forward substitution $(Ly=b)$
- Backward substitution $(Ux=y)$


---

# Lu ë¶„í•´ë¡œ 3x3 ì„ í˜•ê³„ í•´ êµ¬í•˜ê¸°
ì‘ì€ 3x3 ì˜ˆì œë¥¼ í†µí•´ LU ë¶„í•´ì™€ ì „ì§„Â·í›„ì§„ ëŒ€ì…ìœ¼ë¡œ í•´ë¥¼ êµ¬í•˜ëŠ” ê³¼ì •.  
ëª©í‘œëŠ” Ax=bë¥¼ í‘¸ëŠ” ê²ƒì…ë‹ˆë‹¤.  
ì½”ë“œì™€ ë™ì¼í•œ ë°©ì‹ìœ¼ë¡œ, ëŒ€ê°ì€ Uì— í¬í•¨ë˜ê³  Lì€ í•˜ì‚¼ê°ì˜ ì—„ê²©í•œ ë¶€ë¶„ë§Œ ì €ì¥í•˜ë©° ëŒ€ê°ì€ ëª¨ë‘ 1ì…ë‹ˆë‹¤.

## ì˜ˆì œ í–‰ë ¬ê³¼ ë²¡í„°
- í–‰ë ¬ A:

$$
A=\left[ \begin{matrix}2&3&1\\ \quad 4&1&-3\\ \quad -2&5&2\end{matrix}\right]
$$ 

- ë²¡í„° b:

$$
b=\left[ \begin{matrix}9\\ \quad 1\\ \quad 13\end{matrix}\right]
$$ 

### Lu ë¶„í•´ ìˆ˜í–‰
ì½”ë“œê°€ í•˜ëŠ” ê·¸ëŒ€ë¡œ, ê° ë‹¨ê³„ iì—ì„œ ë¨¼ì € Uì˜ ië²ˆì§¸ í–‰ì„ ê³„ì‚°í•˜ê³ , ê·¸ ë‹¤ìŒ Lì˜ ië²ˆì§¸ ì—´(í•˜ì‚¼ê°)ì„ ê³„ì‚°í•©ë‹ˆë‹¤.  
ëŒ€ê°ì€ í”¼ë²— $a_{ii}$ ì´ë©°, í”¼ë²—ì´ ë„ˆë¬´ ì‘ìœ¼ë©´ ì‹¤íŒ¨í•©ë‹ˆë‹¤.
#### ë‹¨ê³„ i = 0
- Uì˜ 0í–‰ ê³„ì‚°:

$$
U_{0,0}=a_{00}=2,\quad U_{0,1}=a_{01}=3,\quad U_{0,2}=a_{02}=1
$$

- Lì˜ 0ì—´ ê³„ì‚°:

$$
L_{1,0}=\frac{a_{10}}{a_{00}}=\frac{4}{2}=2,\quad L_{2,0}=\frac{a_{20}}{a_{00}}=\frac{-2}{2}=-1
$$

- ì¤‘ê°„ ìƒíƒœ:

$$
L=\left[ \begin{matrix}1&0&0\\ 2&1&0\\ -1&0&1\end{matrix}\right] ,\quad U=\left[ \begin{matrix}2&3&1\\ 0&?&?\\ 0&?&?\end{matrix}\right]
$$


#### ë‹¨ê³„ i = 1 (ASCIIë¡œ ì „ê°œ)
- Uì˜ 1í–‰ ê³„ì‚°:
```
U[1,1] = a[1,1] - (a[1,0]*a[0,1]) / a[0,0]
        = 1 - (4*3)/2
        = 1 - 6
        = -5
```
```
U[1,2] = a[1,2] - (a[1,0]*a[0,2]) / a[0,0]
        = -3 - (4*1)/2
        = -3 - 2
        = -5
```
- Lì˜ 1ì—´ ê³„ì‚°:
```
L[2,1] = ( a[2,1] - (a[2,0]*a[0,1]) / a[0,0] ) / U[1,1]
       = ( 5 - ((-2)*3)/2 ) / (-5)
       = ( 5 - (-6/2) ) / (-5)
       = ( 5 + 3 ) / (-5)
       = 8 / (-5)
       = -8/5
```
- ì¤‘ê°„ ìƒíƒœ (i=1 ì¢…ë£Œ ì‹œì ):
```
L =
[  1    0     0  ]
[  2    1     0  ]
[ -1  -8/5    1  ]
```
```
U =
[  2    3     1  ]
[  0   -5    -5  ]
[  0    0     ?  ]   <-- U[2,2]ëŠ” i=2ì—ì„œ ê³„ì‚°
```


ë‹¨ê³„ i = 2
- Uì˜ 2í–‰ ê³„ì‚°:
```
U[2,2] = a[2,2] - ( a[2,0]*U[0,2]/U[0,0] + a[2,1]*U[1,2]/U[1,1] )
       = 2 - ( (-2)*(1)/2 + 5*(-5)/(-5) )
       = 2 - ( -1 + 5 )
       = 2 - 4
       = -2
```
- ìƒì‚¼ê° íŠ¹ì„± ì„¤ëª…:
UëŠ” ìƒì‚¼ê° í–‰ë ¬ì´ë¯€ë¡œ j < 2ì— ëŒ€í•´ì„œ U[2,j]ëŠ” ê³„ì‚°í•˜ì§€ ì•ŠìŒ (ì´ë¯¸ 0).
- ìµœì¢… LU (ë¶„í•´ ì™„ë£Œ í›„):
```
L =
[  1    0     0  ]
[  2    1     0  ]
[ -1  -8/5    1  ]
```
```
U =
[  2    3     1  ]
[  0   -5    -5  ]
[  0    0    -2  ]
```

- ì €ì¥ ë°©ì‹ ì„¤ëª…:
ì½”ë“œì—ì„œëŠ” í•˜ë‚˜ì˜ í–‰ë ¬ aì— ë‹¤ìŒê³¼ ê°™ì´ ì €ì¥:
- ìƒì‚¼ê°(ëŒ€ê° í¬í•¨)ì€ Uì˜ ê°’
- í•˜ì‚¼ê°ì˜ ì—„ê²©í•œ ë¶€ë¶„(ëŒ€ê° ì œì™¸)ì€ Lì˜ ê°’
- ì¦‰, a[i][j]ëŠ” i <= jì´ë©´ U, i > jì´ë©´ Lì„ ì˜ë¯¸.


### ì „ì§„ ëŒ€ì… (Ly = b)
í–‰ë ¬ Lê³¼ ë²¡í„° bëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:
```
L = [[  1    0    0 ],
     [  2    1    0 ],
     [ -1  -8/5   1 ]]
```
```
b = [ 9, 1, 13 ]
```

#### Step i = 0
```
y0 = b0 = 9
```

### Step i = 1
```
y1 = b1 - L[1,0]*y0
    = 1 - 2*9
    = 1 - 18
    = -17

```
### Step i = 2
```
y2 = b2 - (L[2,0]*y0 + L[2,1]*y1)
    = 13 - ( (-1)*9 + (-8/5)*(-17) )
    = 13 - ( -9 + 136/5 )
    = 13 - ( (-45/5) + (136/5) )
    = 13 - (91/5)
    = (65/5) - (91/5)
    = -26/5
```

- ë”°ë¼ì„œ
```
y = [ 9, -17, -26/5 ]
```

- ì´ì œ ì´ yë¥¼ ê°€ì§€ê³  í›„ì§„ ëŒ€ì…(Ux = y)ì„ í•˜ë©´ ìµœì¢… í•´ xë¥¼ êµ¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤

### í›„ì§„ ëŒ€ì… (Ux = y)
- í–‰ë ¬ Uì™€ ë²¡í„° yëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:
```
U = [[ 2   3   1 ],
     [ 0  -5  -5 ],
     [ 0   0  -2 ]]
```
```
y = [  9,  -17,  -26/5 ]
```


#### Step i = 2
```
-2 * x2 = -26/5
x2 = (-26/5) / (-2)
x2 = 13/5

```
#### Step i = 1
```
-5 * x1 - 5 * x2 = -17
-5 * x1 = -17 + 5 * (13/5)
-5 * x1 = -17 + 13 = -4
x1 = (-4)/(-5) = 4/5
```

#### Step i = 0
```
2 * x0 + 3 * x1 + 1 * x2 = 9
2 * x0 = 9 - 3*(4/5) - (13/5)
2 * x0 = 9 - 12/5 - 13/5
2 * x0 = 9 - 25/5
2 * x0 = 9 - 5 = 4
x0 = 4/2 = 2
```


### ìµœì¢… í•´
```
x = [ 2, 4/5, 13/5 ]
```

---

## 1. LU ë¶„í•´ (on_m_ludcmp_full)
###  ì†ŒìŠ¤:

```rust
pub fn on_m_ludcmp_full(mut a: Vec<Vec<Real>>, ludt: Real) -> Option<LU> {
    let n = a.len();
    ...
    for i in 0..n {
        // U (í–‰ i, ì—´ j>=i)
        for j in i..n {
            let mut sum = 0.0;
            for k in 0..i {
                sum += a[i][k] * a[k][j];
            }
            a[i][j] -= sum;
        }
        // L (í–‰ j>i, ì—´ i)
        for j in (i + 1)..n {
            let mut sum = 0.0;
            for k in 0..i {
                sum += a[j][k] * a[k][i];
            }
            if a[i][i].abs() < ludt {
                return None;
            }
            a[j][i] = (a[j][i] - sum) / a[i][i];
        }
    }
    Some(LU { a })
}
```

### ë§¤ì¹­ ì„¤ëª…:
- `for j in i..n { ... }` â†’ ì œê°€ ì„¤ëª…í•œ U í–‰ ê³„ì‚° ë‹¨ê³„ (ì˜ˆ: i=0ì—ì„œ U[0,], i=1ì—ì„œ U[1,] ë“±).
- `for j in (i+1)..n { ... }` â†’ ì œê°€ ì„¤ëª…í•œ L ì—´ ê³„ì‚° ë‹¨ê³„ (ì˜ˆ: i=0ì—ì„œ L[1,0], L[2,0], i=1ì—ì„œ L[2,1]).
- `if a[i][i].abs() < ludt { return None; }` â†’ í”¼ë²— ê²€ì‚¬ (ëŒ€ê° ì›ì†Œê°€ ë„ˆë¬´ ì‘ìœ¼ë©´ ë¶„í•´ ì‹¤íŒ¨).



## 2. ì „ì§„ ëŒ€ì… (Ly = b)
### ì†ŒìŠ¤:
```rust
pub fn on_lu_solve(lu: &LU, b: &mut [Real]) -> bool {
    let n = lu.a.len();
    ...
    // Ly = b
    for i in 0..n {
        let mut s = b[i];
        for k in 0..i {
            s -= lu.a[i][k] * b[k];
        }
        b[i] = s; // Lì˜ ëŒ€ê°ì€ 1
    }
```

### ë§¤ì¹­ ì„¤ëª…:
- for i in 0..n { ... } â†’ ì œê°€ ì„¤ëª…í•œ ì „ì§„ ëŒ€ì… ë‹¨ê³„ (i=0 â†’ y0, i=1 â†’ y1, i=2 â†’ y2).
- s -= lu.a[i][k] * b[k]; â†’ Lì˜ í•˜ì‚¼ê° í•­ì„ ë¹¼ì£¼ëŠ” ë¶€ë¶„.
- b[i] = s; â†’ ê³„ì‚°ëœ y ê°’ì„ bì— ë®ì–´ì”€.



## 3. í›„ì§„ ëŒ€ì… (Ux = y)
### ì†ŒìŠ¤:
```rust
    // Ux = y
    for i in (0..n).rev() {
        let mut s = b[i];
        for k in (i + 1)..n {
            s -= lu.a[i][k] * b[k];
        }
        let uii = lu.a[i][i];
        if uii.abs() < 1e-30 {
            return false;
        }
        b[i] = s / uii;
    }
    true
}
```

### ë§¤ì¹­ ì„¤ëª…:
- `for i in (0..n).rev()` â†’ ì œê°€ ì„¤ëª…í•œ í›„ì§„ ëŒ€ì… ë‹¨ê³„ (i=2 â†’ x2, i=1 â†’ x1, i=0 â†’ x0).
- `s -= lu.a[i][k] * b[k];` â†’ Uì˜ ìƒì‚¼ê° í•­ì„ ë¹¼ì£¼ëŠ” ë¶€ë¶„.
- `b[i] = s / uii;` â†’ í”¼ë²—ìœ¼ë¡œ ë‚˜ëˆ„ì–´ x ê°’ ê³„ì‚°.
- `if uii.abs() < 1e-30 { return false; }` â†’ U ëŒ€ê°ì´ ë„ˆë¬´ ì‘ìœ¼ë©´ ì‹¤íŒ¨.

## ìš”ì•½
- LU ë¶„í•´ ë‹¨ê³„ â†’ on_m_ludcmp_full í•¨ìˆ˜ì˜ `for i in 0..n` ë£¨í”„ ì•ˆì—ì„œ `U` ê³„ì‚° `(for j in i..n)` ê³¼ `L`ê³„ì‚° `(for j in (i+1)..n)` ë¶€ë¶„.
- ì „ì§„ ëŒ€ì… â†’ on_lu_solve í•¨ìˆ˜ì˜ ì²« ë²ˆì§¸ `for i in 0..n` ë£¨í”„.
- í›„ì§„ ëŒ€ì… â†’ on_lu_solve í•¨ìˆ˜ì˜ ë‘ ë²ˆì§¸ `for i in (0..n).rev()` ë£¨í”„.


---

