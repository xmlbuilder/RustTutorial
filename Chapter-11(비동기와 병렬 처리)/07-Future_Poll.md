# Future / Poll 
ì´ì œ ìš°ë¦¬ê°€ Rustì—ì„œ ë¹„ë™ê¸° í”„ë¡œê·¸ë˜ë°ì„ ì´í•´í•˜ê¸° ìœ„í•´ ê¼­ ì•Œì•„ì•¼ í•  ë‘ ê°œë…ì¸ Futureì™€ Pollì— ëŒ€í•´ ê¹Šì´ ìˆê²Œ ì„¤ëª….  
ì´ ë‘˜ì€ Rustì˜ async ì‹œìŠ¤í…œì˜ í•µì‹¬ì´ë©°, Pinì´ ì™œ í•„ìš”í•œì§€ë„ ì´ê±¸ ì´í•´í•´ì•¼ ëª…í™•í•´ì§.

## ğŸ§  1. Futureë€?
Rustì—ì„œ FutureëŠ” ì•„ì§ ì™„ë£Œë˜ì§€ ì•Šì€ ë¹„ë™ê¸° ì‘ì—…ì„ ë‚˜íƒ€ë‚´ëŠ” ê°’.  
ì˜ˆë¥¼ ë“¤ì–´, ë„¤íŠ¸ì›Œí¬ ìš”ì²­, íŒŒì¼ ì½ê¸°, íƒ€ì´ë¨¸ ë“± ì‹œê°„ì´ ê±¸ë¦¬ëŠ” ì‘ì—…ì„ Futureë¡œ í‘œí˜„í•  ìˆ˜ ìˆìŒ.
```rust
async fn fetch_data() -> String {
    // ë¹„ë™ê¸° ì‘ì—…
    "Hello, JungHwan!".to_string()
}
```

ì´ í•¨ìˆ˜ëŠ” Future<Output = String>ì„ ë°˜í™˜í•´. ì¦‰, ë‚˜ì¤‘ì— awaitì„ í†µí•´ ê²°ê³¼ë¥¼ ë°›ì„ ìˆ˜ ìˆëŠ” ë¹„ë™ê¸° ê°’.

## ğŸ”„ 2. Pollì´ë€?
FutureëŠ” ìŠ¤ìŠ¤ë¡œ ì‹¤í–‰ë˜ì§€ ì•ŠìŒ.  
RustëŠ” poll()ì´ë¼ëŠ” ë©”ì„œë“œë¥¼ í†µí•´ Futureë¥¼ ë°˜ë³µì ìœ¼ë¡œ í˜¸ì¶œí•˜ë©´ì„œ ì§„í–‰ ìƒíƒœë¥¼ í™•ì¸í•¨.  
ì´ê²Œ Rustì˜ ë¹„ë™ê¸° ëª¨ë¸ì´ pull-basedë¼ëŠ” ëœ»ì„.

```rust
fn poll(self: Pin<&mut Self>, cx: &mut Context<'_>) -> Poll<Self::Output>
```

- Poll::Pending: ì•„ì§ ì™„ë£Œë˜ì§€ ì•ŠìŒ
- Poll::Ready(val): ì™„ë£Œë¨, ê²°ê³¼ ë°˜í™˜
- Context: í˜„ì¬ taskì˜ Wakerë¥¼ í¬í•¨ â†’ ë‚˜ì¤‘ì— ë‹¤ì‹œ ê¹¨ìš¸ ìˆ˜ ìˆìŒ

### ğŸ§ª ì‹¤ì „ ì˜ˆì œ: ì»¤ìŠ¤í…€ Future ë§Œë“¤ê¸°
```rust
use std::future::Future;
use std::pin::Pin;
use std::task::{Context, Poll, Waker};
use std::sync::{Arc, Mutex};
use std::thread;
use std::time::Duration;

// ê³µìœ  ìƒíƒœ
struct SharedState {
    completed: bool,
    waker: Option<Waker>,
}

// ì»¤ìŠ¤í…€ Future
struct TimerFuture {
    state: Arc<Mutex<SharedState>>,
}

impl Future for TimerFuture {
    type Output = &'static str;

    fn poll(self: Pin<&mut Self>, cx: &mut Context<'_>) -> Poll<Self::Output> {
        let mut state = self.state.lock().unwrap();
        if state.completed {
            Poll::Ready("íƒ€ì´ë¨¸ ì™„ë£Œ!")
        } else {
            // ì•„ì§ ì™„ë£Œë˜ì§€ ì•Šì•˜ìœ¼ë©´ waker ì €ì¥
            state.waker = Some(cx.waker().clone());
            Poll::Pending
        }
    }
}

fn main() {
    use futures::executor::block_on;

    let state = Arc::new(Mutex::new(SharedState {
        completed: false,
        waker: None,
    }));

    let future = TimerFuture {
        state: state.clone(),
    };

    // íƒ€ì´ë¨¸ ìŠ¤ë ˆë“œ ì‹œì‘
    thread::spawn(move || {
        thread::sleep(Duration::from_secs(2));
        let mut state = state.lock().unwrap();
        state.completed = true;
        if let Some(waker) = state.waker.take() {
            waker.wake();
        }
    });

    // Future ì‹¤í–‰
    let result = block_on(future);
    println!("ê²°ê³¼: {}", result);
}

```

## ğŸ” ì´ ì˜ˆì œì—ì„œ ì¤‘ìš”í•œ ì 

| ê°œë…       | ì„¤ëª…                                                                 |
|------------|----------------------------------------------------------------------|
| Future     | ì•„ì§ ì™„ë£Œë˜ì§€ ì•Šì€ ë¹„ë™ê¸° ì‘ì—…ì„ í‘œí˜„í•˜ëŠ” íƒ€ì…. `poll()`ì„ í†µí•´ ìƒíƒœë¥¼ í™•ì¸í•¨. |
| poll()     | Futureì˜ ì§„í–‰ ìƒíƒœë¥¼ í™•ì¸í•˜ëŠ” ë©”ì„œë“œ. `Pending` ë˜ëŠ” `Ready`ë¥¼ ë°˜í™˜í•¨.       |
| Waker      | Futureê°€ ë‹¤ì‹œ ì‹¤í–‰ë  ìˆ˜ ìˆë„ë¡ ê¹¨ìš°ëŠ” í•¸ë“¤. `Context`ë¥¼ í†µí•´ ì „ë‹¬ë¨.         |
| Context    | í˜„ì¬ taskì˜ ì‹¤í–‰ ì •ë³´ë¥¼ ë‹´ê³  ìˆìœ¼ë©°, `Waker`ë¥¼ í¬í•¨í•¨.                        |
| block_on() | Futureë¥¼ ì‹¤ì œë¡œ ì‹¤í–‰í•˜ëŠ” executor. ì™„ë£Œë  ë•Œê¹Œì§€ `poll()`ì„ ë°˜ë³µ í˜¸ì¶œí•¨.     |


---

# Waker
WakerëŠ” Rustì˜ ë¹„ë™ê¸° ì‹œìŠ¤í…œì—ì„œ ì•„ì£¼ ì¤‘ìš”í•œ ì—­í• ì„ í•¨.  
Futureì™€ poll()ì„ ì´í•´í–ˆë‹¤ë©´, WakerëŠ” ê·¸ íë¦„ì„ ë‹¤ì‹œ ê¹¨ìš°ëŠ” ì•ŒëŒ ì¥ì¹˜ë¼ê³  ë³´ë©´ ë¨.

## ğŸ”” Wakerë€?
Rustì˜ ë¹„ë™ê¸° ì‹œìŠ¤í…œì€ pull-basedì„.  
ì¦‰, FutureëŠ” ìŠ¤ìŠ¤ë¡œ ì‹¤í–‰ë˜ì§€ ì•Šê³ , executorê°€ poll()ì„ ë°˜ë³µ í˜¸ì¶œí•´ì„œ ì§„í–‰ì‹œì¼œ.  
ê·¸ëŸ°ë° ì–´ë–¤ FutureëŠ” ì™¸ë¶€ ì´ë²¤íŠ¸ê°€ ë°œìƒí•´ì•¼ë§Œ ì§„í–‰ ê°€ëŠ¥í•´.  
ì˜ˆë¥¼ ë“¤ì–´:
- íƒ€ì´ë¨¸ê°€ ëë‚˜ì•¼ í•¨
- ë„¤íŠ¸ì›Œí¬ ì‘ë‹µì´ ì™€ì•¼ í•¨
- íŒŒì¼ì´ ì½í˜€ì•¼ í•¨
ì´ë•Œ poll()ì€ Poll::Pendingì„ ë°˜í™˜í•˜ê³ , **â€œë‚˜ì¤‘ì— ë‹¤ì‹œ ê¹¨ì›Œì¤˜â€**ë¼ê³  ìš”ì²­í•¨.  
ì´ê±¸ ê°€ëŠ¥í•˜ê²Œ í•˜ëŠ” ê²Œ ë°”ë¡œ Wakerì•¼.

## ğŸ§  Wakerì˜ ì—­í• 
- Futureê°€ ì•„ì§ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ì„ ë•Œ, Wakerë¥¼ Contextì— ì €ì¥í•¨
- ì™¸ë¶€ ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ë©´ Waker.wake()ë¥¼ í˜¸ì¶œí•´ì„œ Futureë¥¼ ë‹¤ì‹œ ì‹¤í–‰í•˜ë„ë¡ ì•Œë¦¼
- wake()ëŠ” executorì—ê²Œ â€œì´ Future ë‹¤ì‹œ poll()í•´ì¤˜!â€ë¼ê³  ìš”ì²­í•˜ëŠ” ê²ƒ

## ğŸ§ª ì‹¤ì „ íë¦„ ì˜ˆì‹œ
```rust
fn poll(self: Pin<&mut Self>, cx: &mut Context<'_>) -> Poll<Self::Output> {
    if !ready {
        // ì•„ì§ ì¤€ë¹„ ì•ˆ ë¨ â†’ waker ì €ì¥
        state.waker = Some(cx.waker().clone());
        Poll::Pending
    } else {
        Poll::Ready(result)
    }
}
```

ê·¸ë¦¬ê³  ë‚˜ì¤‘ì— ì™¸ë¶€ ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ë©´:
```rust
if let Some(waker) = state.waker.take() {
    waker.wake(); // Futureë¥¼ ë‹¤ì‹œ pollí•˜ë„ë¡ ì•Œë¦¼
}
```


## ğŸ” WakerëŠ” ì–´ë–»ê²Œ ë§Œë“¤ì–´ì§€ë‚˜?
- ë³´í†µ executorê°€ Wakerë¥¼ ìƒì„±í•´ì„œ Contextì— ë„£ì–´ì¤Œ
- futures í¬ë ˆì´íŠ¸ë‚˜ tokio ê°™ì€ ëŸ°íƒ€ì„ì´ ìë™ìœ¼ë¡œ ì²˜ë¦¬í•´ì¤Œ
- ì§ì ‘ ë§Œë“¤ ìˆ˜ë„ ìˆì§€ë§Œ, unsafeì™€ raw pointerê°€ í•„ìš”í•´ì„œ ê³ ê¸‰ ì£¼ì œì•¼

## âœ… ìš”ì•½: Wakerì™€ ê´€ë ¨ëœ í•µì‹¬ ê°œë…

| ê°œë…       | ì„¤ëª…                                                                 |
|------------|----------------------------------------------------------------------|
| Waker      | Futureê°€ ë‹¤ì‹œ ì‹¤í–‰ë  ìˆ˜ ìˆë„ë¡ ê¹¨ìš°ëŠ” í•¸ë“¤. ì™¸ë¶€ ì´ë²¤íŠ¸ ë°œìƒ ì‹œ `wake()` í˜¸ì¶œ. |
| poll()     | Futureì˜ ìƒíƒœë¥¼ í™•ì¸í•˜ëŠ” ë©”ì„œë“œ. `Pending`ì´ë©´ `Waker`ë¥¼ ì €ì¥í•¨.             |
| wake()     | ì €ì¥ëœ `Waker`ë¥¼ í†µí•´ Futureë¥¼ ë‹¤ì‹œ `poll()`í•˜ë„ë¡ ì•Œë¦¼.                     |
| Context    | `poll()`ì— ì „ë‹¬ë˜ëŠ” ì‹¤í–‰ ì •ë³´. `Waker`ë¥¼ í¬í•¨í•˜ê³  ìˆìŒ.                      |
| executor   | Futureë¥¼ ì‹¤í–‰í•˜ê³  `Waker`ë¥¼ ìƒì„±/ê´€ë¦¬í•˜ëŠ” ëŸ°íƒ€ì„. `block_on()` ë“±ì´ í¬í•¨ë¨.   |


## Waker êµ¬ì¡°
Rustì˜ ë¹„ë™ê¸° ì‹œìŠ¤í…œì€ Wakerê°€ ì´ë²¤íŠ¸ë¥¼ ê°ì§€í•˜ê³ , ê·¸ì— ë”°ë¼ Futureë¥¼ ë‹¤ì‹œ poll()í•˜ë„ë¡ íŠ¸ë¦¬ê±°í•˜ëŠ” êµ¬ì¡°.  
ì´ê±¸ ì¡°ê¸ˆ ë” ì •ë¦¬í•´ì„œ ì„¤ëª…í•´ë³¼ê²Œ:

### ğŸ”„ Rust ë¹„ë™ê¸° íë¦„ ìš”ì•½
- executorê°€ Futureë¥¼ poll()í•¨ â†’ ìƒíƒœ í™•ì¸
- Futureê°€ ì•„ì§ ì¤€ë¹„ë˜ì§€ ì•Šìœ¼ë©´ â†’ Poll::Pending ë°˜í™˜
- FutureëŠ” Contextì—ì„œ Wakerë¥¼ êº¼ë‚´ì„œ ì €ì¥í•¨
- ì™¸ë¶€ ì´ë²¤íŠ¸ ë°œìƒ (ì˜ˆ: íƒ€ì´ë¨¸, ë„¤íŠ¸ì›Œí¬ ì‘ë‹µ ë“±)
- ì €ì¥ëœ Waker.wake() í˜¸ì¶œ â†’ executorì—ê²Œ â€œë‹¤ì‹œ poll()í•´ì¤˜â€ ìš”ì²­
- executorê°€ ë‹¤ì‹œ Futureë¥¼ poll()í•¨ â†’ ì™„ë£Œë˜ë©´ Poll::Ready


## ğŸ§  í•µì‹¬ êµ¬ì¡°: Rust ë¹„ë™ê¸° ì‹œìŠ¤í…œì˜ íë¦„
| êµ¬ì„± ìš”ì†Œ   | ì—­í•                                                                  |
|-------------|----------------------------------------------------------------------|
| Future      | ì•„ì§ ì™„ë£Œë˜ì§€ ì•Šì€ ë¹„ë™ê¸° ì‘ì—…ì„ í‘œí˜„í•˜ëŠ” íƒ€ì…. `poll()`ë¡œ ìƒíƒœë¥¼ í™•ì¸í•¨.     |
| poll()      | Futureì˜ ì§„í–‰ ìƒíƒœë¥¼ í™•ì¸í•˜ëŠ” ë©”ì„œë“œ. `Pending`ì´ë©´ `Waker`ë¥¼ ì €ì¥í•¨.         |
| Waker       | Futureê°€ ë‹¤ì‹œ ì‹¤í–‰ë  ìˆ˜ ìˆë„ë¡ ê¹¨ìš°ëŠ” í•¸ë“¤. ì™¸ë¶€ ì´ë²¤íŠ¸ ë°œìƒ ì‹œ `wake()` í˜¸ì¶œ. |
| wake()      | ì €ì¥ëœ `Waker`ë¥¼ í†µí•´ executorì—ê²Œ Futureë¥¼ ë‹¤ì‹œ `poll()`í•˜ë„ë¡ ìš”ì²­í•¨.       |
| Context     | `poll()`ì— ì „ë‹¬ë˜ëŠ” ì‹¤í–‰ ì •ë³´. `Waker`ë¥¼ í¬í•¨í•˜ê³  ìˆìŒ.                        |
| executor    | Futureë¥¼ ì‹¤í–‰í•˜ê³  `poll()`ì„ ë°˜ë³µ í˜¸ì¶œí•¨. `Waker`ë¥¼ ìƒì„±í•˜ê³  ê´€ë¦¬í•¨.           |


## ğŸ”§ ì˜ˆë¥¼ ë“¤ì–´ë³´ë©´â€¦
```rust
// Futureê°€ ì•„ì§ ì¤€ë¹„ ì•ˆ ë¨
Poll::Pending â†’ Waker ì €ì¥

// ì™¸ë¶€ ì´ë²¤íŠ¸ ë°œìƒ
thread::sleep(2ì´ˆ) â†’ Waker.wake()

// executorê°€ ë‹¤ì‹œ poll()
Poll::Ready("ì™„ë£Œ!")
```

ì´ êµ¬ì¡°ëŠ” ìŠ¤ë ˆë“œë¥¼ ë‚­ë¹„í•˜ì§€ ì•Šê³ , ì´ë²¤íŠ¸ ê¸°ë°˜ìœ¼ë¡œ Futureë¥¼ ê¹¨ì›Œì„œ ì‹¤í–‰í•˜ëŠ” ë°©ì‹.  
ê·¸ë˜ì„œ Rustì˜ asyncëŠ” ê³ ì„±ëŠ¥ì´ë©´ì„œë„ ì•ˆì „í•œ ë¹„ë™ê¸° ëª¨ë¸ì„ ì œê³µí•  ìˆ˜ ìˆëŠ” ê²ƒì„.

## ğŸ”š ê²°ë¡ 
WakerëŠ” ì¡°ê±´ì— ë”°ë¼ Threadê°€ ì†Œë¹„ë˜ê³ , ê·¸ ì†Œë¹„ëŠ” ê²°êµ­ Futureë¥¼ ë‹¤ì‹œ poll()í•˜ëŠ” íŠ¸ë¦¬ê±°ê°€ ë¨.  
ì´ê²Œ Rustì˜ ë¹„ë™ê¸° ì‹œìŠ¤í…œì´ íš¨ìœ¨ì ì´ê³  ì•ˆì „í•˜ê²Œ ì‘ë™í•˜ëŠ” í•µì‹¬ ë©”ì»¤ë‹ˆì¦˜.


## ğŸ§  Rust ë¹„ë™ê¸° ì‹œìŠ¤í…œ vs C++ ê³µê¸‰ì/ì†Œë¹„ì íŒ¨í„´ ë¹„êµ ìš”ì•½

| Rust ê°œë…   | ì—­í•  ë˜ëŠ” ì„¤ëª…                          | C++ ëŒ€ì‘ ê°œë…       | ëŒ€ì‘ ì„¤ëª…                         |
|-------------|------------------------------------------|---------------------|------------------------------------|
| Future      | ë¹„ë™ê¸° ì‘ì—…ì„ í‘œí˜„í•˜ëŠ” íƒ€ì…              | ì†Œë¹„ì (Consumer)   | ì‘ì—… ê²°ê³¼ë¥¼ ê¸°ë‹¤ë¦¬ëŠ” ì£¼ì²´         |
| poll()      | Futureì˜ ìƒíƒœë¥¼ í™•ì¸í•˜ëŠ” ë©”ì„œë“œ          | ì¡°ê±´ í™•ì¸ ë£¨í”„      | ì†Œë¹„ìê°€ ì¡°ê±´ì„ í™•ì¸í•˜ëŠ” ë£¨í”„     |
| Waker       | Futureë¥¼ ë‹¤ì‹œ ì‹¤í–‰í•˜ë„ë¡ ì•Œë¦¼ì„ ë³´ë‚´ëŠ” í•¸ë“¤ | notify_one()        | ì¡°ê±´ ë³€ìˆ˜ë¡œ ì†Œë¹„ìë¥¼ ê¹¨ìš°ëŠ” í•¨ìˆ˜ |
| wake()      | Wakerë¥¼ í†µí•´ executorì—ê²Œ ì•Œë¦¼            | ê³µê¸‰ìì˜ ì•Œë¦¼ íŠ¸ë¦¬ê±° | ì¡°ê±´ì´ ë§Œì¡±ë˜ì—ˆìŒì„ ì•Œë¦¼          |
| executor    | Futureë¥¼ ì‹¤í–‰í•˜ê³  pollì„ ë°˜ë³µ í˜¸ì¶œí•¨      | ìŠ¤ì¼€ì¤„ëŸ¬ / ì‹¤í–‰ê¸°   | ì†Œë¹„ìë¥¼ ì‹¤í–‰í•˜ëŠ” ì£¼ì²´            |
| Context     | pollì— ì „ë‹¬ë˜ëŠ” ì‹¤í–‰ ì •ë³´ (Waker í¬í•¨)     | ê³µìœ  ìƒíƒœ êµ¬ì¡°ì²´    | ì¡°ê±´ ë³€ìˆ˜ì™€ ìƒíƒœë¥¼ ë‹´ëŠ” êµ¬ì¡°ì²´    |




