# ğŸ§© PhantomDataë€ ë¬´ì—‡ì¸ê°€?
- ì œë¡œ í¬ê¸° íƒ€ì…(ZST, Zero-Sized Type): PhantomData<T>ëŠ” ë©”ëª¨ë¦¬ë¥¼ ì°¨ì§€í•˜ì§€ ì•Šì§€ë§Œ,  
  ì»´íŒŒì¼ëŸ¬ì—ê²Œ **ì´ íƒ€ì…ì€ Tì™€ ê´€ë ¨ ìˆë‹¤** ë¼ëŠ” ì •ë³´ë¥¼ ì „ë‹¬í•©ë‹ˆë‹¤.
- ëŸ°íƒ€ì„ ì˜í–¥ ì—†ìŒ: ì‹¤ì œë¡œ T ê°’ì„ ì €ì¥í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ì‹¤í–‰ ì‹œì ì—ëŠ” ì•„ë¬´ëŸ° ë¹„ìš©ì´ ì—†ìŠµë‹ˆë‹¤.
- ì»´íŒŒì¼ëŸ¬ íŒíŠ¸: ìˆ˜ëª…(lifetime), ì†Œìœ ê¶Œ, ìë™ íŠ¸ë ˆì´íŠ¸(Send, Sync) íŒì •, ë“œë¡­ ì²´í¬(drop check) ë“±ì— ì˜í–¥ì„ ì¤ë‹ˆë‹¤.

## ğŸ“Œ ì™œ í•„ìš”í•œê°€?
Rustì—ì„œëŠ” íƒ€ì… ë§¤ê°œë³€ìˆ˜(T)ë‚˜ ìˆ˜ëª…('a)ì„ ì„ ì–¸í–ˆì§€ë§Œ ì‹¤ì œë¡œ êµ¬ì¡°ì²´ ì•ˆì—ì„œ ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë©´, ì»´íŒŒì¼ëŸ¬ê°€ ê·¸ ê´€ê³„ë¥¼ ì•Œ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.  
ì´ëŸ´ ë•Œ PhantomDataë¥¼ ë„£ì–´ì£¼ë©´ ì»´íŒŒì¼ëŸ¬ê°€ ì˜¬ë°”ë¥¸ ì œì•½ì„ ì ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ğŸ”‘ ì£¼ìš” ì‚¬ìš© ì‚¬ë¡€
### 1. ìˆ˜ëª…(lifetime) ì—°ê²°
```rust
use std::marker::PhantomData;

struct Slice<'a, T> {
    start: *const T,
    end: *const T,
    _marker: PhantomData<&'a T>, // 'a ìˆ˜ëª…ê³¼ ì—°ê²°
}
```

- Slice<'a, T>ëŠ” ì‹¤ì œë¡œ &'a Të¥¼ ì €ì¥í•˜ì§€ ì•Šì§€ë§Œ, 'a ìˆ˜ëª…ì„ ê°€ì§€ë„ë¡ ê°•ì œí•©ë‹ˆë‹¤.
- ë”°ë¼ì„œ Sliceê°€ 'aë³´ë‹¤ ì˜¤ë˜ ì‚´ ìˆ˜ ì—†ê²Œ ë©ë‹ˆë‹¤.

### 2. íƒ€ì… ë§¤ê°œë³€ìˆ˜ íƒœê¹…
```rust
use std::marker::PhantomData;

struct Id<T> {
    value: u64,
    _marker: PhantomData<T>, // Tì™€ ì—°ê²°
}
```

- Id<User>ì™€ Id<Order>ëŠ” ë‚´ë¶€ì ìœ¼ë¡œ ê°™ì€ u64ë¥¼ ì €ì¥í•˜ì§€ë§Œ, ì„œë¡œ ë‹¤ë¥¸ íƒ€ì…ìœ¼ë¡œ êµ¬ë¶„ë©ë‹ˆë‹¤.
- ì˜ëª»ëœ íƒ€ì… í˜¼ìš©ì„ ë§‰ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### 3. FFI í•¸ë“¤, í¬ì¸í„° ë˜í¼
```rust
struct ExternalResource<R> {
    handle: *mut (),
    _marker: PhantomData<R>, // Rê³¼ ì—°ê²°
}
```
- ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ í•¸ë“¤ì„ ê°ìŒ€ ë•Œ, ì‹¤ì œë¡œ Rì„ ì €ì¥í•˜ì§€ ì•Šì•„ë„ PhantomData<R>ë¡œ íƒ€ì… ì•ˆì „ì„±ì„ í™•ë³´í•©ë‹ˆë‹¤.

## âš™ï¸ PhantomDataê°€ ì˜í–¥ì„ ì£¼ëŠ” ê²ƒë“¤
- ìˆ˜ëª…(lifetime): PhantomData<&'a T>ë¥¼ ë„£ìœ¼ë©´ 'a ìˆ˜ëª…ì„ êµ¬ì¡°ì²´ì— ê°•ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ë³€ì„±(variance):
  - PhantomData<T> â†’ Tì— ëŒ€í•´ ë¶ˆë³€(invariant)
  - PhantomData<&'a T> â†’ ì°¸ì¡°ì²˜ëŸ¼ ê³µë³€(covariant)
  - PhantomData<fn(T)> â†’ ë°˜ê³µë³€(contravariant) (ê³ ê¸‰ íŒ¨í„´)
- ë“œë¡­ ì²´í¬(drop check): PhantomData<T>ëŠ” êµ¬ì¡°ì²´ê°€ Të¥¼ â€œì†Œìœ â€í•˜ëŠ” ê²ƒì²˜ëŸ¼ ì·¨ê¸‰ë˜ì–´ ë“œë¡­ ì‹œì ì— Tì˜ ì†Œë©¸ì ê³ ë ¤ê°€ ë“¤ì–´ê°‘ë‹ˆë‹¤.
- ìë™ íŠ¸ë ˆì´íŠ¸(auto traits): Send, Sync ì—¬ë¶€ê°€ PhantomData<T>ì— ì˜í•´ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  - ì˜ˆ: Tê°€ Sendê°€ ì•„ë‹ˆë©´ PhantomData<T>ë¥¼ ê°€ì§„ êµ¬ì¡°ì²´ë„ Sendê°€ ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

## âœ… ì–´ë–¤ í˜•íƒœë¥¼ ì¨ì•¼ í• ê¹Œ?
- ì‹¤ì œë¡œ Të¥¼ ì†Œìœ í•˜ëŠ” ê²ƒì²˜ëŸ¼ ë™ì‘í•´ì•¼ í•  ë•Œ â†’ PhantomData<T>
- ìˆ˜ëª…ë§Œ ì—°ê²°í•˜ê³  ì‹¶ì„ ë•Œ â†’ PhantomData<&'a T> ë˜ëŠ” PhantomData<&'a ()>
- íƒ€ì… íƒœê¹…ë§Œ í•˜ê³  ì‹¶ì„ ë•Œ â†’ PhantomData<T> (ë‹¨, ì†Œìœ ê¶Œ ì˜ë¯¸ê°€ í•„ìš” ì—†ë‹¤ë©´ ì°¸ì¡°í˜•ì„ ì“°ëŠ” ê²Œ ë” ì ì ˆí•  ìˆ˜ ìˆìŒ)

## ğŸš¨ ì£¼ì˜í•  ì 
- PhantomData<T>ëŠ” â€œTë¥¼ ì†Œìœ í•œë‹¤â€ëŠ” ì˜ë¯¸ë¥¼ ì£¼ê¸° ë•Œë¬¸ì— Send/Sync ìë™ íŠ¸ë ˆì´íŠ¸ì— ì˜í–¥ì„ ì¤ë‹ˆë‹¤.
- ë‹¨ìˆœíˆ ìˆ˜ëª…ë§Œ í‘œí˜„í•˜ê³  ì‹¶ë‹¤ë©´ PhantomData<&'a T>ë¥¼ ì“°ëŠ” ê²ƒì´ ë” ì•ˆì „í•©ë‹ˆë‹¤.
- ì´ˆê¸°í™”ëŠ” ê·¸ëƒ¥ PhantomDataë¡œ í•˜ë©´ ë©ë‹ˆë‹¤. (PhantomData::<T>ë„ ê°€ëŠ¥í•˜ì§€ë§Œ ë³´í†µ ìƒëµ)
- ğŸ‘‰ ì •ë¦¬í•˜ë©´, PhantomDataëŠ” ëŸ°íƒ€ì„ì—ëŠ” ì•„ë¬´ ì˜í–¥ì´ ì—†ì§€ë§Œ ì»´íŒŒì¼ëŸ¬ì—ê²Œ íƒ€ì…/ìˆ˜ëª… ì •ë³´ë¥¼ ì „ë‹¬í•˜ëŠ” ë„êµ¬ì…ë‹ˆë‹¤.

---

# PhantomData 

PhantomDataê°€ ì—†ì„ ë•Œì™€ ìˆì„ ë•Œ ì»´íŒŒì¼ëŸ¬ê°€ ì–´ë–»ê²Œ ë‹¤ë¥´ê²Œ ë™ì‘í•˜ëŠ”ì§€ ë³´ì—¬ì£¼ëŠ” ê°„ë‹¨í•œ ì˜ˆì œ.

## ğŸ“Œ ì˜ˆì œ: ìˆ˜ëª…(lifetime)ì„ í‘œí˜„í•˜ì§€ ì•Šì•˜ì„ ë•Œ vs PhantomDataë¡œ í‘œí˜„í–ˆì„ ë•Œ
```rust
use std::marker::PhantomData;

//
// 1. PhantomDataê°€ ì—†ëŠ” ê²½ìš°
//
struct SliceNoPhantom<'a, T> {
    start: *const T,
    end: *const T,
    // 'a ìˆ˜ëª…ê³¼ ì—°ê²°ëœ ì •ë³´ê°€ ì—†ìŒ!
}
```
```rust
//
// 2. PhantomDataê°€ ìˆëŠ” ê²½ìš°
//
struct SliceWithPhantom<'a, T> {
    start: *const T,
    end: *const T,
    _marker: PhantomData<&'a T>, // 'a ìˆ˜ëª…ê³¼ ì—°ê²°
}
```
```rust
fn main() {
    let v = vec![1, 2, 3];

    // âœ… ì •ìƒ: ë²¡í„° ì°¸ì¡°ê°€ ì‚´ì•„ìˆëŠ” ë™ì•ˆ Slice ìƒì„±
    let slice1 = SliceNoPhantom {
        start: v.as_ptr(),
        end: unsafe { v.as_ptr().add(v.len()) },
    };

    let slice2 = SliceWithPhantom {
        start: v.as_ptr(),
        end: unsafe { v.as_ptr().add(v.len()) },
        _marker: PhantomData,
    };

    println!("slice1 start: {:?}", slice1.start);
    println!("slice2 start: {:?}", slice2.start);

    // âŒ ë¬¸ì œ ìƒí™©: ë²¡í„°ê°€ dropëœ ë’¤ì—ë„ slice1ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ
    let dangling = {
        let v2 = vec![10, 20, 30];
        SliceNoPhantom {
            start: v2.as_ptr(),
            end: unsafe { v2.as_ptr().add(v2.len()) },
        }
    };
    // ì—¬ê¸°ì„œ v2ëŠ” ì´ë¯¸ dropë¨ â†’ dangling í¬ì¸í„°
    println!("dangling start: {:?}", dangling.start);

    // âœ… PhantomDataê°€ ìˆìœ¼ë©´ ì´ëŸ° ì½”ë“œê°€ ì»´íŒŒì¼ë˜ì§€ ì•ŠìŒ
    /*
    let dangling2 = {
        let v3 = vec![10, 20, 30];
        SliceWithPhantom {
            start: v3.as_ptr(),
            end: unsafe { v3.as_ptr().add(v3.len()) },
            _marker: PhantomData,
        }
    };
    println!("dangling2 start: {:?}", dangling2.start);
    */
}
```


## ğŸ“ ì„¤ëª…
- SliceNoPhantomì€ 'a ìˆ˜ëª…ì„ ì„ ì–¸í–ˆì§€ë§Œ ì‹¤ì œë¡œ êµ¬ì¡°ì²´ ì•ˆì—ì„œ 'aë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ì»´íŒŒì¼ëŸ¬ê°€ ìˆ˜ëª… ì œì•½ì„ ì ìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
  - ë”°ë¼ì„œ ë²¡í„°ê°€ dropëœ ë’¤ì—ë„ SliceNoPhantomì„ ë§Œë“¤ ìˆ˜ ìˆì–´ ìœ„í—˜í•œ ëŒ•ê¸€ë§ í¬ì¸í„°ê°€ ìƒê¹ë‹ˆë‹¤.
- SliceWithPhantomì€ PhantomData<&'a T>ë¥¼ ë„£ì–´ 'a ìˆ˜ëª…ê³¼ ì—°ê²°í–ˆê¸° ë•Œë¬¸ì—, ë²¡í„°ê°€ dropëœ ë’¤ì—ëŠ” SliceWithPhantomì„ ë§Œë“¤ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
  - ì»´íŒŒì¼ ì—ëŸ¬ê°€ ë°œìƒí•˜ì—¬ ì•ˆì „ì„±ì„ ë³´ì¥í•©ë‹ˆë‹¤.

## ğŸš€ ê²°ë¡ 
- PhantomDataëŠ” ëŸ°íƒ€ì„ì—ëŠ” ì•„ë¬´ ì˜í–¥ì´ ì—†ì§€ë§Œ, ì»´íŒŒì¼ëŸ¬ì—ê²Œ â€œì´ íƒ€ì…ì€ 'aì™€ ì—°ê²°ë˜ì–´ ìˆë‹¤â€ë¼ëŠ” ì •ë³´ë¥¼ ì¤ë‹ˆë‹¤.
- ë•ë¶„ì— ìˆ˜ëª…, ì†Œìœ ê¶Œ, ìë™ íŠ¸ë ˆì´íŠ¸ íŒì •ì´ ì˜¬ë°”ë¥´ê²Œ ì ìš©ë˜ì–´ ì•ˆì „í•œ ì½”ë“œë¥¼ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
