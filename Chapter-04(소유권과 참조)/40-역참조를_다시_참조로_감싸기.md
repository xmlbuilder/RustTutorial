# 역참조한 값을 다시 참조로 감싼다(&*) 의미파악

##  전체 코드
```rust
use std::ptr::NonNull;

struct Node {
    value: i32,
    next: Option<NonNull<Node>>,
}

impl Node {
    fn new(value: i32) -> Box<Self> {
        Box::new(Node { value, next: None })
    }

    fn set_next(&mut self, next: &mut Node) {
        self.next = Some(NonNull::from(next));
    }

    fn next(&self) -> Option<&Node> {
        self.next.map(|ptr| unsafe { ptr.as_ref() })
    }
}

fn main() {
    // 노드 생성
    let mut node1 = Node::new(10);
    let mut node2 = Node::new(20);
    let mut node3 = Node::new(30);

    // 연결: node1 → node2 → node3
    node1.set_next(&mut node2);
    node2.set_next(&mut node3);

    // 순회하며 값 출력
    let mut current = Some(&*node1);
    while let Some(node) = current {
        println!("Node value: {}", node.value);
        current = node.next();
    }
}
```

## 🔍  분석 코드
```rust
let mut current = Some(&*node1);
```
- 이 문장은 Box<Node> 타입인 node1을 참조 형태로 감싸서 Option<&Node>로 초기화하는 코드입니다.

## 🧠 단계별 해석
### 1️⃣ node1의 타입은?
```rust
let mut node1 = Node::new(10);
```

- Node::new()의 반환 타입은 Box<Node>
- 즉, node1은 Box<Node> 타입

### 2️⃣ *node1 — Box 해제 (dereference)
- *node1은 Box<Node>를 **해제(dereference)** 해서 Node 값을 꺼냅니다
- 결과 타입: Node
```rust
let raw_node: Node = *node1; // ❌ 이건 소유권 이동이라 불가능
```
- 하지만 *node1은 값 자체를 꺼내는 거라서 소유권을 이동시키게 되므로 직접 쓰면 안 됩니다.

### 3️⃣ &*node1 — 참조 생성
- &*node1은 Box<Node>를 해제한 후, 그 값을 참조로 감쌉니다
- 결과 타입: &Node
- 즉, Box<Node> → Node → &Node

### 4️⃣ Some(&*node1) — Option으로 감싸기
- Some(&*node1)은 Option<&Node> 타입
- 이걸 current에 넣어서 리스트 순회에 사용

### ✅ 왜 이렇게 복잡하게 쓰는가?
- Box<Node>는 소유권을 가지므로 직접 꺼내면 move가 발생
- &*node1은 소유권을 이동하지 않고 안전하게 참조를 얻는 방법
- Rust는 Box<T>에 대해 Deref 트레이트를 구현했기 때문에 *box가 T로 해제됨
  
## ✨ 정리: `let mut current = Some(&*node1);`의 의미
| 표현            | 설명                          | 결과 타입         |
|-----------------|-------------------------------|-------------------|
| `node1`         | `Box<Node>`                   | `Box<Node>`       |
| `*node1`        | Box를 해제해서 값 꺼내기      | `Node`            |
| `&*node1`       | 꺼낸 값을 참조로 감싸기        | `&Node`           |
| `Some(&*node1)` | 참조를 `Option`으로 감싸기     | `Option<&Node>`   |

---



