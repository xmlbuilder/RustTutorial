# NonNull
Rustμ NonNull<T>λ” nullμ΄ μ•„λ‹ ν¬μΈν„°λ¥Ό μ•μ „ν•κ² λ‹¤λ£¨κΈ° μ„ν• νƒ€μ…μ…λ‹λ‹¤.  
μΌλ°μ μΈ raw pointer (*mut T, *const T)λ” nullμΌ μ μκΈ° λ•λ¬Έμ— μ‚¬μ© μ‹ ν•­μƒ null μ²΄ν¬κ°€ ν•„μ”ν•μ§€λ§,  
NonNull<T>λ” nullμ΄ μ•„λ‹μ„ λ³΄μ¥ν•λ―€λ΅ μ΄λ¬ν• μ²΄ν¬ μ—†μ΄λ„ μ•μ „ν•κ² μ‚¬μ©ν•  μ μμµλ‹λ‹¤.

## π§  ν•µμ‹¬ κ°λ…
- NonNull<T>λ” *mut Tλ¥Ό λν•‘ν• κµ¬μ΅°μ²΄μ…λ‹λ‹¤.
- null ν¬μΈν„°λ¥Ό ν—μ©ν•μ§€ μ•κΈ° λ•λ¬Έμ—, Option<NonNull<T>>λ” nullκ³Ό non-nullμ„ κµ¬λ¶„ν•λ” μ•μ „ν• λ°©μ‹μΌλ΅ μ‚¬μ©λ©λ‹λ‹¤.
- NonNull<T>λ” Send, Sync, Copy λ“±μ traitμ„ κµ¬ν„ν•μ§€ μ•μΌλ©°, μμ • κ°€λ¥ν• ν¬μΈν„°λ΅μ„μ μ—­ν• μ— μ§‘μ¤‘ν•©λ‹λ‹¤.

## π›  μ£Όμ” λ©”μ„λ“μ™€ μ‚¬μ© μμ‹
```rust
use std::ptr::NonNull;

fn main() {
    let mut value = 42;
    let ptr = NonNull::new(&mut value as *mut i32).expect("Pointer is null");
    
    unsafe {
        *ptr.as_mut() += 1;
    }

    println!("Updated value: {}", value); // 43
}
```

- NonNull::new(ptr) β†’ nullμ΄ μ•„λ‹ κ²½μ° Some(NonNull)μ„ λ°ν™
- NonNull::new_unchecked(ptr) β†’ null μ²΄ν¬ μ—†μ΄ μƒμ„± (β οΈ unsafe)
- as_ptr() β†’ λ‚΄λ¶€ raw pointer λ°ν™
- as_mut() / as_ref() β†’ mutable λλ” immutable μ°Έμ΅° λ°ν™ (unsafe)

### β οΈ μ£Όμμ‚¬ν•­
- NonNullμ€ nullμ΄ μ•„λ‹μ„ λ³΄μ¥ν•μ§€λ§, μ ν¨ν• λ©”λ¨λ¦¬μΈμ§€κΉμ§€λ” λ³΄μ¥ν•μ§€ μ•μµλ‹λ‹¤.
- NonNull::dangling()μ€ μ μ •λ ¬λ "dangling" ν¬μΈν„°λ¥Ό μƒμ„±ν•μ§€λ§, μ‹¤μ λ΅ μ ‘κ·Όν•λ©΄ undefined behaviorκ°€ λ°μƒν•  μ μμµλ‹λ‹¤.
- NonNullμ„ ν†µν•΄ μ°Έμ΅°λ¥Ό μƒμ„±ν•  λ•λ” λ°λ“μ‹ ν•΄λ‹Ή λ©”λ¨λ¦¬κ°€ μ΄κΈ°ν™”λμ–΄ μκ³  μ ‘κ·Ό κ°€λ¥ν• μƒνƒμΈμ§€ ν™•μΈν•΄μ•Ό ν•©λ‹λ‹¤.


### π“¦ ν™μ© μμ‹
- μ¤λ§νΈ ν¬μΈν„° κµ¬ν„: Box, Rc, Arc λ“± λ‚΄λ¶€μ μΌλ΅ NonNullμ„ μ‚¬μ©ν•΄ null μ²΄ν¬λ¥Ό μ κ±°ν•κ³  μ„±λ¥μ„ ν–¥μƒμ‹ν‚µλ‹λ‹¤.
- μµμ… ν¬μΈν„° ν‘ν„: Option<NonNull<T>>λ” Option<*mut T>λ³΄λ‹¤ λ©”λ¨λ¦¬ ν¨μ¨μ μ΄λ©° μ•μ „ν•©λ‹λ‹¤.
- Ffi λλ” μ €μμ¤€ μ‹μ¤ν… ν”„λ΅κ·Έλλ°μ—μ„ nullμ΄ μ•„λ‹ ν¬μΈν„°λ¥Ό λ‹¤λ£° λ• μ μ©ν•©λ‹λ‹¤.

---

# NonNull<T>λΌλ” νƒ€μ…μ„ λ”°λ΅ λ„μ…ν–μ„κΉμ”? 
κ·Έ μ΄μ λ” μ„±λ¥, ν‘ν„λ ¥, κ·Έλ¦¬κ³  μ•μ „μ„±μ„ λ¨λ‘ λ§μ΅±μ‹ν‚¤κΈ° μ„ν• μ„¤κ³„μ  μ„ νƒ λ•λ¬Έμ…λ‹λ‹¤.

## π§© Option<NonNull<T>> vs Option<*mut T>
### 1. β… λ©”λ¨λ¦¬ μµμ ν™” (null pointer optimization)
- Rustλ” Option<NonNull<T>>λ¥Ό λ‚΄λ¶€μ μΌλ΅ NonNull<T>μ™€ λ™μΌν• ν¬κΈ°λ΅ μµμ ν™”ν•©λ‹λ‹¤.
- λ°λ©΄ Option<*mut T>λ” nullμ„ ν‘ν„ν•κΈ° μ„ν•΄ μ¶”κ°€μ μΈ λ©”λ¨λ¦¬κ°€ ν•„μ”ν•  μ μμµλ‹λ‹¤.
- μ¦‰, NonNull<T>λ¥Ό μ“°λ©΄ Optionμ„ μ¨λ„ μ¶”κ°€ μ¤λ²„ν—¤λ“ μ—†μ΄ null/non-nullμ„ ν‘ν„ν•  μ μμ.

###  2. π”’ μ•μ „μ„± κ°•ν™”
- NonNull<T>λ” nullμ΄ μ•„λ‹μ„ νƒ€μ… μμ¤€μ—μ„ λ³΄μ¥ν•©λ‹λ‹¤.
- *mut Tλ” μ–Έμ λ“ μ§€ nullμΌ μ μμΌλ―€λ΅, μ‚¬μ© μ‹ ν•­μƒ null μ²΄ν¬κ°€ ν•„μ”ν•κ³  μ‹¤μλ΅ dereferenceν•λ©΄ undefined behaviorκ°€ λ°μƒν•  μ μμ.
- NonNull<T>λ¥Ό μ‚¬μ©ν•λ©΄ μ»΄νμΌλ¬κ°€ null κ΄€λ ¨ λ²„κ·Έλ¥Ό μ‚¬μ „μ— λ°©μ§€ν•  μ μμµλ‹λ‹¤.
### 3. π§  μλ„ ν‘ν„
- NonNull<T>λ¥Ό μ‚¬μ©ν•λ©΄ "μ΄ ν¬μΈν„°λ” μ λ€ nullμ΄ μ•„λ‹μ–΄μ•Ό ν•λ‹¤"λ” κ°λ°μμ μλ„λ¥Ό λ…ν™•ν ν‘ν„ν•  μ μμ.
- μ΄λ” μ½”λ“μ κ°€λ…μ„±κ³Ό μ μ§€λ³΄μμ„±μ—λ„ ν° λ„μ›€μ΄ λ©λ‹λ‹¤.

### π“¦ μ‹¤μ  μ‚¬μ© μμ‹
```rust
use std::ptr::NonNull;

struct MyBox<T> {
    ptr: NonNull<T>,
}

impl<T> MyBox<T> {
    fn new(value: T) -> Self {
        let boxed = Box::new(value);
        MyBox {
            ptr: NonNull::from(Box::leak(boxed)),
        }
    }

    fn get(&self) -> &T {
        unsafe { self.ptr.as_ref() }
    }
}
```

- μ„ μμ‹μ²λΌ Box, Rc, Arc κ°™μ€ μ¤λ§νΈ ν¬μΈν„° κµ¬ν„μ—μ„ NonNull<T>λ” nullμ΄ μ•„λ‹μ„ λ³΄μ¥ν•λ©΄μ„λ„ raw pointerμ²λΌ μ μ—°ν•κ² μ‚¬μ©λ©λ‹λ‹¤.

## π” μ”μ•½
| ν•­λ©             | *mut T       | NonNull<T>   | Option<NonNull<T>> |
|------------------|--------------|--------------|---------------------|
| Null ν—μ©        | β… κ°€λ¥       | β λ¶κ°€λ¥     | β… κ°€λ¥              |
| μ•μ „μ„±           | β οΈ λ‚®μ       | β… λ†’μ       | β… λ†’μ              |
| λ©”λ¨λ¦¬ μµμ ν™”    | β μ—†μ       | β μ—†μ       | β… μμ              |
| μλ„ ν‘ν„        | β λ¶λ…ν™•     | β… λ…ν™•       | β… λ…ν™•              |
| μ‚¬μ© μ‹ null μ²΄ν¬ | ν•„μ”ν•¨        | λ¶ν•„μ”        | `is_some()`λ΅ μ²΄ν¬   |


κ²°κµ­ NonNull<T>λ” Option<T>μ™€ κ²½μν•λ” κ² μ•„λ‹λΌ, raw pointerλ¥Ό μ•μ „ν•κ² κ°μ‹Έλ©΄μ„ Optionκ³Ό ν•¨κ» μ“Έ μ μλ„λ΅ μ„¤κ³„λ νƒ€μ…μ΄μ—μ”.  


## π” μ½”λ“ λ¶„μ„
```rust
ptr: NonNull::from(Box::leak(boxed))
```

μ΄ μ¤„μ€ boxedλΌλ” Box<T>λ¥Ό NonNull<T>λ΅ λ³€ν™ν•λ” κ³Όμ •μ…λ‹λ‹¤.  
κ° λ‹¨κ³„λ” λ‹¤μκ³Ό κ°™μµλ‹λ‹¤:

## π§± 1. Box::leak(boxed)
- Box<T>λ” Rustμ ν™ ν• λ‹Ή μ¤λ§νΈ ν¬μΈν„°μ…λ‹λ‹¤.
- Box::leak(boxed)λ” Box<T>λ¥Ό λ„μ(leak) μ‹μΌμ„ 'static μλ…μ &mut T μ°Έμ΅°λ¥Ό λ°ν™ν•©λ‹λ‹¤.
- μ΄ μ°Έμ΅°λ” Boxκ°€ dropλμ§€ μ•κ³  ν”„λ΅κ·Έλ¨μ΄ λλ‚  λ•κΉμ§€ μ‚΄μ•„μμμ„ μλ―Έν•©λ‹λ‹¤.
let boxed = Box::new(42);
let leaked: &mut i32 = Box::leak(boxed); // μ΄μ  leakedλ” 'static μλ…



## π§± 2. NonNull::from(...)
- NonNull::from(&mut T)λ” &mut Tλ¥Ό nullμ΄ μ•„λ‹ ν¬μΈν„°λ΅ κ°μ‹Έλ” NonNull<T>λ΅ λ³€ν™ν•©λ‹λ‹¤.
- μ΄ ν¬μΈν„°λ” nullμ΄ μ•„λ‹μ„ νƒ€μ… μμ¤€μ—μ„ λ³΄μ¥ν•©λ‹λ‹¤.
let ptr: NonNull<i32> = NonNull::from(leaked);

## π”— μ „μ²΄ μλ―Έ
```rust
ptr: NonNull::from(Box::leak(boxed))
```

- Box<T>λ¥Ό ν™μ— ν• λ‹Ήν•κ³ ,
- κ·Έ κ°’μ„ λ„μμ‹μΌμ„ 'static μ°Έμ΅°λ΅ λ§λ“¤κ³ ,
- κ·Έ μ°Έμ΅°λ¥Ό NonNull<T>λ΅ κ°μ‹Έμ„ nullμ΄ μ•„λ‹ μ•μ „ν• ν¬μΈν„°λ΅ μ €μ¥ν•λ” κ²ƒμ…λ‹λ‹¤.

## π“¦ μ™ μ΄λ ‡κ² μ“°λ”κ°€?
- μ¤λ§νΈ ν¬μΈν„° κµ¬ν„μ—μ„ λ‚΄λ¶€μ μΌλ΅ NonNull<T>λ¥Ό μ‚¬μ©ν•λ©΄ null μ²΄ν¬ μ—†μ΄ μ•μ „ν•κ² ν¬μΈν„°λ¥Ό λ‹¤λ£° μ μμµλ‹λ‹¤.
- Box::leakμ„ μ“°λ©΄ dropμ„ λ°©μ§€ν•κ³  'static μλ…μ„ μ–»μ„ μ μμ–΄ μλ… κ΄€λ¦¬κ°€ λ‹¨μν•΄μ§‘λ‹λ‹¤.
- μ΄ ν¨ν„΄μ€ Rc, Arc, Vec, HashMap κ°™μ€ ν‘μ¤€ λΌμ΄λΈλ¬λ¦¬μ—μ„λ„ μμ£Ό μ‚¬μ©λ©λ‹λ‹¤.

## β οΈ μ£Όμμ‚¬ν•­
- Box::leakμ€ λ©”λ¨λ¦¬ λ„μλ¥Ό μΌμΌν‚¬ μ μμΌλ―€λ΅, μ •λ§λ΅ ν”„λ΅κ·Έλ¨ μΆ…λ£κΉμ§€ μ‚΄μ•„μμ–΄μ•Ό ν•  κ²½μ°μ—λ§ μ‚¬μ©ν•΄μ•Ό ν•©λ‹λ‹¤.
- NonNullμ€ nullμ΄ μ•„λ‹μ„ λ³΄μ¥ν•μ§€λ§, μ ν¨ν• λ©”λ¨λ¦¬μΈμ§€κΉμ§€λ” λ³΄μ¥ν•μ§€ μ•μΌλ―€λ΅ unsafe λΈ”λ΅μ—μ„ μ‚¬μ© μ‹ μ£Όμκ°€ ν•„μ”ν•©λ‹λ‹¤.
