# ë¼ì´í”„íƒ€ì„ ì‹œìŠ¤í…œ ìš°íšŒí•˜ê¸°

ì´ ì½”ë“œëŠ” Rustì˜ ë¼ì´í”„íƒ€ì„ ì‹œìŠ¤í…œì„ ìš°íšŒí•´ì„œ 'static ì°¸ì¡°ë¥¼ ë§Œë“œëŠ” ë°©ì‹ì´ì—ìš”.  
ì•„ë˜ì— ì¤„ë³„ë¡œ ì˜ë¯¸ë¥¼ ìì„¸íˆ ì„¤ëª…:

## ì½”ë“œ
```rust
let params = Box::new(Params { k: 1.5 });
let k = params.k;

// Box::leak â†’ &'static mut Params
let static_params: &'static mut Params = Box::leak(params);
let ok = solver.rk45_with_user(f_ud, t0, &y0, t1, &mut y1, static_params, None, None, None);

```

## ğŸ” ì½”ë“œ ì˜ë¯¸ í•´ì„¤
### 1ï¸âƒ£ let params = Box::new(Params { k: 1.5 });
- Params êµ¬ì¡°ì²´ë¥¼ í™ì— í• ë‹¹
- paramsëŠ” Box<Params> íƒ€ì… â†’ í™ì— ì €ì¥ëœ Paramsë¥¼ ê°€ë¦¬í‚´
- ì´ê±¸ ì‚¬ìš©í•˜ëŠ” ì´ìœ ëŠ” ìŠ¤íƒì— ìˆëŠ” ê°’ì€ 'static ë¼ì´í”„íƒ€ì„ì„ ê°€ì§ˆ ìˆ˜ ì—†ê¸° ë•Œë¬¸

### 2ï¸âƒ£ let k = params.k;
- params.k ê°’ì„ ë³µì‚¬í•´ì„œ kì— ì €ì¥
- ì´ê±´ í…ŒìŠ¤íŠ¸ ê²°ê³¼ ê²€ì¦ìš©ìœ¼ë¡œ ì“°ì´ê¸° ë•Œë¬¸ì— paramsì˜ ì†Œìœ ê¶Œê³¼ ë¬´ê´€

### 3ï¸âƒ£ let static_params: &'static mut Params = Box::leak(params);
- í•µì‹¬ ì¤„ì…ë‹ˆë‹¤!
- Box::leak(...)ì€ Box<T>ë¥¼ í•´ì œí•˜ì§€ ì•Šê³  'static ì°¸ì¡°ë¡œ ë³€í™˜
- ì¦‰, paramsëŠ” ì´ì œ 'static ë¼ì´í”„íƒ€ì„ì„ ê°€ì§„ &'static mut Paramsë¡œ ì‚¬ìš© ê°€ëŠ¥
- ì´ê±´ í…ŒìŠ¤íŠ¸ë‚˜ ë‹¨ì¼ ì‹¤í–‰ í™˜ê²½ì—ì„œë§Œ ì•ˆì „í•©ë‹ˆë‹¤. ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ê°€ ë°œìƒí•  ìˆ˜ ìˆê¸° ë•Œë¬¸

### 4ï¸âƒ£ let ok = solver.rk45_with_user(..., static_params, ...)
- rk45_with_user()ëŠ” ë‚´ë¶€ í´ë¡œì €ì—ì„œ userë¥¼ ì°¸ì¡°í•˜ê¸° ë•Œë¬¸ì— 'a ë¼ì´í”„íƒ€ì„ì´ í•„ìš”
- static_paramsëŠ” 'staticì´ë¯€ë¡œ 'a ìš”êµ¬ë¥¼ ë§Œì¡±ì‹œí‚´
- ë”°ë¼ì„œ ì»´íŒŒì¼ëŸ¬ê°€ ë¼ì´í”„íƒ€ì„ ì˜¤ë¥˜ë¥¼ ë°œìƒì‹œí‚¤ì§€ ì•ŠìŒ


## ğŸ“Œ ì™œ ì´ë ‡ê²Œ í•´ì•¼ í•˜ë‚˜?
RustëŠ” í´ë¡œì €ê°€ ì°¸ì¡°ë¥¼ ìº¡ì²˜í•  ë•Œ, ê·¸ ì°¸ì¡°ê°€ í´ë¡œì €ê°€ ì‚´ì•„ ìˆëŠ” ë™ì•ˆ ìœ íš¨í•´ì•¼ í•œë‹¤ê³  ê°•í•˜ê²Œ ìš”êµ¬í•©ë‹ˆë‹¤.  
Box::leak()ì€ ì´ ìš”êµ¬ë¥¼ ë§Œì¡±ì‹œí‚¤ê¸° ìœ„í•œ í¸ë²•ì ì´ì§€ë§Œ ì•ˆì „í•œ ë°©ë²•ì…ë‹ˆë‹¤â€”ë‹¨, ë©”ëª¨ë¦¬ í•´ì œê°€ ë˜ì§€ ì•Šìœ¼ë¯€ë¡œ í…ŒìŠ¤íŠ¸ë‚˜ ì§§ì€ ì‹¤í–‰ì—ì„œë§Œ ì‚¬ìš©.


### âœ… ì •ë¦¬: ë¼ì´í”„íƒ€ì„ê³¼ Box í™œìš© ìš”ì•½

| ì½”ë“œ ë˜ëŠ” ê°œë…               | ì„¤ëª… ë˜ëŠ” ëª©ì                           |
|-----------------------------|----------------------------------------|
| `Box::new(...)`             | í™ì— ê°’ì„ ì €ì¥ (ìŠ¤íƒë³´ë‹¤ ì˜¤ë˜ ìœ ì§€ ê°€ëŠ¥) |
| `Box::leak(...)`            | `'static` ì°¸ì¡°ë¡œ ë³€í™˜ (ë©”ëª¨ë¦¬ í•´ì œ ì•ˆ ë¨) |
| `rk45_with_user(..., user)` | `user`ëŠ” `'a` ë¼ì´í”„íƒ€ì„ì„ ë§Œì¡±í•´ì•¼ í•¨     |
| `'static`                   | `'a` ë¼ì´í”„íƒ€ì„ ìš”êµ¬ë¥¼ ì•ˆì „í•˜ê²Œ ë§Œì¡±ì‹œí‚´   |


---

## ì‹¤ì „ í•´ê²° ë°©ë²•
### ğŸ”§ ë°©ë²• 1: OdeSolver<'a>ë¥¼ í˜¸ì¶œì ë¼ì´í”„íƒ€ì„ìœ¼ë¡œ ìƒ

```rust

fn run_solver<'a>(user: &'a mut Params) {
    let mut solver = OdeSolver::new(1); // Solverë„ 'a ë¼ì´í”„íƒ€ì„ì„ ê°€ì§

    let f_ud = |_: f64, y: &[f64], dy: &mut [f64], _n: usize, user: &mut Params| {
        dy[0] = -user.k * y[0];
    };
    let t0 = 0.0;
    let t1 = 0.75;
    let y0 = [1.0];
    let mut y1 = Vec::new();
    let ok = solver.rk45_with_user(f_ud, t0, &y0, t1, &mut y1, user, None, None, None);
    assert!(ok);
}
```

### ğŸ”§ ë°©ë²• 2: rk45_with_user()ë¥¼ í˜¸ì¶œì ìŠ¤ì½”í”„ì—ì„œ ì§ì ‘ ì‚¬ìš©
```rust
#[test]
fn rk45_with_user_param() {
    #[derive(Clone)]
    struct Params { k: f64 }

    let mut params = Params { k: 1.5 };
    let k = params.k;

    let mut solver = OdeSolver::new(1);

    let f_ud = |_: f64, y: &[f64], dy: &mut [f64], _n: usize, user: &mut Params| {
        dy[0] = -user.k * y[0];
    };

    let t0 = 0.0;
    let t1 = 0.75;
    let y0 = [1.0];
    let mut y1 = Vec::new();

    // ì—¬ê¸°ì„œ paramsëŠ” í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ ì „ì²´ ë¼ì´í”„íƒ€ì„ì„ ê°€ì§
    let ok = solver.rk45_with_user(f_ud, t0, &y0, t1, &mut y1, &mut params, None, None, None);
    assert!(ok);

    let expected = (-k * t1).exp();
    assert!(rel_err(y1[0], expected) < 1e-7);
}
```          

- ì´ ë°©ì‹ì€ ë¼ì´í”„íƒ€ì„ì„ 'staticìœ¼ë¡œ ë§Œë“¤ í•„ìš” ì—†ì´ ìì—°ìŠ¤ëŸ½ê²Œ í•´ê²°ë©ë‹ˆë‹¤
- ë‹¨, OdeSolver êµ¬ì¡°ì²´ê°€ 'a ë¼ì´í”„íƒ€ì„ì„ ë°›ì•„ì•¼ í•˜ë©°, rk45_with_user()ë„ 'aë¥¼ ìœ ì§€í•´ì•¼ í•¨

### ğŸ“Œ í•µì‹¬ ìš”ì•½: ë¼ì´í”„íƒ€ì„ê³¼ í´ë¡œì € ìº¡ì²˜ ì „ëµ
| ê¸°ìˆ  ë˜ëŠ” ë°©ì‹         | ëª©ì  ë˜ëŠ” íš¨ê³¼                                  | ì‹¤ì „ ì‚¬ìš© ê°€ëŠ¥ì„± | ë©”ëª¨ë¦¬ ì•ˆì „ì„± | ë¼ì´í”„íƒ€ì„ ì˜¤ë¥˜ íšŒí”¼ |
|------------------------|--------------------------------------------------|------------------|----------------|----------------------|
| `Box::leak(...)`       | í™ì— ì €ì¥ëœ ê°’ì„ `'static` ì°¸ì¡°ë¡œ ë³€í™˜            | âŒ í…ŒìŠ¤íŠ¸ ì „ìš©     | âŒ ëˆ„ìˆ˜ ë°œìƒ     | âœ… íšŒí”¼ ê°€ëŠ¥           |
| í˜¸ì¶œì ìŠ¤ì½”í”„ì—ì„œ ì°¸ì¡° | í´ë¡œì €ê°€ ì°¸ì¡°í•  ê°’ì„ ì¶©ë¶„íˆ ì˜¤ë˜ ìœ ì§€             | âœ… ì¶”ì²œ           | âœ… ì•ˆì „í•¨       | âœ… íšŒí”¼ ê°€ëŠ¥           |
| êµ¬ì¡°ì  ë¼ì´í”„íƒ€ì„ ì—°ê²° | `OdeSolver<'a>`ì™€ `user: &'a mut T`ë¥¼ í•¨ê»˜ ì„¤ê³„   | âœ… ì¶”ì²œ           | âœ… ì•ˆì „í•¨       | âœ… íšŒí”¼ ê°€ëŠ¥           |
| `'static` ê°•ì œ ìš”êµ¬    | ëª¨ë“  ì°¸ì¡°ê°€ `'static`ì´ì–´ì•¼ í•¨ â†’ ìœ ì—°ì„± ì €í•˜       | âŒ ì œí•œì  ì‚¬ìš©     | âœ… ì•ˆì „í•¨       | âœ… íšŒí”¼ ê°€ëŠ¥           |

---

# ğŸ” í˜¸ì¶œì ìŠ¤ì½”í”„ë€?
Rustì—ì„œ "í˜¸ì¶œì ìŠ¤ì½”í”„"ëŠ” ì–´ë–¤ í•¨ìˆ˜ê°€ í˜¸ì¶œë˜ëŠ” ë°”ê¹¥ ì½”ë“œì˜ ë¼ì´í”„íƒ€ì„ê³¼ ë³€ìˆ˜ ë²”ìœ„ë¥¼ ë§í•©ë‹ˆë‹¤.  
ì˜ˆë¥¼ ë“¤ì–´:
```rust
fn main() {
    let mut user = Params { k: 1.5 }; // â† í˜¸ì¶œì ìŠ¤ì½”í”„ì—ì„œ ì„ ì–¸ë¨
    let mut solver = OdeSolver::new(1);

    solver.rk45_with_user(f_ud, t0, &y0, t1, &mut y1, &mut user, None, None, None);
}
```
- ì—¬ê¸°ì„œ userëŠ” main() í•¨ìˆ˜ì˜ ìŠ¤ì½”í”„ì— ì†í•´ ìˆê³ 
- rk45_with_user()ëŠ” userë¥¼ ì°¸ì¡°í•˜ëŠ” í´ë¡œì €ë¥¼ ë‚´ë¶€ì— ì €ì¥í•˜ë¯€ë¡œ
- OdeSolver<'a>ì™€ user: &'a mut Tê°€ ê°™ì€ ë¼ì´í”„íƒ€ì„ 'aë¥¼ ê³µìœ í•´ì•¼ ì•ˆì „í•´ìš”

## âœ… ì™œ í˜¸ì¶œì ìŠ¤ì½”í”„ì—ì„œ ì¨ì•¼ ì•ˆì „í•œê°€?
RustëŠ” í´ë¡œì €ê°€ ì°¸ì¡°ë¥¼ ìº¡ì²˜í•  ë•Œ, ê·¸ ì°¸ì¡°ê°€ í´ë¡œì €ê°€ ì‚´ì•„ ìˆëŠ” ë™ì•ˆ ìœ íš¨í•´ì•¼ í•œë‹¤ê³  ê°•í•˜ê²Œ ìš”êµ¬.  
ê·¸ë˜ì„œ:
- userê°€ ë„ˆë¬´ ì§§ì€ ìŠ¤ì½”í”„ì— ìˆìœ¼ë©´ â†’ âŒ ë¼ì´í”„íƒ€ì„ ì˜¤ë¥˜
- userê°€ rk45_with_user()ë¥¼ í˜¸ì¶œí•˜ëŠ” ë°”ê¹¥ ìŠ¤ì½”í”„ì— ì¶©ë¶„íˆ ì˜¤ë˜ ì‚´ì•„ì•¼ â†’ âœ… ì•ˆì „

## ğŸ“Œ í•µì‹¬ ìš”ì•½: ë¼ì´í”„íƒ€ì„ `'a`ì™€ í˜¸ì¶œ êµ¬ì¡°
| ê°œë… ë˜ëŠ” ìš”ì†Œ       | ì„¤ëª… ë˜ëŠ” ì—°ê²° ê´€ê³„                     |
|----------------------|----------------------------------------|
| `rk45_with_user()`   | í´ë¡œì € ë‚´ë¶€ì—ì„œ `user`ë¥¼ ì°¸ì¡°í•¨         |
| `'a` ë¼ì´í”„íƒ€ì„      | `OdeSolver`ì™€ `user`ê°€ ê³µìœ í•´ì•¼ í•˜ëŠ” ë¼ì´í”„íƒ€ì„ |
| `user`               | `&'a mut T` íƒ€ì…ìœ¼ë¡œ í´ë¡œì €ì— ë„˜ê²¨ì§     |
| `OdeSolver<'a>`      | í´ë¡œì €ë¥¼ ì €ì¥í•˜ë¯€ë¡œ `'a` ë¼ì´í”„íƒ€ì„ í•„ìš” |

## ğŸ§© ë¬¸ì œ ë°œìƒ ì½”ë“œ (ë¼ì´í”„íƒ€ì„ ì˜¤ë¥˜ ë°œìƒ)
```rust
#[test]
fn rk45_with_user_param() {
    let mut solver = OdeSolver::new(1);
    let mut params = Params { k: 1.5 }; // â† í˜¸ì¶œì ìŠ¤ì½”í”„ì—ì„œ ì„ ì–¸
    let f_ud = |_, y: &[f64], dy: &mut [f64], _, user: &mut Params| {
        dy[0] = -user.k * y[0];
    };
    // âŒ ë¼ì´í”„íƒ€ì„ ì˜¤ë¥˜ ë°œìƒ
    solver.rk45_with_user(f_ud, t0, &y0, t1, &mut y1, &mut params, None, None, None);
}
```

### âŒ ì™œ ì˜¤ë¥˜ê°€ ë‚˜ëŠ”ê°€?
- rk45_with_user()ëŠ” í´ë¡œì €ë¥¼ OdeSolver ë‚´ë¶€ì— ì €ì¥ (Box<dyn FnMut + 'a>)
- paramsëŠ” í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ ìŠ¤ì½”í”„ì— ì„ ì–¸ë˜ì–´ 'aë¥¼ ë§Œì¡±í•˜ì§€ ëª»í•¨
- RustëŠ” `í´ë¡œì €`ê°€ `params`ë¥¼ `ë„ˆë¬´ ì˜¤ë˜ ì°¸ì¡°í•  ìˆ˜ ìˆë‹¤ê³  íŒë‹¨` â†’ ì˜¤ë¥˜

## âœ… í•´ê²°ëœ êµ¬ì¡° (í˜¸ì¶œì ìŠ¤ì½”í”„ì™€ ë¼ì´í”„íƒ€ì„ ì—°ê²°)
```rust
fn run_solver<'a>(solver: &'a mut OdeSolver<'a>, user: &'a mut Params) {
    let f_ud = |_, y: &[f64], dy: &mut [f64], _, user: &mut Params| {
        dy[0] = -user.k * y[0];
    };

    solver.rk45_with_user(f_ud, t0, &y0, t1, &mut y1, user, None, None, None);
}

#[test]
fn rk45_with_user_param() {
    let mut solver = OdeSolver::new(1);
    let mut params = Params { k: 1.5 };

    // âœ… í˜¸ì¶œì ìŠ¤ì½”í”„ì—ì„œ solverì™€ paramsê°€ ë™ì¼í•œ ë¼ì´í”„íƒ€ì„ì„ ê³µìœ 
    run_solver(&mut solver, &mut params);
}
```

## âœ… ì™œ ì˜¤ë¥˜ê°€ í•´ê²°ë˜ëŠ”ê°€?
- solverì™€ paramsê°€ ê°™ì€ ìŠ¤ì½”í”„ì—ì„œ ì„ ì–¸ë¨
- run_solver()ëŠ” `'a` ë¼ì´í”„íƒ€ì„ì„ ëª…ì‹œì ìœ¼ë¡œ ì—°ê²°
- OdeSolver<'a>ì™€ user: &'a mut Paramsê°€ ë™ì¼í•œ ë¼ì´í”„íƒ€ì„ì„ ê³µìœ 
- í´ë¡œì €ê°€ userë¥¼ ì•ˆì „í•˜ê²Œ ì°¸ì¡°í•  ìˆ˜ ìˆìŒ â†’ âœ… ì»´íŒŒì¼ ì„±ê³µ

ğŸ“Œ í•µì‹¬ ì°¨ì´ ìš”ì•½
| ì½”ë“œ êµ¬ì¡°            | `params` ìœ„ì¹˜       | `OdeSolver` ë¼ì´í”„íƒ€ì„ | ê²°ê³¼           |
|----------------------|---------------------|------------------------|----------------|
| í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ ë‚´ë¶€ í˜¸ì¶œ | í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ ìŠ¤ì½”í”„  | í´ë¡œì €ê°€ ë” ì˜¤ë˜ ì‚´ì•„ì•¼ í•¨ | âŒ ë¼ì´í”„íƒ€ì„ ì˜¤ë¥˜ |
| í˜¸ì¶œì ìŠ¤ì½”í”„ ì—°ê²°    | ë™ì¼í•œ ì™¸ë¶€ ìŠ¤ì½”í”„  | ë¼ì´í”„íƒ€ì„ `'a`ë¡œ ëª…ì‹œ ì—°ê²° | âœ… ì»´íŒŒì¼ ì„±ê³µ     |
---

# ìŠ¤ì½”í”„ ì„ ì–¸ ìœ„ì¹˜ ì£¼ì˜

## âœ… ì •ìƒ ë™ì‘í•˜ëŠ” ì½”ë“œ
```rust
#[test]
fn rk45_with_user_param() {
    let mut params = Params { k: 1.5 };
    let mut solver = OdeSolver::new(1);

    let f_ud = |_, y, dy, _, user: &mut Params| {
        dy[0] = -user.k * y[0];
    };
    solver.rk45_with_user(f_ud, t0, &y0, t1, &mut y1, &mut params, None, None, None);
}
```

ğŸ” ì´ ì½”ë“œëŠ” ì™œ ë˜ëŠ”ê°€?
- paramsì™€ solverê°€ ê°™ì€ ìŠ¤ì½”í”„ì—ì„œ ì„ ì–¸ë¨
- rk45_with_user()ëŠ” 'a ë¼ì´í”„íƒ€ì„ì„ ìš”êµ¬í•˜ì§€ë§Œ, RustëŠ” ì´ ê²½ìš° `'a` ë¥¼ `í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ ì „ì²´ ìŠ¤ì½”í”„` ë¡œ ì¶”ë¡ í•¨
- í´ë¡œì €ê°€ paramsë¥¼ ìº¡ì²˜í•´ë„, paramsê°€ ì¶©ë¶„íˆ ì˜¤ë˜ ì‚´ì•„ ìˆìœ¼ë¯€ë¡œ ì•ˆì „í•¨

## âŒ ë¬¸ì œê°€ ìƒê¸°ëŠ” ì½”ë“œ (ë¼ì´í”„íƒ€ì„ ì˜¤ë¥˜ ë°œìƒ)
```rust
#[test]
fn rk45_with_user_param() {
    let mut solver = OdeSolver::new(1);

    let ok = {
        let mut params = Params { k: 1.5 }; // ğŸ‘ˆ ë‚´ë¶€ ë¸”ë¡ì—ì„œ ì„ ì–¸ë¨
        let f_ud = |_, y, dy, _, user: &mut Params| {
            dy[0] = -user.k * y[0];
        };

        solver.rk45_with_user(f_ud, t0, &y0, t1, &mut y1, &mut params, None, None, None)
    };
}
```

âŒ ì™œ ì˜¤ë¥˜ê°€ ë‚˜ëŠ”ê°€?
- paramsê°€ ì¤‘ì²© ë¸”ë¡ ì•ˆì—ì„œ ì„ ì–¸ë¨
- í´ë¡œì €ëŠ” paramsë¥¼ ìº¡ì²˜í•´ì„œ OdeSolver ë‚´ë¶€ì— ì €ì¥í•˜ë ¤ê³  í•¨
- RustëŠ” paramsê°€ ë¸”ë¡ ëì—ì„œ dropë˜ë¯€ë¡œ 'a ë¼ì´í”„íƒ€ì„ì„ ë§Œì¡±í•˜ì§€ ëª»í•œë‹¤ê³  íŒë‹¨
- ê²°ê³¼ì ìœ¼ë¡œ borrowed value does not live long enough ì˜¤ë¥˜ ë°œìƒ

## ğŸ“Œ í•µì‹¬ ì°¨ì´ ìš”ì•½: ë¼ì´í”„íƒ€ì„ ì˜¤ë¥˜ ë°œìƒ vs ì •ìƒ ë™ì‘
| í•­ëª©         | ì •ìƒ ì½”ë“œ                          | ì˜¤ë¥˜ ë°œìƒ ì½”ë“œ                        | ì„¤ëª… ìš”ì•½                             |
|--------------|------------------------------------|----------------------------------------|----------------------------------------|
| `params` ìœ„ì¹˜ | í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ ì „ì²´ ìŠ¤ì½”í”„             | ì¤‘ì²© ë¸”ë¡ ë˜ëŠ” ì§§ì€ ìŠ¤ì½”í”„             | `'a` ë¼ì´í”„íƒ€ì„ì„ ì¶©ë¶„íˆ ë§Œì¡±í•˜ë ¤ë©´ ìŠ¤ì½”í”„ê°€ ê¸¸ì–´ì•¼ í•¨ |
| `solver` ìœ„ì¹˜ | `params`ì™€ ê°™ì€ ìŠ¤ì½”í”„              | `params`ë³´ë‹¤ ë” ì˜¤ë˜ ì‚´ì•„ì•¼ í•¨          | í´ë¡œì €ê°€ `params`ë¥¼ ìº¡ì²˜í•˜ë¯€ë¡œ `solver`ì™€ ë¼ì´í”„íƒ€ì„ ê³µìœ  í•„ìš” |
| ë¼ì´í”„íƒ€ì„ `'a` | `params`ì™€ `solver`ê°€ í•¨ê»˜ `'a` ê³µìœ  | `params`ê°€ `'a`ë³´ë‹¤ ì§§ìŒ â†’ ì˜¤ë¥˜ ë°œìƒ     | `'a`ëŠ” í´ë¡œì € ì €ì¥ì„ ìœ„í•´ ê¸¸ê²Œ ì¶”ë¡ ë¨ |

## âœ… í•´ê²° ë°©ë²• ìš”ì•½
- paramsëŠ” solverì™€ ê°™ì€ ìŠ¤ì½”í”„ì—ì„œ ì„ ì–¸í•´ì•¼ í•¨
- í´ë¡œì €ê°€ ìº¡ì²˜í•˜ëŠ” ì°¸ì¡°ëŠ” 'a ë¼ì´í”„íƒ€ì„ì„ ë§Œì¡±í•´ì•¼ í•˜ë¯€ë¡œ, ìŠ¤ì½”í”„ê°€ ì¶©ë¶„íˆ ê¸¸ì–´ì•¼ í•¨

## âœ¨ ì˜ˆì‹œë¡œ ë‹¤ì‹œ ì •ë¦¬
```rust
// âœ… ì•ˆì „: ê°™ì€ ìŠ¤ì½”í”„
let mut params = Params { k: 1.5 };
{
    let mut solver = OdeSolver::new(1);
    solver.rk45_with_user(..., &mut params, ...);
}

// âŒ ì˜¤ë¥˜: ìŠ¤ì½”í”„ê°€ ë‹¤ë¦„
let mut solver = OdeSolver::new(1);
{
    let mut params = Params { k: 1.5 };
    solver.rk45_with_user(..., &mut params, ...); // âŒ paramsê°€ ë„ˆë¬´ ë¹¨ë¦¬ dropë¨
}
```

---

# ì½”ë”© ì£¼ì˜ ì‚¬í•­

ë¼ì´í”„íƒ€ì„ì€ Rustì˜ ê°€ì¥ ê°•ë ¥í•œ ì•ˆì „ì¥ì¹˜ì§€ë§Œ, ì´ë ‡ê²Œ ìŠ¤ì½”í”„ê°€ ì‚´ì§ë§Œ ì–´ê¸‹ë‚˜ë„ ì˜¤ë¥˜ê°€ ë‚˜ê¸° ë•Œë¬¸ì—  
ëˆˆì— ì˜ ë„ëŠ” êµ¬ì¡°ë¡œ ì§œëŠ” ìŠµê´€ì´ ì •ë§ ì¤‘ìš”.  

## âœ… í•µì‹¬ ì•„ì´ë””ì–´
paramsë¥¼ ë°”ê¹¥ ìŠ¤ì½”í”„ì—ì„œ ì„ ì–¸í•˜ê³ ,  
solverì™€ í´ë¡œì €ë¥¼ ì§§ì€ ë‚´ë¶€ ìŠ¤ì½”í”„ì—ì„œ ìƒì„±Â·ì‚¬ìš©í•œ ë’¤,  
ê²°ê³¼ë§Œ ë°”ê¹¥ìœ¼ë¡œ êº¼ë‚´ì˜¤ë©´ ë¼ì´í”„íƒ€ì„ ì¶©ëŒì´ ë°œìƒí•  ì¼ì´ ì—†ìŠµë‹ˆë‹¤.  


## ğŸ”§ êµ¬ì¡° ì˜ˆì‹œ
```rust
#[derive(Clone)]
struct Params { k: f64 }

#[test]
fn rk45_safe_scope() {
    let mut params = Params { k: 1.5 }; // ğŸ‘ˆ ë°”ê¹¥ ìŠ¤ì½”í”„ì—ì„œ ì„ ì–¸
    let mut y1 = Vec::new();
    {
        let mut solver = OdeSolver::new(1); // ğŸ‘ˆ ë‚´ë¶€ ìŠ¤ì½”í”„ì—ì„œ solver ìƒì„±

        let f_ud = |_: f64, y: &[f64], dy: &mut [f64], _: usize, user: &mut Params| {
            dy[0] = -user.k * y[0];
        };

        let t0 = 0.0;
        let t1 = 0.75;
        let y0 = [1.0];

        let ok = solver.rk45_with_user(f_ud, t0, &y0, t1, &mut y1, &mut params, None, None, None);
        assert!(ok);
    }

    // ì—¬ê¸°ì„œ y1ì€ solverê°€ dropëœ ì´í›„ì—ë„ ì•ˆì „í•˜ê²Œ ì‚¬ìš© ê°€ëŠ¥
    let expected = (-params.k * 0.75).exp();
    assert!(rel_err(y1[0], expected) < 1e-7);
}
```
## ğŸ“Œ ì™œ ì´ êµ¬ì¡°ê°€ ì•ˆì „í•œê°€?
| ìš”ì†Œ     | ë¼ì´í”„íƒ€ì„ ë˜ëŠ” ê´€ê³„ ì„¤ëª…                  |
|----------|--------------------------------------------|
| `params` | `'a` ë¼ì´í”„íƒ€ì„ì„ ê°€ì§ (ë°”ê¹¥ ìŠ¤ì½”í”„ì— ì¡´ì¬) |
| `solver` | í´ë¡œì €ë¥¼ ì €ì¥í•˜ì§€ë§Œ `'a`ì™€ ë™ì¼í•œ ìŠ¤ì½”í”„ì—ì„œ ìƒì„±ë¨ |
| í´ë¡œì €   | `params`ë¥¼ ìº¡ì²˜í•˜ì§€ë§Œ `solver`ì™€ í•¨ê»˜ dropë¨ |
| `y1`     | ê²°ê³¼ë§Œ ë°”ê¹¥ìœ¼ë¡œ êº¼ë‚´ë¯€ë¡œ ì°¸ì¡° ì¶©ëŒ ì—†ìŒ       |

ì´ êµ¬ì¡°ëŠ” Rustì˜ ë¼ì´í”„íƒ€ì„ ì‹œìŠ¤í…œì„ ìì—°ìŠ¤ëŸ½ê²Œ ë§Œì¡±ì‹œí‚¤ëŠ” ë°©ì‹ì´ë¼ ì‹¤ì „ì—ì„œë„ ë§¤ìš° ì¶”ì²œ.

## ğŸ” ë¬¸ì œ ë°œìƒ êµ¬ì¡° vs ì•ˆì „í•œ êµ¬ì¡°
### âŒ ë¬¸ì œ ë°œìƒ êµ¬ì¡°
```rust
#[test]
fn test() {
    let mut solver = OdeSolver::new(1); // solver ë¨¼ì € ìƒì„±ë¨

    {
        let mut params = Params { k: 1.5 }; // paramsëŠ” ë‚´ë¶€ ë¸”ë¡ì— ìˆìŒ

        let f_ud = |_, y, dy, _, user: &mut Params| {
            dy[0] = -user.k * y[0];
        };

        // âŒ ì˜¤ë¥˜: solverê°€ í´ë¡œì €ë¥¼ ì €ì¥í•˜ë ¤ê³  í•˜ëŠ”ë°, paramsëŠ” ë¸”ë¡ ëì—ì„œ dropë¨
        solver.rk45_with_user(f_ud, t0, &y0, t1, &mut y1, &mut params, None, None, None);
    }

    // paramsëŠ” ì—¬ê¸°ì„œ ì´ë¯¸ ì‚¬ë¼ì§
}
```

- solverëŠ” í´ë¡œì €ë¥¼ ì €ì¥í•˜ë©´ì„œ 'a ë¼ì´í”„íƒ€ì„ì„ ìš”êµ¬
- paramsëŠ” ë‚´ë¶€ ë¸”ë¡ì— ìˆì–´ì„œ 'aë¥¼ ë§Œì¡±í•˜ì§€ ëª»í•¨
- RustëŠ” "í´ë¡œì €ê°€ paramsë¥¼ ë„ˆë¬´ ì˜¤ë˜ ì°¸ì¡°í•  ìˆ˜ ìˆë‹¤"ê³  íŒë‹¨ â†’ ì˜¤ë¥˜ ë°œìƒ

### âœ… ì•ˆì „í•œ êµ¬ì¡°
```rust
#[test]
fn test() {
    let mut params = Params { k: 1.5 }; // ğŸ‘ˆ ë°”ê¹¥ ìŠ¤ì½”í”„ì—ì„œ ì„ ì–¸
    let mut y1 = Vec::new();

    {
        let mut solver = OdeSolver::new(1); // ğŸ‘ˆ ë‚´ë¶€ ìŠ¤ì½”í”„ì—ì„œ solver ìƒì„±

        let f_ud = |_, y, dy, _, user: &mut Params| {
            dy[0] = -user.k * y[0];
        };

        // âœ… paramsëŠ” solverë³´ë‹¤ ì˜¤ë˜ ì‚´ì•„ ìˆìœ¼ë¯€ë¡œ ì•ˆì „
        solver.rk45_with_user(f_ud, t0, &y0, t1, &mut y1, &mut params, None, None, None);
    }

    // y1ì€ ì•ˆì „í•˜ê²Œ ì‚¬ìš© ê°€ëŠ¥
}
```

- paramsëŠ” í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ ì „ì²´ ìŠ¤ì½”í”„ì— ìˆì–´ì„œ 'aë¥¼ ë§Œì¡±
- solverëŠ” í´ë¡œì €ë¥¼ ì €ì¥í•˜ì§€ë§Œ, paramsê°€ ì¶©ë¶„íˆ ì˜¤ë˜ ì‚´ì•„ ìˆìŒ
- RustëŠ” "ì´ ì°¸ì¡°ëŠ” ì•ˆì „í•˜ë‹¤"ê³  íŒë‹¨ â†’ ì»´íŒŒì¼ ì„±ê³µ

---

paramsì™€ solverì˜ ë¼ì´í”„íƒ€ì„ ê´€ê³„ë¥¼ ì‹œê°ì ìœ¼ë¡œ ì—°ê²°í•œ í‘œì…ë‹ˆë‹¤.  
íŠ¹íˆ 'a ë¼ì´í”„íƒ€ì„ì´ ì–´ë–»ê²Œ ì¶”ë¡ ë˜ê³ , ì™œ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ê±°ë‚˜ ì•ˆì „í•œì§€ë¥¼ ë³´ì—¬ì£¼ëŠ” êµ¬ì¡°ì˜ˆìš”:
### ğŸ“Œ í•µì‹¬ ì—°ê²° ìš”ì•½

| ìš”ì†Œ     | ë¼ì´í”„íƒ€ì„ ê´€ê³„ ì„¤ëª…                  | ì•ˆì „ ì—¬ë¶€ | ì„¤ëª… ìš”ì•½                           |
|----------|----------------------------------------|-----------|--------------------------------------|
| `params` | `'a`ë³´ë‹¤ ì§§ìœ¼ë©´ ì˜¤ë¥˜ ë°œìƒ               | âŒ ë˜ëŠ” âœ… | `'a`ë¥¼ ë§Œì¡±í•´ì•¼ í´ë¡œì €ì—ì„œ ì°¸ì¡° ê°€ëŠ¥   |
| `solver` | í´ë¡œì €ë¥¼ ì €ì¥í•˜ë¯€ë¡œ `'a` ë¼ì´í”„íƒ€ì„ ìš”êµ¬ | âœ…        | `'a`ëŠ” `solver`ê°€ ì‚´ì•„ ìˆëŠ” ë™ì•ˆ ìœ ì§€ë¨ |
| í´ë¡œì €   | `'a` ë™ì•ˆ `params`ë¥¼ ì°¸ì¡°í•¨              | âœ… ë˜ëŠ” âŒ | `params`ê°€ `'a`ë³´ë‹¤ ì§§ìœ¼ë©´ ì˜¤ë¥˜ ë°œìƒ   |


## ğŸ” ì‹œê°ì  êµ¬ì¡° ì˜ˆì‹œ
```
// âœ… ì•ˆì „í•œ êµ¬ì¡°
let mut params = Params { k: 1.5 }; // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
{                                     //               â”‚
    let mut solver = OdeSolver::new(); // â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
    solver.rk45_with_user(..., &mut params); //   â”‚    â”‚
}                                     //  â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
                                      //               â”‚
                                   // params ì‚´ì•„ ìˆìŒ â”˜
```

```
// âŒ ì˜¤ë¥˜ êµ¬ì¡°
{
    let mut solver = OdeSolver::new(); // â”€â”€â”€â”€â”€â”€â”€â”€â”
    {
        let mut params = Params { k: 1.5 }; // â”€â”€â”€â”€â”
        solver.rk45_with_user(..., &mut params);// â”‚
    } // params dropë¨                          // â”‚
} // solver ì‚´ì•„ ìˆìŒ â†’ í´ë¡œì €ê°€ params ì°¸ì¡°í•˜ë ¤ í•¨ â†’ âŒ

```

ì´ êµ¬ì¡°ëŠ” ë¼ì´í”„íƒ€ì„ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ëŠ” ê²½ìš°ì™€ ì•ˆì „í•œ ê²½ìš°ë¥¼ ë¹„êµí•´ì„œ ë³´ì—¬ì¤ë‹ˆë‹¤.

### âŒ ì˜¤ë¥˜ ë°œìƒ êµ¬ì¡° (paramsê°€ ë„ˆë¬´ ì§§ì€ ìŠ¤ì½”í”„ì— ìˆìŒ)
```mermaid
flowchart TD
    A[í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ ì‹œì‘]
    B[solver ìƒì„±]
    C{ì¤‘ì²© ë¸”ë¡}
    D[params ìƒì„±]
    E[í´ë¡œì € ìƒì„± ë° solverì— ì €ì¥]
    F[params dropë¨]
    G[solverê°€ í´ë¡œì €ë¥¼ ì°¸ì¡°í•˜ë ¤ í•¨ â†’ âŒ ì˜¤ë¥˜]

    A --> B --> C
    C --> D --> E --> F --> G

```

### âœ… ì•ˆì „í•œ êµ¬ì¡° (paramsê°€ ë°”ê¹¥ ìŠ¤ì½”í”„ì— ìˆìŒ)
```mermaid
flowchart TD
    A[í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ ì‹œì‘]
    B[params ìƒì„±]
    C{ë‚´ë¶€ ë¸”ë¡}
    D[solver ìƒì„±]
    E[í´ë¡œì € ìƒì„± ë° solverì— ì €ì¥]
    F[solver dropë¨]
    G[y1 ê²°ê³¼ ì‚¬ìš©]

    A --> B --> C
    C --> D --> E --> F
    A --> G

```
